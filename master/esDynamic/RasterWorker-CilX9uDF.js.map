{"version":3,"file":"RasterWorker-CilX9uDF.js","sources":["../../node_modules/@arcgis/core/layers/support/rasterTransforms/IdentityTransform.js","../../node_modules/@arcgis/core/layers/support/rasterTransforms/utils.js","../../node_modules/@arcgis/core/layers/support/RasterWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../chunks/tslib.es6.js\";import\"../../../core/Logger.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import\"../../../core/Error.js\";import{enumeration as o}from\"../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import t from\"./BaseRasterTransform.js\";var e;let a=e=class extends t{constructor(){super(...arguments),this.type=\"identity\"}clone(){return new e}};r([o({IdentityXform:\"identity\"})],a.prototype,\"type\",void 0),a=e=r([s(\"esri.layers.support.rasterTransforms.IdentityTransform\")],a);const p=a;export{p as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport r from\"./GCSShiftTransform.js\";import o from\"./IdentityTransform.js\";import t from\"./PolynomialTransform.js\";const n={GCSShiftXform:r,IdentityXform:o,PolynomialXform:t};function f(r){const o=r?.type;if(!o)return null;const t=n[r?.type];if(t){const o=new t;return o.read(r),o}return null}export{f as readTransform};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport r from\"../../geometry/Extent.js\";import e from\"../../geometry/Point.js\";import t from\"../../geometry/support/GeographicTransformation.js\";import s from\"./PixelBlock.js\";import{decode as o}from\"./rasterFormats/RasterCodec.js\";import{split as i,clipTile as n,mosaic as a,approximateTransform as l,getLocalArithmeticNorthRotations as m}from\"./rasterFunctions/pixelUtils.js\";import{create as c}from\"./rasterFunctions/rasterFunctionHelper.js\";import{requirePE as f,load as p,getProjectionOffsetGrid as u}from\"./rasterFunctions/rasterProjectionHelper.js\";import{computeStatisticsHistograms as S,estimateStatisticsHistograms as d}from\"./rasterFunctions/stretchUtils.js\";import{convertVectorFieldData as x,convertToLocalDirections as y}from\"./rasterFunctions/vectorFieldUtils.js\";import{readTransform as O}from\"./rasterTransforms/utils.js\";import h from\"../../renderers/support/RasterSymbolizer.js\";import{createFlowMesh as N}from\"../../views/2d/engine/flow/dataUtils.js\";class J{convertVectorFieldData(r){const e=s.fromJSON(r.pixelBlock),t=x(e,r.type);return Promise.resolve(null!=t?t.toJSON():null)}computeStatisticsHistograms(r){const e=s.fromJSON(r.pixelBlock),t=S(e);return Promise.resolve(t)}async decode(r){const e=await o(r.data,r.options);return e&&e.toJSON()}symbolize(e){e.pixelBlock=s.fromJSON(e.pixelBlock),e.extent=e.extent?r.fromJSON(e.extent):null;const t=this.symbolizer.symbolize(e);return Promise.resolve(null!=t?t.toJSON():null)}async updateSymbolizer(r){this.symbolizer=h.fromJSON(r.symbolizerJSON),r.histograms&&\"rasterStretch\"===this.symbolizer?.rendererJSON.type&&(this.symbolizer.rendererJSON.histograms=r.histograms)}async updateRasterFunction(r){this.rasterFunction=c(r.rasterFunctionJSON)}async process(t){const o=this.rasterFunction.process({extent:r.fromJSON(t.extent),primaryPixelBlocks:t.primaryPixelBlocks.map((r=>null!=r?s.fromJSON(r):null)),primaryPixelSizes:t.primaryPixelSizes?.map((r=>null!=r?e.fromJSON(r):null)),primaryRasterIds:t.primaryRasterIds});return null!=o?o.toJSON():null}stretch(r){const e=this.symbolizer.simpleStretch(s.fromJSON(r.srcPixelBlock),r.stretchParams);return Promise.resolve(e?.toJSON())}estimateStatisticsHistograms(r){const e=d(s.fromJSON(r.srcPixelBlock));return Promise.resolve(e)}split(r){const e=i(s.fromJSON(r.srcPixelBlock),r.tileSize,r.maximumPyramidLevel??0,!1===r.useBilinear);return e&&e.forEach(((r,t)=>{e.set(t,r?.toJSON())})),Promise.resolve(e)}clipTile(r){const e=s.fromJSON(r.pixelBlock),t=n({...r,pixelBlock:e});return Promise.resolve(t?.toJSON())}async mosaicAndTransform(r){const e=r.srcPixelBlocks.map((r=>r?new s(r):null)),t=a(e,r.srcMosaicSize,{blockWidths:r.blockWidths,alignmentInfo:r.alignmentInfo,clipOffset:r.clipOffset,clipSize:r.clipSize});let o,i=t;return r.coefs&&(i=l(t,r.destDimension,r.coefs,r.sampleSpacing,r.interpolation)),r.projectDirections&&r.gcsGrid&&(o=m(r.destDimension,r.gcsGrid),i=y(i,r.isUV?\"vector-uv\":\"vector-magdir\",o)),{pixelBlock:i?.toJSON(),localNorthDirections:o}}async createFlowMesh(r,e){const t={data:new Float32Array(r.flowData.buffer),mask:new Uint8Array(r.flowData.maskBuffer),width:r.flowData.width,height:r.flowData.height},{vertexData:s,indexData:o}=await N(r.meshType,r.simulationSettings,t,e.signal);return{result:{vertexBuffer:s.buffer,indexBuffer:o.buffer},transferList:[s.buffer,o.buffer]}}async getProjectionOffsetGrid(e){const s=r.fromJSON(e.projectedExtent),o=r.fromJSON(e.srcBufferExtent);let i=null;e.datumTransformationSteps&&(i=new t({steps:e.datumTransformationSteps})),(e.includeGCSGrid||f(s.spatialReference,o.spatialReference,i))&&await p();const n=e.rasterTransform?O(e.rasterTransform):null;return u({...e,projectedExtent:s,srcBufferExtent:o,datumTransformation:i,rasterTransform:n})}}export{J as default};\n"],"names":["e","a","t","r","o","s","p","n","f","J","x","S","h","c","d","i","l","m","y","N","O","u"],"mappings":"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","x_google_ignoreList":[0,1,2]}