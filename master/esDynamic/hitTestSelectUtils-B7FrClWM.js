import{ax as xn,a7 as An,a8 as Tn,fu as kn,x as l,z as u,K as G,aL as ee,bh as Mn,ab as Ve,aI as f,cC as xe,aK as Ae,G as kt,bA as Sn,hW as _n,aM as Rn,dm as Pn,bl as In,cI as te,b$ as zn,dp as On,gc as qn,dw as jn}from"./main-BC8gbEPx.js";import{a as Bn,n as Dn}from"./Cyclical-CC0J6X0n.js";import{o as he,m as Fe}from"./quantityUtils-BbyrVlo5.js";import{L as Hn,e as A,u as Un,q as Mt,d as D,j as oe,p as ne,l as Vn,B as Fn,_ as Gn,o as St,b as _t,E as Rt}from"./vec2-BnynUbeJ.js";import{m as Cn,n as I,t as Te,l as Yn}from"./vec2f64-CEUyUoff.js";import{H as b,s as Ge,o as H,v as Ce,R as _,P as M,q as E,p as Pt,c as Ye,_ as ke,Z as We,j as Wn,A as Zn,J as Jn}from"./vec32-CKLwdlap.js";import{n as Me,e as Se,a as It}from"./projectVectorToVector-B5ubG6d0.js";import{N as Ze,q as Je,j as _e,b as Ke}from"./geodesicUtils-BqX9QtL8.js";import{g as Kn}from"./TimeExtent-B3UXB00l.js";import{b as Xn}from"./Query-BDnleJ4k.js";import{f as Qn,_ as zt,s as $n}from"./MapView-CCgzpEAk.js";import{s as es,j as ts}from"./vec42-D8CJyqHG.js";import{n as ns}from"./vec4f64-CjUMzAyX.js";import{i as ss}from"./projectBuffer-CI8y-xLT.js";import{M as z,z as rs,l as Re,Q as Xe,d as Ot,k as qt,V as is,H as jt,O as Bt,p as os}from"./plane-DnaQmUZU.js";import{I as as,O as ls,_ as cs,$ as us,U as ps}from"./sphere-BQalhKXp.js";import{m as hs,j as Qe,x as ds,E as fs}from"./elevationInfoUtils-CPumv29T.js";import{e as de}from"./common-CYWrYyJl.js";const Dt="z",Ht="r",ys={redo:Ht,undo:Dt,center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},Ut={toggle:"Control"},gs={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},vs={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:Qn,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:Dt,redo:Ht};let ms=class{constructor(){this._bindings=new Map}add(t,e){return this.addToggle(t,n=>{n.type==="key-down"&&e(n)})}addToggle(t,e){const n=bs.fromDefinition(t,e),s=xn(this._bindings,n.key,()=>[]);return s.push(n),An(()=>Tn(s,n))}register(t,e=zt.WIDGET){return kn([t.on("key-down",n=>this.dispatch(t.inputManager,n),e),t.on("key-up",n=>this.dispatch(t.inputManager,n),e)])}dispatch(t,e){const n=e.key,s=this._bindings.get(n);if(s)for(const r of s)r.process(t,e)}},bs=class wt{constructor(e,n,s,r,i){this.key=e,this.modifiers=n,this.repeats=s,this.continuePropagation=r,this.callback=i}process(e,n){if(!(n.key!==this.key||"repeat"in n&&n.repeat&&!this.repeats)){for(const s of this.modifiers)if(!e.isModifierKeyDown(s))return;this.continuePropagation||n.stopPropagation(),this.callback(n)}}static fromDefinition(e,n){if(typeof e=="string")return new wt(e,[],!1,!1,n);const{key:s,modifier:r,repeats:i,continuePropagation:a}=e;return new wt(s,r?Array.isArray(r)?r:[r]:[],!!i,!!a,n)}},Pe=class extends ee{constructor(t){super(t),this.enabled=!1}};l([u({type:Boolean,nonNullable:!0})],Pe.prototype,"enabled",void 0),Pe=l([G("esri.views.interactive.sketch.SketchLabelOptions")],Pe);const $e=Pe;let fe=class extends ee{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};l([u({type:String,nonNullable:!0})],fe.prototype,"mode",void 0),fe=l([G("esri.views.interactive.sketch.SketchTooltipElevationOptions")],fe);let w=class extends ee{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};l([u({type:Boolean,nonNullable:!0})],w.prototype,"area",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"coordinates",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"direction",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"distance",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"elevation",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"header",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"helpMessage",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"orientation",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"radius",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"rotation",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"scale",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"size",void 0),l([u({type:Boolean,nonNullable:!0})],w.prototype,"totalLength",void 0),w=l([G("esri.views.interactive.sketch.SketchTooltipVisibleElements")],w);const Vt=w;let T=class extends ee{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new fe,this.placement="auto",this.offset=null,this.visibleElements=new Vt,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};l([u({type:Boolean,nonNullable:!0})],T.prototype,"enabled",void 0),l([u()],T.prototype,"forceEnabled",void 0),l([u()],T.prototype,"effectiveEnabled",null),l([u()],T.prototype,"helpMessage",void 0),l([u()],T.prototype,"helpMessageIcon",void 0),l([u({type:Boolean,nonNullable:!0})],T.prototype,"inputEnabled",void 0),l([u({type:fe,nonNullable:!0})],T.prototype,"elevation",void 0),l([u()],T.prototype,"placement",void 0),l([u()],T.prototype,"offset",void 0),l([u({type:Vt,nonNullable:!0})],T.prototype,"visibleElements",void 0),l([u()],T.prototype,"visualVariables",void 0),l([u()],T.prototype,"xyMode",void 0),T=l([G("esri.views.interactive.sketch.SketchTooltipOptions")],T);const et=T;let ae=class extends ee{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};l([u()],ae.prototype,"length",void 0),l([u()],ae.prototype,"verticalLength",void 0),l([u()],ae.prototype,"area",void 0),ae=l([G("esri.views.interactive.sketch.Units")],ae);const Ie=ae;var k;function Ft(t,e){if(t==null||e==null)return;const n=tt(t,e);return n!=null?he(n,"radians","geographic"):void 0}(function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"})(k||(k={}));const tt=(()=>{const t=f(),e=f();return(n,s)=>(H(t,n.x,n.y,n.z??0),H(e,s.x,s.y,s.z??0),Gt(t,e,n.spatialReference,s.spatialReference))})(),Gt=(()=>{const t=I(),e=f(),n=f();return(s,r,i,a)=>{if(b(s,r))return;const o=Ze(i),c=Ze(a);if(o&&c&&Mn(o,c)&&Me(s,i,e,o)&&Me(r,a,n,c)){const{azimuth:h}=Je(ws,e,n,o);return h!=null?Ve(h,"degrees","radians"):void 0}t[0]=r[0]-s[0],t[1]=r[1]-s[1];let p=Hn(Cn,t);return t[0]<0&&(p=xs-p),p}})();function Ns(t,e,n,s=k.Absolute){if(e&&n)switch(s){case k.Absolute:return Ft(e,n);case k.Relative:return nt(Ct(t,e,n),k.Relative);case k.RelativeBilateral:return nt(Ct(t,e,n),k.RelativeBilateral)}}function Ct(t,e,n){if(!t||!e||!n)return;const s=tt(t,e),r=tt(e,n);return s!=null&&r!=null?he(r-s,"radians","geographic"):void 0}function nt(t,e){if(t!=null)switch(e){case k.Absolute:return Yt(t);case k.Relative:{const n=ye(t);let s=Zt.normalize(n,0,!0);return s===-180&&(s=180),he(s,"degrees","geographic")}case k.RelativeBilateral:{const n=ye(t),s=Math.abs(Zt.normalize(n,0,!0));return he(s,"degrees","geographic")}}}function Yt(t){const e=ye(t),n=As.normalize(e,0,!0);return he(n,"degrees","geographic")}const Ls=(()=>{const t=f();return(e,n,s,r,i,a="geodesic")=>{Ge(t,n);const o=ye(i);if(a==="geodesic"){const y=Ze(s);if(y&&Me(t,s,t,y))return _e(e,t,o,r,y),e[2]=n[2],!!Me(e,y,e,s)}const c=Fe(o,"geographic","arithmetic"),p=Ve(c,"degrees","radians"),h=n[0]+r*Math.cos(p),d=n[1]+r*Math.sin(p),N=n[2];return H(e,h,d,N),!0}})();function ye(t){if(t!=null)return Fe(Wt(t),t.rotationType,"geographic")}function Es(t){if(t!=null)return Fe(Wt(t),t.rotationType,"arithmetic")}function Wt(t){return Ve(t.value,t.unit,"degrees")}const ws=new Ke,xs=2*Math.PI,As=Bn,Zt=new Dn(-180,180);let K=class extends ee{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?k.RelativeBilateral:k.Relative;case"absolute":return k.Absolute}}get displayUnits(){return this._get("displayUnits")??new Ie}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new Ie}set inputUnits(t){this._set("inputUnits",t)}};l([u({type:String,nonNullable:!0})],K.prototype,"directionMode",void 0),l([u({type:Boolean,nonNullable:!0})],K.prototype,"relativeDirectionIsBilateral",void 0),l([u()],K.prototype,"effectiveDirectionMode",null),l([u({type:Ie,nonNullable:!0})],K.prototype,"displayUnits",null),l([u({type:Ie,nonNullable:!0})],K.prototype,"inputUnits",null),K=l([G("esri.views.interactive.sketch.SketchValueOptions")],K);const st=K;let le=class extends ee{constructor(t){super(t),this.labels=new $e,this.tooltips=new et,this.values=new st}};l([u({nonNullable:!0,type:$e})],le.prototype,"labels",void 0),l([u({nonNullable:!0,type:et})],le.prototype,"tooltips",void 0),l([u({nonNullable:!0,type:st})],le.prototype,"values",void 0),le=l([G("esri.views.interactive.sketch.SketchOptions")],le);const Ts=le;var se;function rt(t,e,n){return S(t,e,n)}function S(t=0,e=0,n=0){return xe(t,e,n)}function ks(t){return t}function Ms(t){return t}function C(t,e,n){return xe(t,e,n)}function ce(t){const[e,n,s]=t;return t.length>3?[e,n,s,t[3]]:[e,n,s]}function Ss(t){return t[3]=((t.length>3?t[3]:void 0)??se.NONE)|se.TARGET,t}function _s(t){return!!(((t.length>3?t[3]:void 0)??se.NONE)&se.TARGET)}function it(t,e,{coordinateHelper:n,elevationInfo:s},r){return t?Jt(n.vectorToDehydratedPoint(t,zs),e,s,r):null}function Jt(t,e,n,s=S()){return s[0]=t.x,s[1]=t.y,s[2]=t.z??0,e==null||(e.type==="2d"?s[2]=0:s[2]=hs(e,t,n,Qe)??0),s}function Rs(t,e,n){return n?(It(n,t[0],t[1],t[2],e),n):Se(t[0],t[1],t[2],e)}function Ps(t,e,{z:n,m:s},r,i){const{spatialReference:a,elevationInfo:o}=r;let c;n==null&&s==null?c=void 0:e==null||e.type==="2d"?c=n??void 0:c=ds(e,t,a,Qe,o)??0;const[p,h]=t;return i?It(i,p,h,c,a):i=Se(p,h,c,a),s!=null&&(i.m=s,i.hasM=!0),i}function Is(t,e,n,s,r=S()){const[i,a]=t;return r[0]=i,r[1]=a,t.length>3&&(r[3]=t[3]??se.NONE),n?.type!=="3d"?(r[2]=e.value,r):(r[2]=fs(n,i,a,e.value,s,e.elevationInfo,Qe)??0,r)}(function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"})(se||(se={}));const zs=Se(0,0,0,null);let j=class extends kt{constructor(){super(...arguments),this.enabled=!0}};l([u({type:Boolean})],j.prototype,"enabled",void 0),j=l([G("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],j);let v=class extends kt{constructor(t){super(t),this.lineSnapper=new j,this.parallelLineSnapper=new j,this.rightAngleSnapper=new j,this.rightAngleTriangleSnapper=new j,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Ae([255,127,0]),this.orangeTransparent=new Ae([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};l([u({type:j,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"lineSnapper",void 0),l([u({type:j,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"parallelLineSnapper",void 0),l([u({type:j,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"rightAngleSnapper",void 0),l([u({type:j,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"rightAngleTriangleSnapper",void 0),l([u({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],v.prototype,"shortLineThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],v.prototype,"distance",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"pointThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"intersectionParallelLineThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"parallelLineThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"verticalLineThresholdMeters",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"touchSensitivityMultiplier",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"pointOnLineThreshold",void 0),l([u({type:Ae,nonNullable:!0})],v.prototype,"orange",void 0),l([u({type:Ae,nonNullable:!0})],v.prototype,"orangeTransparent",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"lineHintWidthReference",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"lineHintWidthTarget",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"lineHintFadedExtensions",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"parallelLineHintWidth",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],v.prototype,"parallelLineHintLength",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],v.prototype,"parallelLineHintOffset",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],v.prototype,"rightAngleHintSize",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],v.prototype,"rightAngleHintOutlineSize",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],v.prototype,"satisfiesConstraintScreenThreshold",void 0),v=l([G("esri.views.interactive.snapping.Settings.Defaults")],v);const Os=new v;var re;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(re||(re={}));const qs=Symbol("grid-placement-graphic");function Kt(t,e){const n=t.x-e.x,s=t.y-e.y;return n*n+s*s}function js(t,e){return Math.sqrt(Kt(t,e))}function Bs(t,e){e.sort((n,s)=>Ce(n.targetPoint,t)-Ce(s.targetPoint,t))}var ot;function Ds({point:t,distance:e,returnEdge:n,vertexMode:s,coordinateHelper:{spatialReference:r},filter:i},a,o){return o=o!=null?o.clone():new Xn({where:"1=1"}),i&&(o.geometry=i.geometry,o.distance=i.distance,o.spatialRelationship=i.spatialRelationship,o.where=Sn(o.where,i.where),o.timeExtent=Kn(o.timeExtent,i.timeExtent),o.objectIds=Hs(o.objectIds,i.objectIds)),{point:Se(t[0],t[1],t[2],r.toJSON()),mode:a,distance:e,returnEdge:n,vertexMode:s,query:o.toJSON()}}function Hs(t,e){return t||e?e?t?Array.from(_n(new Set(t),new Set(e))):e:t:null}function Us(t,e,n){return{left:it(t.leftVertex.pos,e,n),right:it(t.rightVertex.pos,e,n)}}(function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(ot||(ot={}));const Xt=Symbol("snapping-toggle");function Vs(t,e=()=>{}){const n=Rn(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:s,snappingOptions:r})=>{if(t.removeHandles(Xt),!s||!r)return;const i=zt.TOOL,a=[s.on("key-down",o=>{o.key!==Ut.toggle||o.repeat||(r.enabledToggled=!0,e())},i),s.on("key-up",o=>{o.key===Ut.toggle&&(r.enabledToggled=!1,e())},i),s.on("pointer-move",o=>{const c=o.native.ctrlKey;r.enabledToggled!==c&&(r.enabledToggled=c,e())},i)];t.addHandles(a,Xt)},Pn);t.addHandles(n)}function Fs(t){return $n(t)&&"utilityNetworks"in t&&!!t.utilityNetworks?.length}function at(t,e){return t[0]*e[1]-t[1]*e[0]}function Gs(t,e,n){const s=oe(n,e)/ne(n);return Vn(t,n,s)}function Cs(t,e,n,s,r=n){return A(ie,s,n),A(ze,e,r),Gs(ue,ze,ie),Un(t,r,ue)}function Ys(t,e,n,s){A(ie,e,n);const r=s/Mt(ie);return D(t,n,ie,r)}function Ws(t,e){const n=t.start,s=t.end,r=e.start,i=e.end,a=A(ie,s,n),o=A(Qt,i,r),c=at(a,o);if(Math.abs(c)<=Js)return[];const p=A(ze,n,r),h=at(o,p)/c,d=at(a,p)/c;if(h>=0){if(d>=0||e.type===m.LINE)return[D(ue,n,a,h)]}else if(t.type===m.LINE&&(d>=0||e.type===m.LINE))return[D(ue,n,a,h)];return[]}function Zs(t,e,n){const s=[],r=A(ie,t.end,t.start),i=A(Qt,t.start,e),a=ne(r),o=2*oe(r,i),c=o*o-4*a*(ne(i)-n*n);if(c===0){const p=-o/(2*a);(t.type===m.LINE||p>=0)&&s.push(D(ue,t.start,r,p))}else if(c>0){const p=Math.sqrt(c),h=(-o+p)/(2*a);(t.type===m.LINE||h>=0)&&s.push(D(ue,t.start,r,h));const d=(-o-p)/(2*a);(t.type===m.LINE||d>=0)&&s.push(D(ze,t.start,r,d))}return s}var m;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(m||(m={}));const Js=1e-6,ie=I(),Qt=I(),ze=I(),ue=I();function lt({start:t,end:e,type:n},s,r){const i=[],a=A(ge,e,t),o=A(qe,t,s),c=ne(a),p=2*oe(a,o),h=p*p-4*c*(ne(o)-r*r);if(h===0){const d=-p/(2*c);(n===R.PLANE||d>=0)&&i.push(D(I(),t,a,d))}else if(h>0){const d=Math.sqrt(h),N=(-p+d)/(2*c);(n===R.PLANE||N>=0)&&i.push(D(I(),t,a,N));const y=(-p-d)/(2*c);(n===R.PLANE||y>=0)&&i.push(D(I(),t,a,y))}return i}function $t(t,e){const n=t.start,s=t.end,r=A(ge,s,n),i=H(Be,-r[1],r[0],0),a=e.start,o=e.end,c=_(pt,o,a),p=M(c,i),h=H(an,n[0],n[1],0),d=_(ln,h,a),N=M(d,i),y=de();if(Math.abs(p)<y)return[];const L=E(cn,a,c,N/p);if(e.type===m.RAY){const x=_(ht,L,a);if(M(x,c)<-y)return[]}if(t.type===R.HALF_PLANE){const x=Fn(qe,L,n);if(oe(x,r)<-y)return[]}return[te(L)]}function Ks(t,e){return Qs(Oe(dt,e[2],t),e)}function en(t,e){return rn(Oe(dt,0,t),Oe(nr,0,e)).map(([n,s])=>Te(n,s))}function tn(t,e,n){return ct(t,Oe(dt,t[2],e),n)}function nn(t,e,n,s=f()){const r=A(ge,t,e),i=Mt(r);return D(s,e,r,i===0?1:n/i),s[2]=t[2],s}function ct(t,{start:e,end:n,type:s},r=f()){const i=_(je,t,e),a=_(Be,n,e),o=M(i,a)/M(a,a);return E(r,e,a,s===m.RAY?Math.max(o,0):o)}const Xs=(()=>{const t=f(),e=f(),n=f();return({start:s,end:r},{center:i,radius:a,normal:o,slicePlane:c})=>{const p=Re(i,o,tr);if(g(Xe(p,s),0)&&g(Xe(p,r),0)){Ot(o,t,e);const d=(L,x)=>(Ye(n,x,i),St(L,M(n,t),M(n,e)),L),N=Zs({start:d(ge,s),end:d(qe,r),type:m.LINE},Yn,a),y=[];for(const[L,x]of N){const P=Ge(f(),i);E(P,P,t,L),E(P,P,e,x),c&&!X(c,P)||y.push(P)}return y}const h=f();return qt(p,s,r,h)?!g(Pt(h,i),a)||c&&!X(c,h)?[]:[h]:[]}})();function sn({start:t,end:e,type:n},s,r){const i=[],a=Ye(je,e,t),o=A(qe,t,s),c=ne(a),p=2*oe(a,o),h=p*p-4*c*(ne(o)-r*r);if(h===0){const d=-p/(2*c);(n===m.LINE||d>=0)&&i.push(E(f(),t,a,d))}else if(h>0){const d=Math.sqrt(h),N=(-p+d)/(2*c);(n===m.LINE||N>=0)&&i.push(E(f(),t,a,N));const y=(-p-d)/(2*c);(n===m.LINE||y>=0)&&i.push(E(f(),t,a,y))}return i}function rn(t,e){const n=t.start,s=t.end,r=e.start,i=e.end,a=_(je,s,n),o=_(Be,i,r),c=_(pt,r,n),p=ke(an,a,o);if(!g(M(c,p),0))return[];const h=We(p);if(g(h,0))return[];const d=ke(ln,c,o),N=M(d,p)/h,y=E(cn,n,a,N);if(t.type===m.RAY){const L=_(ht,y,n);if(M(a,L)<-de())return[]}if(e.type===m.RAY){const L=_(ht,y,r);if(M(o,L)<-de())return[]}return[te(y)]}function Qs({start:t,end:e,type:n},s){const r=_(je,s,t),i=_(Be,e,t),a=ke(pt,i,r),o=We(a)/We(i),c=de();if(o<c)switch(n){case m.LINE:return[te(s)];case m.RAY:return M(i,r)<-c?[]:[te(s)]}return[]}function ut(t,e,n,s){const[r,i]=t,[a,o]=n,c=a-r,p=o-i,h=c*c+p*p,d=Math.sqrt(h);if(d>e+s)return[];if(d<Math.abs(e-s))return[];if(g(d,0)&&g(e,s))return[];const N=(e*e-s*s+h)/(2*d),y=Math.sqrt(e*e-N*N),L=y*p/d,x=y*c/d,[P,$]=Gn(ge,t,n,N/d);return g(L,x)?[Te(P,$)]:[Te(P+L,$-x),Te(P-L,$+x)]}function Oe(t,e,{start:n,end:s,type:r}){return H(t.start,n[0],n[1],e),H(t.end,s[0],s[1],e),t.type=er[r],t}function on(t,e){return g(t[2],e[2])}function g(t,e){return In(Math.abs(t-e),0,de())}function $s(t,e){return e.filter(n=>X(t,n))}function X(t,e){return rs(t,e)}var R;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(R||(R={}));const er={[R.PLANE]:m.LINE,[R.HALF_PLANE]:m.RAY},ge=I(),qe=I(),je=f(),Be=f(),pt=f(),an=f(),ln=f(),cn=f(),ht=f(),tr=z(),dt={start:f(),end:f(),type:m.LINE},nr={start:f(),end:f(),type:m.LINE};class O{intersect(e){return Y(this,e)}closestPoints(e){return[this.closestTo(e)]}}class pe extends O{constructor(e){super(),this.point=e}equals(e){return this===e||q(e)&&b(this.point,e.point)}closestTo(){return ce(this.point)}}class ft extends O{constructor(e,n,s){super(),this.start=e,this.end=n,this.lineLike={start:e,end:n,type:s}}equals(e){return this===e||U(e)&&this.lineLike.type===e.lineLike.type&&b(this.start,e.start)&&b(this.end,e.end)}closestTo(e){const n=S();return ct(e,this.lineLike,n),n}}class yt extends ft{constructor(e,n){super(e,n,m.LINE)}}class sr extends ft{constructor(e,n){super(e,n,m.RAY)}}class un extends O{constructor(e){super(),this.constraints=e}equals(e){return this===e||Et(e)&&On(this.constraints,e.constraints,(n,s)=>n.equals(s))}closestTo(e){let n,s=1/0;for(const r of this.constraints){const i=r.closestTo(e),a=Ce(e,i);a<s&&(s=a,n=i)}return ce(n??e)}closestPoints(e){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(e))}}class pn extends O{constructor(e,n){super(),this.center=e,this.radius=n}equals(e){return this===e||F(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const n=S();return nn(e,this.center,this.radius,n),n}}class gt extends O{constructor(e,n){super(),this.center=e,this.radius=n}equals(e){return this===e||Z(e)&&b(this.center,e.center)&&this.radius===e.radius}closestTo(e){const n=S();return nn(e,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new vt(ce(this.center),this.radius,C(0,0,1))}}class vt extends O{constructor(e,n,s,r=void 0){super(),this.center=e,this.radius=n,this.normal=s,this.slicePlane=r}equals(e){return this===e||Q(e)&&b(this.center,e.center)&&b(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:n,radius:s}=this;jt(this.getPlane(rr),e,mt);const r=_(mt,mt,n),i=Wn(r);if(g(i,0))return ce(e);const a=s/Math.sqrt(i),o=S();E(o,n,r,a);const{slicePlane:c}=this;return c&&!X(c,o)?Nt(c,this)?.closestTo(e)??ce(e):o}getPlane(e=z()){return Re(this.center,this.normal,e)}}const mt=f(),rr=z();class hn extends O{constructor(e){super(),this.z=e}equals(e){return this===e||W(e)&&this.z===e.z}closestTo(e){return C(e[0],e[1],this.z)}getPlane(e=z()){return H(dn,0,0,this.z),Re(dn,jn,e)}}const dn=f();class bt extends O{constructor(e,n,s){super(),this.start=e,this.end=n,this.planeLike={start:e,end:n,type:s}}equals(e){return this===e||V(e)&&this.planeLike.type===e.planeLike.type&&b(this.start,e.start)&&b(this.end,e.end)}closestTo(e){const n=S();return tn(e,this.planeLike,n),n}closestEndTo(e){const{start:n,end:s}=this.planeLike;return Math.sign(oe(A(ir,s,n),A(or,e,n)))>0?this.end:this.start}getPlane(e=z()){const n=Ge(fn,this.end);return n[2]+=1,os(this.start,this.end,n,e)}getSlicePlane(e=z()){const{start:n,end:s,type:r}=this.planeLike;if(r===R.PLANE)return;const i=H(fn,n[0],n[1],0),a=H(yn,s[0],s[1],0),o=Ye(yn,a,i);return Re(i,o,e),e}}const ir=I(),or=I(),fn=f(),yn=f();class ar extends bt{constructor(e,n){super(e,n,R.HALF_PLANE)}}class lr extends bt{constructor(e,n){super(e,n,R.PLANE)}}class cr extends O{constructor(e,n){super(),this.sphere=ls(e,n)}equals(e){return this===e||J(e)&&cs(this.sphere,e.sphere)}closestTo(e){const n=S();return us(this.sphere,e,n),n}get center(){return ps(this.sphere)}get radius(){return this.sphere[3]}}class gn extends O{constructor(e,n,s){super(),this.start=e,this.end=n,this.getZ=s,this.planeLike={start:e,end:n,type:R.PLANE}}equals(e){return this===e||He(e)&&b(this.start,e.start)&&b(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return dr(this,e)}addIfOnTheGround(e,n){for(const s of n){const r=this.getZ(s[0],s[1])??0;g(s[2],r)&&(s[2]=r,e.push(s))}}}class vn extends O{constructor(e,n,s){super(),this._x=e,this._y=n,this._z=s}equals(e){return this===e||Sr(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,n,s]){return rt(this._x??e,this._y??n,this._z??s)}}class mn extends O{constructor(e,n,s,r,i){super(),this._origin=e,this._spatialReference=n,this._distanceMeters=s,this._z=r,this._directionDegrees=i}equals(e){return this===e||Mr(e)&&Rt(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,n,s]){return St(ve,e,n),Rt(ve,this._origin)||this._applyDirectionAndDistance(ve),rt(ve[0],ve[1],this._z??s)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)_e(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)pr(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=Je(ur,this._origin,e,this._spatialReference);_e(e,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const ve=[0,0],ur=new Ke;function pr(t,e,n,s,r){let{azimuth:i,distance:a}=Je(hr,e,s,r);i??=0;let o=a*Math.cos((i-n)*ss);o=Math.max(0,o),_e(t,e,n,o,r)}const hr=new Ke;function dr(t,e){const n=S();return tn(e,t.planeLike,n),n[2]=t.getZ(n[0],n[1])??Ln,n}function Y(t,e){if(Et(t)){const n=[];for(const s of t.constraints){const r=s.intersect(e);r&&n.push(r)}return De(n)}if(Et(e))return Y(e,t);if(He(t))return bn(t,e);if(He(e))return bn(e,t);if(q(t)){const{point:n}=t;if(q(e))return b(n,e.point)?t:void 0;const s=e.closestTo(n);return Jn(s,n)?t:void 0}if(U(t)){if(q(e))return Y(e,t);if(U(e))return B(rn(t.lineLike,e.lineLike));if(W(e))return fr(t,e);if(V(e))return B($t(e.planeLike,t.lineLike));if(F(e))return B(sn(t.lineLike,e.center,e.radius));if(Q(e))return B(Xs(t.lineLike,e));if(Z(e))return yr(t,e);if(J(e))return gr(t,e)}else if(W(t)){if(q(e)||U(e))return Y(e,t);if(W(e))return vr(t,e);if(V(e))return mr(t,e);if(F(e))return br(t,e);if(Q(e))return Lr(t,e);if(Z(e))return Nr(t,e);if(J(e))return Er(t,e)}else if(V(t)){if(q(e)||U(e)||W(e))return Y(e,t);if(V(e))return Lt(en(t.planeLike,e.planeLike));if(F(e))return Lt(lt(t.planeLike,e.center,e.radius));if(Q(e))return xr(t,e);if(Z(e))return wr(t,e);if(J(e))return Ar(t,e)}else if(F(t)){if(q(e)||U(e)||W(e)||V(e))return Y(e,t);if(F(e))return Lt(ut(t.center,t.radius,e.center,e.radius));if(Q(e))return;if(Z(e))return Tr(t,e);if(J(e))return}else if(Q(t)){if(q(e)||U(e)||W(e)||V(e)||F(e))return Y(e,t);if(Q(e))return;if(Z(e))return e.asCircle(),void 0;if(J(e))return}else if(Z(t)){if(q(e)||U(e)||W(e)||V(e)||F(e)||Q(e))return Y(e,t);if(Z(e))return kr(e,t);if(J(e))return}else if(J(t)){if(q(e)||U(e)||W(e)||V(e)||F(e)||Z(e))return Y(e,t);if(J(e))return}}const fr=(()=>{const t=z();return(e,n)=>{const{start:s,end:r}=e;if(on(s,r)&&g(s[2],n.z))return e;const i=S();return qt(n.getPlane(t),s,r,i)?new pe(i):void 0}})();function yr({lineLike:t},{center:e,radius:n}){const s=e[2];return B(sn(t,e,n).filter(r=>g(r[2],s)))}function gr({lineLike:t},{sphere:e}){return B(as(e,t.start,t.end))}const Nt=(()=>{const t=ns(),e=f(),n=f();return(s,r,i)=>{const{normal:a,center:o,radius:c}=r;Ot(a,e,n);const p=Bt(s),h=c*M(p,e),d=c*M(p,n);es(t,o[0],o[1],o[2],1);const N=ts(s,t),y=Math.hypot(h,d),L=g(y,0);if(g(Xe(s,o),0)){if(L)return r;if(g(c,0))return!i||X(i,o)?new pe(ce(o)):void 0;ke(e,p,a),Zn(e,e);const Ue=new Array,Ee=te(o);E(Ee,Ee,e,c),i&&!X(i,Ee)||Ue.push(Ee);const we=te(o);return E(we,we,e,-c),i&&!X(i,we)||Ue.push(we),B(Ue)}if(L)return;const x=-N/y;if(Math.abs(x)>1||g(x,1))return;const P=Math.atan(h/d),$=qn(x)-P,Tt=Math.PI-$,be=new Array,Ne=f();E(Ne,o,e,c*Math.cos($)),E(Ne,Ne,n,c*Math.sin($)),be.push(Ne);const Le=f();return E(Le,o,e,c*Math.cos(Tt)),E(Le,Le,n,c*Math.sin(Tt)),be.push(Le),B(i?$s(i,be):be)}})();function vr(t,e){return g(t.z,e.z)?t:void 0}function mr({z:t},{planeLike:e}){const[n,s]=e.start,[r,i]=e.end,a=C(n,s,t),o=C(r,i,t);return e.type===R.PLANE?new yt(a,o):new sr(a,o)}function br(t,e){const[n,s]=e.center;return new gt(C(n,s,t.z),e.radius)}function Nr(t,e){return g(e.center[2],t.z)?e:void 0}const Lr=(()=>{const t=z();return(e,n)=>Nt(e.getPlane(t),n,n.slicePlane)})();function Er(t,{center:e,radius:n}){const s=Math.abs(e[2]-t.z);if(s>n&&!g(s,n))return;const r=C(e[0],e[1],t.z),i=Math.sqrt(n**2-s**2);return g(i,0)?void 0:new gt(r,i)}const wr=(()=>{const t=z();return(e,{center:n,radius:s})=>{const r=lt(e.planeLike,n,s),i=n[2];e.getSlicePlane(t);const a=new Array;for(const[o,c]of r){const p=[o,c,i];X(t,p)&&a.push(p)}return B(a)}})(),xr=(()=>{const t=z(),e=z();return(n,s)=>Nt(n.getPlane(t),s,n.getSlicePlane(e))})(),Ar=(()=>{const t=z();return(e,{center:n,radius:s})=>{const r=e.getPlane(t),i=is(r,n),a=Math.abs(i);if(a>s&&!g(a,s))return;const o=Math.sqrt(s**2-i**2);if(g(o,0)){const h=S();return jt(r,n,h),new pe(h)}const c=S(),p=te(Bt(r));return E(c,n,p,i),new vt(c,o,p,e.getSlicePlane())}})();function Tr(t,e){const n=_t(t.center,e.center);return g(n,0)&&g(t.radius,e.radius)?e:Nn(ut(t.center,t.radius,e.center,e.radius),e.center[2])}function kr(t,e){if(!on(t.center,e.center))return;const n=_t(t.center,e.center);return g(n,0)&&g(t.radius,e.radius)?t:Nn(ut(t.center,t.radius,e.center,e.radius),t.center[2])}function bn(t,e){const{planeLike:n,getZ:s}=t,r=new Array;if(q(e))t.addIfOnTheGround(r,Ks(n,e.point));else if(U(e))t.addIfOnTheGround(r,$t(n,e.lineLike));else if(F(e))for(const[i,a]of lt(n,e.center,e.radius)){const o=s(i,a);o!=null&&r.push(xe(i,a,o))}else if(V(e)||He(e))for(const[i,a]of en(n,e.planeLike)){const o=s(i,a)??Ln;r.push(xe(i,a,o))}return B(r)}function Lt(t){return De(t.map(([e,n])=>{const s=C(e,n,0),r=C(e,n,1);return new yt(s,r)}))}function B(t){return De(t.map(e=>e?new pe(e):void 0))}function Nn(t,e){return B(t.map(([n,s])=>[n,s,e]))}function De(t){if(t.length!==0)return t.length===1?t[0]??void 0:new un(t.filter(zn))}function Et(t){return t instanceof un}function q(t){return t instanceof pe}function U(t){return t instanceof ft}function W(t){return t instanceof hn}function V(t){return t instanceof bt}function F(t){return t instanceof pn}function Z(t){return t instanceof gt}function Q(t){return t instanceof vt}function J(t){return t instanceof cr}function He(t){return t instanceof gn}function Mr(t){return t instanceof mn}function Sr(t){return t instanceof vn}const Ln=0;let me=class{constructor(t,e){this.isDraped=t,this.domain=e}},_r=class En extends me{constructor(e,n,s,r,i=re.ALL,a=!0,o=!0){super(r,i),this.type=e,this.lineStart=n,this.lineEnd=s,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof En&&this.type===e.type&&b(this.lineStart,e.lineStart)&&b(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return Pt(this.lineStart,this.lineEnd)}};class xt extends me{constructor(e,n,s=re.ALL){super(n,s),this.intersectionPoint=e}equals(e){return e instanceof xt&&b(this.intersectionPoint,e.intersectionPoint)}}let Rr=class wn extends me{constructor(e,n,s,r=re.ALL){super(s,r),this.lineStart=e,this.lineEnd=n}equals(e){return e instanceof wn&&b(this.lineStart,e.lineStart)&&b(this.lineEnd,e.lineEnd)}};class At extends me{constructor(e,n,s,r,i=re.ALL){super(r,i),this.previousVertex=e,this.centerVertex=n,this.nextVertex=s}equals(e){return e instanceof At&&b(this.previousVertex,e.previousVertex)&&b(this.centerVertex,e.centerVertex)&&b(this.nextVertex,e.nextVertex)}}function Pr(t){return t?.type==="graphic"}function Ir(t){return t.find(Pr)??null}export{Ft as $,_r as A,ot as B,xt as C,Rr as D,Bs as E,At as F,pn as G,Jt as H,Cs as I,ct as J,Ps as K,yt as L,Ls as M,it as N,Vs as O,$e as P,et as Q,lr as R,st as S,Yt as T,nt as U,k as V,Ws as W,vn as X,ye as Y,De as Z,hn as _,me as a,mn as a0,Ns as a1,q as a2,gs as a3,Es as a4,Rs as a5,_s as a6,Is as a7,Ss as b,S as c,qs as d,C as e,rt as f,pe as g,Fs as h,re as i,ar as j,js as k,Ts as l,ys as m,ks as n,Us as o,Os as p,Gt as q,m as r,Ms as s,Ys as t,Kt as u,Ir as v,vs as w,ms as x,Ds as y,gn as z};
