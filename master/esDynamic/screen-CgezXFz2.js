import{ek as M,el as E,gN as S,em as Z,eo as x,eF as K,eq as C,es as a,ew as t,ev as o,ey as J,eA as p,h1 as A,h0 as P,er as k,eK as R,eL as _,eC as j,eD as z,eG as O,eH as U,eJ as $,ez as y,eB as V,ex as q,eI as X,ec as F,gq as Q,h7 as W,ep as Y,et as H,eu as N,eM as G,im as ee,io as ae,ip as le,iq as B,ir as I}from"./main-BC8gbEPx.js";const te={class:"rv-geosearch-bar relative h-26 mx-8 mb-8"},se=["placeholder","value","aria-label"],re={class:"absolute inset-y-0 right-8 grid w-10 place-content-center"},oe=["aria-label","content"],ne=M({__name:"search-bar",setup(T){const{t:n}=E(),i=S(),c=Z(),f=x(()=>i.searchVal),v=x(()=>['"',"$","!","*","+","?","^","{","}","(",")","|","[","]"].filter(h=>i.searchVal.includes(h)).join("")),m=h=>{i.setSearchTerm(h),i.setSearchRegex(h)},d=K(500,h=>{m(h)});return(h,e)=>{const u=C("tippy");return a(),t("div",te,[o("input",{type:"text",class:J(["border-b w-full text-base py-8 outline-none focus:shadow-outline border-gray-600 h-full min-w-0",{"border-yellow-500":v.value}]),placeholder:p(n)("geosearch.searchText"),value:f.value,onInput:e[0]||(e[0]=l=>p(d)(l.target.value)),onKeyup:e[1]||(e[1]=A(l=>{p(c).mobileView&&l.target.blur()},["enter"])),"aria-label":p(n)("geosearch.searchText"),onKeypress:e[2]||(e[2]=A(P(()=>{},["prevent"]),["enter"])),enterkeyhint:"done"},null,42,se),o("span",re,[v.value?k((a(),t("button",{key:0,class:"cursor-default","aria-label":p(n)("geosearch.badChars",{chars:v.value}),content:p(n)("geosearch.badChars",{chars:v.value})},e[3]||(e[3]=[R(" \u26A0 ")]),8,oe)),[[u]]):_("",!0)])])}}}),ce={class:"rv-geosearch-top-filters sm:flex items-center w-full ml-8 mb-14"},ie={class:"w-fit inline-block sm:w-1/2 h-26 mb-8 sm:mb-0 pr-16 sm:pr-0"},ue=["value","aria-label"],pe={value:"",disabled:"",hidden:""},be={class:"sm:w-1/2 h-26 sm:mx-16 flex"},ve=["value","aria-label"],de={value:"",disabled:"",hidden:""},he=["disabled","content","aria-label"],ge=M({__name:"top-filters",setup(T){const{t:n}=E(),i=j("iApi"),c=S(),f=z([]),v=z([]),m=z([]),d=x(()=>c.queryParams),h=x(()=>i.language),e=b=>c.setProvince(b),u=b=>c.setType(b),l=()=>{e({}),u({})},w=()=>{c.initService(i.language,i.fixture.get("geosearch").config);const b=f.value.find(r=>d.value.province===r.name)?.code,g=v.value.find(r=>d.value.type===r.name)?.code;c.getProvinces.then(r=>{f.value=r,e({province:r.find(L=>L.code===b)?.name,forceReRun:!0})}),c.getTypes.then(r=>{v.value=r,u({type:r.find(L=>L.code===g)?.name,forceReRun:!0})})};return O(()=>{w(),m.value.push(U(h,w))}),$(()=>{m.value.forEach(b=>b())}),(b,g)=>{const r=C("truncate"),L=C("tippy");return a(),t("div",ce,[o("div",ie,[k((a(),t("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer",value:d.value.province,"aria-label":p(n)("geosearch.filters.province"),onChange:g[0]||(g[0]=s=>e({province:s.target.value}))},[k((a(),t("option",pe,[R(y(p(n)("geosearch.filters.province")),1)])),[[r]]),(a(!0),t(V,null,q(f.value,s=>k((a(),t("option",{key:s.code},[R(y(s.name),1)])),[[r]])),128))],40,ue)),[[r]])]),o("div",be,[k((a(),t("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer max-w-150",value:d.value.type,"aria-label":p(n)("geosearch.filters.type"),onChange:g[1]||(g[1]=s=>u({type:s.target.value}))},[o("option",de,y(p(n)("geosearch.filters.type")),1),(a(!0),t(V,null,q(v.value,s=>(a(),t("option",{key:s.code},y(s.name),1))),128))],40,ve)),[[r]]),k((a(),t("button",{type:"button",class:"text-gray-500 w-1/8 h-24 pl-8 pr-16 sm:pr-8 hover:text-black disabled:cursor-default disabled:text-gray-400",disabled:!d.value.type&&!d.value.province,onClick:l,content:p(n)("geosearch.filters.clear"),"aria-label":p(n)("geosearch.filters.clear")},g[2]||(g[2]=[o("div",{class:"rv-geosearch-icon"},[o("svg",{class:"fill-current w-18 h-18",viewBox:"0 0 23 21"},[o("path",{d:"M 14.7574,20.8284L 17.6036,17.9822L 14.7574,15.1716L 16.1716,13.7574L 19.0178,16.568L 21.8284,13.7574L 23.2426,15.1716L 20.432,17.9822L 23.2426,20.8284L 21.8284,22.2426L 19.0178,19.3964L 16.1716,22.2426L 14.7574,20.8284 Z M 2,2L 19.9888,2.00001L 20,2.00001L 20,2.01122L 20,3.99999L 19.9207,3.99999L 13,10.9207L 13,22.909L 8.99999,18.909L 8.99999,10.906L 2.09405,3.99999L 2,3.99999L 2,2 Z "})])],-1)]),8,he)),[[L,{placement:"bottom"}]])])])}}}),fe={class:"rv-geosearch-bottom-filters"},me={class:"bg-white"},ye={class:"ml-8 cursor-pointer font-normal"},xe=["checked"],we=M({__name:"bottom-filters",setup(T){const{t:n}=E(),i=j("iApi"),c=S(),f=x(()=>c.resultsVisible),v=K(300,e=>{d(e).then(u=>{m({extent:u,visible:f.value})})}),m=e=>{c.setMapExtent(e)},d=async e=>e.sr.wkid===4326?e:await i.geo.proj.projectGeometry(4326,e),h=e=>{d(i.geo.map.getExtent()).then(u=>{m({extent:u,visible:e})})};return X(()=>{i.event.on(F.MAP_EXTENTCHANGE,v,"geosearch_map_extent")}),$(()=>{i.event.off("geosearch_map_extent")}),(e,u)=>(a(),t("div",fe,[o("div",me,[o("label",ye,[o("input",{type:"checkbox",class:"border-2 mx-8 border-gray-600 cursor-pointer",checked:f.value,onChange:u[0]||(u[0]=l=>h(l.target.checked)),onKeypress:u[1]||(u[1]=A(P(()=>{},["prevent"]),["enter"]))},null,40,xe),R(y(p(n)("geosearch.visible")),1)])])]))}}),Le={},ke={class:"w-full h-6 relative overflow-hidden rounded-full indeterminate mb-14"},_e={class:"h-full progressbar bg-blue-800 rounded-full top-0","aria-valuemin":"0","aria-valuemax":"100"},Re={class:"flex items-center h-full"};function Te(T,n){return a(),t("div",ke,[o("div",_e,[o("span",Re,[W(T.$slots,"default",{},void 0,!0)])])])}const Ce=Q(Le,[["render",Te],["__scopeId","data-v-0a8d1c36"]]),Me={class:"flex flex-col h-full"},Ee={key:1,class:"text-red-900 text-xs px-8 mb-10"},Se={key:2,class:"px-8 mb-10 py-8 flex-grow text-wrap border-y border-gray-600 overflow-y-auto"},Ae={class:"relative h-48"},je={class:"font-bold text-blue-600"},ze={key:3,class:"rv-results-list flex-grow mb-5 border-t border-b border-gray-600 overflow-y-auto"},Ve=["onClick"],qe={class:"rv-result-description px-8"},Ge={class:"flex-1 text-left truncate font-bold leading-tight"},Ke=["innerHTML"],Pe={key:0,class:"text-gray-600 text-sm"},$e={key:1,class:"hidden"},He={key:2,class:"text-sm font-normal"},Ne=M({__name:"screen",props:{panel:{type:Object}},setup(T){const{t:n}=E(),i=j("iApi"),c=S(),f=x(()=>c.searchVal.replace(/["!*$+?^{}()|[\]\\]/g,"").trim()),v=x(()=>c.searchResults),m=x(()=>c.loadingResults),d=x(()=>c.failedServices),h=x(()=>c.GSservice.config.fsaUrl),e=async l=>{if(l.flav==="fsa"&&h.value){const b=h.value.replace(ee,l.name),[g,r]=await ae(le(b));if(!g){const L=new B("fsazoom",r.features[0].geometry.rings,I.fromConfig(r.spatialReference),!0);i.geo.map.zoomMapTo(L);return}}const w=new B("zoomies",[[[l.bbox[0],l.bbox[1]],[l.bbox[0],l.bbox[3]],[l.bbox[2],l.bbox[3]],[l.bbox[2],l.bbox[1]],[l.bbox[0],l.bbox[1]]]],I.latLongSR(),!0);i.geo.map.zoomMapTo(w)},u=(l,w)=>{const b=l.replace(new RegExp(`${c.searchRegex}`,"gi"),g=>'<span class="font-bold text-blue-600">'+g+"</span>");return w?b+",":b};return(l,w)=>{const b=Y("panel-screen"),g=C("truncate"),r=C("focus-item"),L=C("focus-list");return a(),H(b,{panel:T.panel},{header:N(()=>[R(y(p(n)("geosearch.title")),1)]),content:N(()=>[o("div",Me,[G(ne),G(ge),m.value?(a(),H(Ce,{key:0,class:"flex-none"})):_("",!0),d.value.length>0&&!m.value?(a(),t("div",Ee,y(p(n)("geosearch.serviceError",{services:d.value.join(", ")})),1)):_("",!0),f.value&&v.value.length===0&&!m.value?(a(),t("div",Se,[o("span",Ae,[R(y(p(n)("geosearch.noResults")),1),o("span",je,'"'+y(f.value)+'"',1)])])):_("",!0),v.value.length>0?k((a(),t("ul",ze,[(a(!0),t(V,null,q(v.value,(s,D)=>(a(),t("li",{class:"relative h-56",key:D},[k((a(),t("button",{type:"button",class:"absolute inset-0 h-full w-full hover:bg-gray-300 default-focus-style",onClick:Be=>e(s),style:{"border-bottom":"1px solid lightgray"},"truncate-trigger":""},[o("div",qe,[k((a(),t("div",Ge,[o("span",{innerHTML:u(s.name,s.location.province)},null,8,Ke),s.location.province?(a(),t("span",Pe,y(s.location.city?" "+s.location.city+", "+s.location.province.abbr:" "+s.location.province.abbr),1)):_("",!0),s.type?(a(),t("span",$e,"; ")):_("",!0),s.type?(a(),t("span",He,[w[0]||(w[0]=o("br",null,null,-1)),R(y(s.type),1)])):_("",!0)])),[[g,{externalTrigger:!0,options:{placement:"top-start"}}]])])],8,Ve)),[[r,"show-truncate"]])]))),128))])),[[L]]):_("",!0),G(we,{class:"mt-auto"})])]),_:1},8,["panel"])}}});export{Ne as default};
