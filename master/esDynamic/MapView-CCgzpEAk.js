import{x as r,z as l,K as v,aX as Ei,G as Ii,bC as L,gD as ve,B as ur,D as mr,bG as Ze,aP as wt,b5 as gr,b6 as ds,aM as _,df as G,jo as Wt,aL as M,V as k,n as I,kz as st,l as oe,fw as yr,a7 as qt,aY as U,l5 as fr,l6 as vr,l7 as ps,fG as Di,s as T,a_ as Ri,T as De,l8 as _r,ea as wr,L as jt,A as br,g3 as Li,aO as Bt,dm as ae,u as us,gA as Mr,U as ms,a as Vi,fx as A,b_ as Kt,fM as Tr,kX as Ge,dk as gs,ax as xr,dq as ys,l9 as Sr,b$ as bt,aK as Ue,dx as Pr,cQ as kr,la as Mt,Y as Cr,id as Er,N as Ir,gr as Oi,g5 as Dr,hb as fs,fv as vs,aH as Tt,aN as We,Q as re,j as _s,fz as Rr,bh as $t,ej as Lr,bz as qe,M as Yt,cp as ws,bj as bs,cZ as Ms,bR as Ts,d1 as Ai,S as xs,bB as Vr,lb as Or,dF as zi,hP as Ni,lc as Ss,bO as Ps,J as ks,ct as Ar,d5 as ee,ld as zr,iM as Xt,hs as Y,hr as Nr,iz as Fr,iA as Hr,c1 as Qt,aF as Zr,c_ as Gr,hm as Ur,le as Cs,b4 as Wr,aD as qr,k3 as jr,_ as Br,d0 as Kr,cB as $r,an as Yr,eP as Es,bq as Xr}from"./main-BC8gbEPx.js";import{a as Qr}from"./Cyclical-CC0J6X0n.js";import{n as Is}from"./CollectionFlattener-DPHx6q8P.js";import{m as Jr}from"./workers-BT3Yd1UI.js";import{k as Fi,L as Hi,O as xt,K as Zi,U as el}from"./projection-CS2SYuKw.js";import{p as tl,z as il}from"./TileInfo-DcHqeHqG.js";import{B as Ds,C as Rs,D as Ls,w as nl,r as sl,F as ol,h as Jt,O as ei,k as q,j as Gi,p as al}from"./themeUtils-DY08l3uv.js";import{h as ti}from"./UpdatingHandles-MKkd7IEO.js";import{s as Vs}from"./Queue-D8tg3nfz.js";import{r as rl}from"./signal-UgirE0-u.js";import ll from"./Map-Btes3TVA.js";import{n as hl,c as Os,l as As}from"./GraphicsCollection-BklkIiuY.js";import{v as ii}from"./HeightModelInfo-Dc4yjNqE.js";import{p as cl}from"./TimeExtent-B3UXB00l.js";import{p as dl}from"./timeZoneUtils-dvSLdrBh.js";import{f as pl}from"./Layer-CMe3ITJC.js";import{n as Ui}from"./TablesMixin-5GooUtvX.js";import{s as ul}from"./ReactiveMap-BESY4FLW.js";import{b as zs}from"./Query-BDnleJ4k.js";import{c as Ns,e as ml,r as gl,l as yl,n as fl,t as vl,a as _l,m as wl,p as bl}from"./HighlightDefaults-OPxBBZpm.js";import{l as Fs}from"./ViewingMode-CyR_b1T8.js";import{x as Ml,l as ni,o as z,e as Wi,v as Hs,y as Tl,j as xl,q as Zs,B as Gs,S as _e,r as St,u as Sl,m as Pl}from"./vec2-BnynUbeJ.js";import{t as kl,n as V}from"./vec2f64-CEUyUoff.js";import{u as Us,e as qi}from"./common-CYWrYyJl.js";import{l as Ws,c as ji,f as qs,a as si,M as Cl,m as El,u as js,n as Il,i as Dl,k as Bs,s as Rl,h as Ll}from"./Tile-CVY6CM6q.js";import{P as Bi,v as Vl}from"./normalizeUtils-BcS9eell.js";import{r as Ol,o as Al,M as Ks,h as zl,i as Nl}from"./mat3-DOnW3DjW.js";import{t as $s}from"./vec2f32-CVhmN3Me.js";import{I as Fl,a as oi}from"./Scheduler-D6n_mU38.js";import{g as Hl}from"./vec32-CKLwdlap.js";import{t as ai}from"./unitBezier-DhyPAQO8.js";import{e as Zl}from"./TileKey-BqqXrsHm.js";import{I as Gl,K as Ul,V as ri,a as Ys}from"./definitions-CBIQmVpq.js";import{D as Wl,O as ql,I as Ki}from"./enums-DBi1-Mm2.js";import{p as jl,w as Bl}from"./Texture-CgORJFQB.js";import{s as Kl}from"./imageUtils-C_u_Ltxa.js";import{t as $l}from"./capabilities-B7_EbmeV.js";import"./intl-BsAxaYOa.js";import{r as Yl}from"./Version-DuuTxrb9.js";import Xl from"./ColorBackground-Dvpwczny.js";let je=class extends Ei{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};r([l({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],je.prototype,"row",void 0),r([l({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],je.prototype,"column",void 0),r([l({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],je.prototype,"rows",void 0),r([l({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],je.prototype,"columns",void 0),je=r([v("esri.CameraLayout")],je);const Xs=je;let pe=class extends Ei.ClonableMixin(Ii){constructor(...e){super(...e),this.position=new L([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new Xs}normalizeCtorArgs(e,t,i,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),n!=null&&(s.fov=n),s}return e}writePosition(e,t,i,n){const s=e.clone();s.x=ve(e.x||0),s.y=ve(e.y||0),s.z=e.hasZ?ve(e.z||0):e.z,t[i]=s.write({},n)}readPosition(e,t){const i=new L;return i.read(e,t),i.x=ve(i.x||0),i.y=ve(i.y||0),i.z=i.hasZ?ve(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};r([l({type:L,json:{write:{isRequired:!0}}})],pe.prototype,"position",void 0),r([ur("position")],pe.prototype,"writePosition",null),r([mr("position")],pe.prototype,"readPosition",null),r([l({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Ze(e=>Qr.normalize(ve(e)))],pe.prototype,"heading",void 0),r([l({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Ze(e=>wt(ve(e),-180,180))],pe.prototype,"tilt",void 0),r([l({type:Number,nonNullable:!0,json:{default:55,write:!0}}),Ze(e=>wt(ve(e,55),1,170))],pe.prototype,"fov",void 0),r([l({type:Xs,nonNullable:!0,json:{read:!1,write:!1}})],pe.prototype,"layout",void 0),pe=r([v("esri.Camera")],pe);const Ql=pe;var $i;let Re=$i=class extends Ii{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new $i({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};r([l({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Yi}}}}})],Re.prototype,"rotation",void 0),r([Ze("rotation")],Re.prototype,"castRotation",null),r([l({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Yi}}}}})],Re.prototype,"scale",void 0),r([l({types:gr,json:{read:ds,write:!0,origins:{"web-scene":{read:ds,write:{overridePolicy:Yi}}}}})],Re.prototype,"targetGeometry",void 0),r([l({type:Ql,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}})],Re.prototype,"camera",void 0),Re=$i=r([v("esri.Viewpoint")],Re);const X=Re;function Yi(){return{enabled:!this.camera}}const li={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,n=this.values;return t<=i.xsmall?n.xsmall:t<=i.small?n.small:t<=i.medium?n.medium:t<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,n=this.values;return t<=i.xsmall?n.xsmall:t<=i.small?n.small:t<=i.medium?n.medium:t<=i.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],n=t[1],s=this.values;return n>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Xi={xsmall:544,small:768,medium:992,large:1200};function Jl(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function Qi(e,t){return t?li[e].valueToClassName[t].split(" "):[]}const eh=e=>{let t=class extends e{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Xi}initialize(){this.addHandles(_(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),G))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!Jl(i)){const n=JSON.stringify(Xi,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n),i=Xi}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=Wt.acquire(),n=Wt.acquire();let s,o=!1;for(s in li){const a=this[s],h=li[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==h&&(o=!0,this[s]=h,Qi(s,a).forEach(c=>n.push(c)),Qi(s,h).forEach(c=>i.push(c)))}o&&(this._applyClassNameChanges(i,n),Wt.release(i),Wt.release(n))}_applyClassNameChanges(i,n){const s=this.container;s&&(n.forEach(o=>s.classList.remove(o)),i.forEach(o=>s.classList.add(o)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let n;for(n in li)Qi(n,this[n]).forEach(s=>i.classList.remove(s))}};return r([l()],t.prototype,"breakpoints",null),r([l()],t.prototype,"orientation",void 0),r([l()],t.prototype,"widthBreakpoint",void 0),r([l()],t.prototype,"heightBreakpoint",void 0),t=r([v("esri.views.BreakpointsOwner")],t),t};let Le=class extends M{constructor(){super(...arguments),this.items=new k,this._watchUpdatingTracking=new ti,this._callbacks=new Map,this._projector=Ds(),this._hiddenProjector=Ds()}get needsRender(){return this.items.length>0}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(const i of t.removed){const n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);i.append(t,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n?.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return o}overlaps(e,t){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,t){const i=!!t?.disableDecorations;if(!this.items.some(s=>s.visible&&!(i&&s.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(s=>{i&&s.isDecoration||(n.save(),s.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};r([l({readOnly:!0})],Le.prototype,"surface",void 0),r([l({readOnly:!0})],Le.prototype,"items",void 0),r([l({readOnly:!0})],Le.prototype,"needsRender",null),r([l({readOnly:!0})],Le.prototype,"_watchUpdatingTracking",void 0),r([l({readOnly:!0})],Le.prototype,"updating",null),Le=r([v("esri.views.overlay.ViewOverlay")],Le);const Qs=Le,Ji=[0,0];function th(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return Ji[0]=i.left+(t?.pageXOffset??0),Ji[1]=i.top+(t?.pageYOffset??0),Ji}function Js(e){e&&(e.textContent="",e.parentNode&&e.parentNode.removeChild(e))}function ih(e){const t=document.createElement("div");return e.appendChild(t),t}const ot=16,Pt=750,nh=512,sh=2,oh=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:ot,time:Pt},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([_(()=>this.cursor,n=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",n)}),_(()=>this.navigating,n=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",n.toString())})])}initialize(){this.addHandles([_(()=>this.ui,(i,n)=>this._handleUIChange(i,n),G),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(i){const n=this._get("container"),s=Rs(i);if(s||typeof i!="string"||I.getLogger(this).error("#container",`element with id '${i}' not found`),n===s)return;if(this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Js(this.root),this._set("root",null)),this.userContent&&(Ls(this.userContent,n),Js(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const o=document.createElement("div");o.className="esri-view-user-storage",Ls(s,o),s.appendChild(o),this._set("userContent",o);const a=document.createElement("div");a.className="esri-view-root",s.insertBefore(a,s.firstChild),this._set("root",a);const h=document.createElement("div");h.className="esri-view-surface",h.setAttribute("role","application"),h.tabIndex=0,a.appendChild(h),this._set("surface",h);const c=new Qs;a.appendChild(c.surface),this._set("overlay",c),this.addHandles(_(()=>c.needsRender,d=>{d&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=st({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=oe(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(i,n,s){const o=this.position;return i-=o?o[0]:0,n-=o?o[1]:0,s?(s[0]=i,s[1]=n):s=[i,n],s}containerToPage(i,n,s){const o=this.position;return i+=o?o[0]:0,n+=o?o[1]:0,s?(s[0]=i,s[1]=n):s=[i,n],s}_handleUIChange(i,n){this.removeHandles("ui"),n&&n!==i&&n.destroy(),i&&(i.view=this,this.addHandles(_(()=>this.root,s=>{i.container=s?ih(s):null},G),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=ot,i.time=Pt;const n=st({prepare:a=>{const h=this._measure(),c=this._freqInfo;if(c.time+=a.deltaTime,h&&(c.freq=ot,this._get("resizing")||this._set("resizing",!0)),c.time<c.freq)return;c.time=0;const d=this._position();c.freq=d||h?ot:Math.min(Pt,c.freq*sh),!h&&c.freq>=nh&&(n.pause(),this._get("resizing")&&this._set("resizing",!1))}}),s=new ResizeObserver(a=>{i.freq=ot,i.time=Pt,n.resume()});this.container!=null&&s.observe(this.container);const o=qt(()=>s.disconnect());this.addHandles([yr(window,"resize",()=>{i.freq=ot,i.time=Pt,n.resume()}),o,n],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,n=i?i.clientWidth:0,s=i?i.clientHeight:0;if(n===0||s===0)return this.suspended||this._set("suspended",!0),!1;const o=this.width,a=this.height;return n===o&&s===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",n),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:o,oldHeight:a,width:n,height:s}),!0)}_position(){const i=this.container,n=this.position,s=i&&th(i);return!!s&&(!n||s[0]!==n[0]||s[1]!==n[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return r([l()],t.prototype,"container",null),r([l({readOnly:!0})],t.prototype,"focused",null),r([l({readOnly:!0})],t.prototype,"height",void 0),r([l()],t.prototype,"messagesCommon",void 0),r([l({type:Qs})],t.prototype,"overlay",void 0),r([l({readOnly:!0})],t.prototype,"position",void 0),r([l({readOnly:!0})],t.prototype,"resizing",void 0),r([l({readOnly:!0})],t.prototype,"root",void 0),r([l({value:null,readOnly:!0})],t.prototype,"size",null),r([l({readOnly:!0})],t.prototype,"surface",void 0),r([l({readOnly:!0})],t.prototype,"suspended",void 0),r([l({nonNullable:!0})],t.prototype,"ui",void 0),r([l({readOnly:!0})],t.prototype,"userContent",void 0),r([l({readOnly:!0})],t.prototype,"width",void 0),r([l()],t.prototype,"widthBreakpoint",void 0),t=r([v("esri.views.DOMContainer")],t),t},eo=U("mac")?"Meta":"Control",ah=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),rh=e=>ah.has(e);let lh=class{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const t=e.modifiers;for(const i of this.keyModifiers)if(!t.has(i))return!1;return!0}},O=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const i of t)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(t=>this._handleEvent(t)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;typeof t=="function"?(i=t,n=[]):n=t||[];const s=typeof e=="string"?new lh(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=d=>{const p=this._incoming[d.match.eventType];if(p){const m=p.indexOf(d);p.splice(m,1),o(),this._manager&&this._manager.updateDependencies()}},h=new hh(s,i,{onPause:a,onRemove:a,onResume:d=>{const p=this._incoming[d.match.eventType];p&&!p.includes(d)&&(p.push(d),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(h),o(),this._manager&&this._manager.updateDependencies(),h}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new ch(e,{onEmit:(i,n,s,o)=>{this._manager?.emit(i.eventType,n,s,o)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager?.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager?.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager?.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){const t=this._incoming[e.type];if(t){for(const i of t)if(i.match.matches(e)&&(i.callback?.(e),e.shouldStopPropagation()))break}}},hh=class{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},ch=class{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},dh=class extends O{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",t=>this._update(t.data))}_update(e){const t=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=e;t===this._value&&this._x===i&&this._y===n||(this._value=t,this._x=i,this._y=n,this._onChange(t,i,n))}},ph=class extends O{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=rl(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},to=class{constructor(e,t){this._owner=t,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new fr(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=vr(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const t=this._properties[e];for(const i of t.acquired)ps(i)||t.pool.release(i);t.pool.destroy(),t.pool=null,t.acquired=null}this._properties=null,this._owner=null}get(e){const t=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===t;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this._properties){const t=this._properties[e];let i=0;for(const n of t.acquired)ps(n)?t.acquired[i++]=n:t.pool.release(n);t.acquired.length=i}}},te=class extends M{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=eo,this._latestPointerType="mouse",this._propertiesPool=new to({latestPointerLocation:gh},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,t,i=we.INTERNAL){if(this._nameToGroup[e]||t.length===0)return;const n={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,h,c,d,p)=>{this._emitInputEvent(o.priorityIndex+1,a,h,c,p,d)},setPointerCapture:(a,h)=>{this._setPointerCapture(n,o,a,h)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback?.()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):I.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)rh(a)||t.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==t||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,n=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,n)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const n=()=>{i||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),i=!0)},s=(a,h)=>{h&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!h&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=t.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=t.native;s("Alt",!!o?.altKey),s("Control",!!o?.ctrlKey),s("Ctrl",!!o?.ctrlKey),s("Shift",!!o?.shiftKey),s("Meta",!!o?.metaKey),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new dh((e,t,i)=>this._setLatestPointer(e,t,i)),this._multiTouchHandler=new ph,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],we.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,we.INTERNAL)}_setPointerCapture(e,t,i,n){const s=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,n){this._emitInputEvent(0,e,t,i,n)}_emitInputEvent(e,t,i,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),h=s!==void 0&&s,c={event:new uh(t,i,a,o||this._activeKeyModifiers,h),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new Vs,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:t,priorityIndex:i}=e.events.pop(),n=t.data?.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback?.(t),t.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new Vs;t.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)t.push(i.events.pop());i.events=t,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of t.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let n=0;for(;n<t.length&&this._compareHandlerPriority(i,t[n])>=0;)n++;t.splice(n,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>this._onEventReceived(t,i))},disablePointerCapture:e}}};r([l({readOnly:!0})],te.prototype,"hasPendingInputs",null),r([l({constructOnly:!0})],te.prototype,"eventSource",void 0),r([l({constructOnly:!0})],te.prototype,"recognizers",void 0),r([l()],te.prototype,"_latestPointerType",void 0),r([l()],te.prototype,"latestPointerType",null),r([l()],te.prototype,"multiTouchActive",null),r([l({readOnly:!0})],te.prototype,"latestPointerLocation",void 0),r([l()],te.prototype,"_paused",void 0),r([l({readOnly:!0})],te.prototype,"updating",null),te=r([v("esri.views.input.InputManager")],te);let uh=class{constructor(e,t,i,n,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=Ve.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Ve.STOPPED}shouldStopPropagation(){return!!(this._propagationState&Ve.STOPPED)}async(e){this._propagationState|=Ve.PAUSED;const t=(i,n)=>{this._propagationState&=~Ve.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof e=="function"?e():e).then(i=>t(i,!1),i=>t(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&Ve.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Ve;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(Ve||(Ve={}));const we={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let mh=class{};const gh=mh;function Oe(e){return e!=null&&"open"in e&&"declaredClass"in e}function io(e){return e!=null&&"declaredClass"in e&&"dockOptions"in e}const yh=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([_(()=>[this.ui,this.popup],([i,n],s)=>{const o="popup",a="manual";if(s){const[h,c]=s;h&&Oe(c)&&(c.view=null,io(c)&&h.remove(c,o))}i&&Oe(n)&&(n.view=this,io(n)&&i.add(n,{key:o,position:a,internal:!0}))},G),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(Oe(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),Oe(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},we.WIDGET)]),Di(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{import("./Popup-DkngdDNQ.js").then(i=>i.P)})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(Oe(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void I.getLogger(this).error(new T("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){this._popupSetupTask?.abort(),Oe(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,n){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,n),n)}async setupPopup(){if(this._popupSetupTask?.abort(),this.popup&&!Oe(this.popup))return this._popupSetupTask=Ri(async i=>{const{default:n}=await import("./Popup-DkngdDNQ.js").then(o=>o.P);if(De(i),!this.popup||Oe(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new n(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:n},s){const o=[],a=[];let h=!1;const c=_r(s,U("popup-view-fetch-timeout")??vh),d=u=>{const g=new fh(u);return a.push(g),o.push(g.promise),g},p=u=>{const g=a.at(-1);return g&&g.layerView===u&&!h?g:d(u)};for(const u of n)"graphic"in u?(p(u.layerView).graphics.push(u.graphic),h=!1):(o.push(u.layerView.fetchPopupFeaturesAtLocation(u.mapPoint,c)),h=!0);a.map(u=>u.resolve(c));const m=wr(o).then(u=>u.filter(g=>!!g).flat());return{pendingFeatures:o,allGraphicsPromise:m,location:i}}async _getPopupHits(i,n){const{hits:s,location:o}=await this.popupHitTest(i);De(n);const a=[];for(const h of s)if("graphic"in h){if(this._isValidPopupGraphic(h.graphic,n)){const c=this._isValidPopupGraphicsLayerView(h.layerView)?h.layerView:void 0;a.push({graphic:h.graphic,layerView:c})}}else this._isValidPopupLocationLayerView(h.layerView)&&a.push({mapPoint:h.mapPoint,layerView:h.layerView});return{hits:a,location:o}}_isValidPopupGraphic(i,n){return i&&!!i.getEffectivePopupTemplate(n?.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return r([l()],t.prototype,"popup",void 0),r([l()],t.prototype,"popupEnabled",void 0),t=r([v("esri.views.PopupView")],t),t};let fh=class{constructor(e){this.layerView=e,this._resolver=jt(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:t,graphics:i,_resolver:n}=this;if(!t)return n.resolve(i),n.promise;let s;return t.fetchPopupFeaturesFromGraphics(i,e).catch(o=>(s=o,null)).then(o=>{o?n.resolve(o):n.reject(s)}),n.promise}};const vh=5e3;let hi=class extends hl{constructor(e){super(e),this.addHandles(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(I.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};hi=r([v("esri.support.AnalysesCollection")],hi);let Ae=class extends M{constructor(e){super(e),this.view=null,this.baseLayerViews=new k,this.referenceLayerViews=new k,this._loadingHandle=_(()=>this.view?.map?.basemap,t=>{t&&t.load().catch(()=>{})},G)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return this.view?.suspended??!0}get updating(){return this.view?.suspended?!1:!!this.view?.map?.basemap?.loaded&&(this.baseLayerViews.some(e=>e.updating)||this.referenceLayerViews.some(e=>e.updating))}};r([l({constructOnly:!0})],Ae.prototype,"view",void 0),r([l({readOnly:!0})],Ae.prototype,"baseLayerViews",void 0),r([l({readOnly:!0})],Ae.prototype,"referenceLayerViews",void 0),r([l({readOnly:!0})],Ae.prototype,"suspended",null),r([l({type:Boolean,readOnly:!0})],Ae.prototype,"updating",null),Ae=r([v("esri.views.BasemapView")],Ae);const _h=Ae;function wh(e){return"tryRecycleWith"in e}function bh(e){return e!=null&&typeof e=="object"&&"layerViews"in e}let Mh=class{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=jt(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Vi(this._controller.signal,()=>{const n=new T("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!wh(this.layerView))return null;const t=this.layer.type,i=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==t)continue;const o=this.layerView.tryRecycleWith(s,{signal:i});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,h=a.view;return this.promise=Promise.race([o.then(()=>(De(this._controller.signal),s.emit("layerview-destroy",{view:h,layerView:a}),h.emit("layerview-destroy",{view:h,layerView:a}),s.emit("layerview-create",{view:h,layerView:a}),h.emit("layerview-create",{view:h,layerView:a}),a)),new Promise((c,d)=>Vi(this._controller.signal,()=>d(us())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{let n,s;if(await t.load({signal:e}),t.prefetchResources&&await t.prefetchResources({signal:e}),xh(t))n=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new T("layer:view-not-supported","No layerview implementation was found");const a=await this.layerViewImporter.importLayerView(t);De(e),n="default"in a?new a.default({layer:t,view:i}):new a({layer:t,view:i})}const o=()=>{s=oe(s),n.destroyed||n.destroy(),n.layer=null,n.parent=null,n.view=null,this.done=!0};s=Vi(e,o),De(e);try{await n.when()}catch(a){throw o(),a}if(!this._map?.allLayers?.includes(t))return o(),void this._deferred.reject(new T("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=n,t.emit("layerview-create",{view:i,layerView:n}),i.emit("layerview-create",{layer:t,layerView:n}),this.done=!0,this._deferred.resolve(n)}catch(n){t.emit("layerview-create-error",{view:i,error:n}),i.emit("layerview-create-error",{layer:t,error:n}),this.done=!0,this._deferred.reject(new T("layerview:create-error","layerview creation failed",{layer:t,error:n}))}}},ie=class extends M{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new ti,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const t=this.view.map?.allLayers;if(t)for(const i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=jt(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(br(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{if(this.destroyed)return;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,n=[],s=this.view.ready,o=h=>{if(h!=null){for(const c of h)if(c){i.add(c);const d=this._layerLayerViewInfoMap.get(c);d&&s?d.start():d||this._recyclingInfoMap.has(c)||n.push(c),"layers"in c&&c.layers&&o(c.layers)}}};for(const h of this._rootCollectionNames)o(Li(this,h));for(const[h,c]of this._layerLayerViewInfoMap)if(!i.has(h)){this._layerLayerViewInfoMap.delete(c.layer);const d=c.tryRecycle(n);d?(this.notifyChange("updating"),this._recyclingInfoMap.set(c.layer,c),d.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),this._layerLayerViewInfoMap.set(c.layer,c),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy(),this._reschedule()})):c.destroy()}for(const[h,c]of this._recyclingInfoMap)i.has(h)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(c.layer),c.destroy());for(const h of n)this._createLayerView(h);this._refreshCollections();const a=[t?.ground?.layers,t?.basemap?.baseLayers,t?.basemap?.referenceLayers,t?.layers].filter(h=>!!h);i.forEach(h=>"layers"in h&&a.push(h.layers)),this.addHandles(a.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Bt(()=>this.view?.map?.allLayers,"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),_(()=>{const e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]},()=>this._reschedule(),ae)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),Ui(this._recyclingInfoMap),Ui(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(us()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Mr(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(Ui(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new T("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,t){this.commitProperty("updatingRemaining");const i=this._layerLayerViewInfoMap.get(e);if(!i?.done)return!0;const n=i.layerView;return!(!n||!t||n.parent===t)||!!(i.done&&n&&"layers"in e&&e.layers?.length)&&e.layers.some(s=>this.isCreatingLayerViewsForLayer(s,n))}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(Li(this,e),Li(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o?.layerView)continue;const a=o.layerView;a.layer=s,a.parent=i,t.at(n)!==a&&t.splice(n,0,a),"layers"in s&&bh(a)&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<t.length&&t.splice(n,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Mh(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{i&&(ms(i)||i.name==="cancelled:layerview-create")||I.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};r([l()],ie.prototype,"_workPromise",void 0),r([l({readOnly:!0})],ie.prototype,"_watchUpdatingTracking",void 0),r([l({readOnly:!0})],ie.prototype,"_layersToLayerViews",null),r([l({readOnly:!0})],ie.prototype,"_rootCollectionNames",null),r([l()],ie.prototype,"layerViewImporter",void 0),r([l()],ie.prototype,"supportsGround",void 0),r([l({readOnly:!0})],ie.prototype,"updating",null),r([l({readOnly:!0})],ie.prototype,"updatingRemaining",null),r([l({constructOnly:!0})],ie.prototype,"view",void 0),ie=r([v("esri.views.LayerViewManager")],ie);const Th=ie;function xh(e){return e.createLayerView!==pl.prototype.createLayerView}let Q=class extends M{constructor(e){super(e),this.factor=1.5,this.offset=A(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};r([l({type:Number})],Q.prototype,"factor",void 0),r([l({nonNullable:!0})],Q.prototype,"offset",void 0),r([l()],Q.prototype,"position",void 0),r([l({type:Number,range:{min:0}})],Q.prototype,"size",void 0),r([l()],Q.prototype,"maskUrl",void 0),r([l()],Q.prototype,"maskEnabled",void 0),r([l()],Q.prototype,"overlayUrl",void 0),r([l()],Q.prototype,"overlayEnabled",void 0),r([l({readOnly:!0})],Q.prototype,"version",null),r([l({type:Boolean})],Q.prototype,"visible",void 0),Q=r([v("esri.views.Magnifier")],Q);const no=Q;function ci(e){return!!(e!=null&&typeof e=="object"&&"createQuery"in e&&e.createQuery&&"on"in e&&e.on)}let ue=class extends Kt.EventedAccessor{constructor(e){super(e),this._selectionMap=new ul,this._sources=new k,this._trashCan=[],this._layerEditHandles=new k,this._vizTaskId=0,this.showHighlight=!0,this.highlightName="default"}initialize(){this.addHandles([_(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),Bt(()=>this.sources,"change",t=>{const i=this._selectionMap;for(const n of t.removed)i.delete(n);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new k;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(t=>"sublayers"in t&&t.sublayers?t.sublayers:null).forEach(t=>{(ci(t)&&!Tr(t)||Ge(t))&&e.add(t)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(oe)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[t,i]=e;return{layer:t,selection:[...i.selection]}})}get count(){let e=0;for(const t of this._selectionMap.values())e+=t.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){gs(e,this._sources)}async getSelectedFeatures(e,t={},i="layerView"){const{view:n,selections:s}=this,o=(e!==void 0?s.filter(a=>e.includes(a.layer)):s).filter(a=>a.selection.length>0).map(async a=>{const{layer:h,selection:c}=a,d=Ge(h)?h.parent:h;if(d==null||!oo(d))return null;if(i==="layer")return ao(d,c,t);if(so(d))return null;const p=await n.whenLayerView(d).catch(()=>null);return p?ao(p,c,t):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const t=new Map;for(const[s,o]of this._selectionMap)t.set(s,[...o.selection]);let i=!1;const n=e.current.concat(e.added);for(const s of n){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(ci(o)||Ge(o))&&a!==null){const h=xr(t,o,()=>[]);h.includes(a)||(h.push(a),i=!0)}}for(const s of e.removed){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(ci(o)||Ge(o))&&a!==null){const h=t.get(o),c=h?.indexOf(a);c!==void 0&&c>=0&&(h?.splice(c,1),i=!0)}}if(i){const{_selectionMap:s,_trashCan:o}=this,a=[];for(const[h,c]of t){const d=s.get(h);d!==void 0&&o.push(d),s.set(h,{selection:c}),a.push({layer:h,selection:c,...ys(d!==void 0?d.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,t){this._setSelection(e,t)}getSelection(e){return this._selectionMap.get(e)?.selection}appendToSelection(e,t){const i=this._selectionMap.get(e),n=i!==void 0?[...i.selection]:[];for(const s of t)n.includes(s)||n.push(s);this._setSelection(e,n)}removeFromSelection(e,t){const i=this._selectionMap.get(e);if(!i)return;const n=[];for(const s of i.selection)t.includes(s)||n.push(s);this._setSelection(e,n)}toggleInSelection(e,t){const i=this._selectionMap.get(e);if(!i||i.selection.length===0)return void this._setSelection(e,t);const n=new Set(i.selection),s=new Set(t),o=Sr(n,s);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const t=[];for(const[i,n]of this._selectionMap.entries())t.push({layer:i,added:[],removed:[...n.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(t)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;)this._trashCan.pop()?.highlightHandle?.remove();const{sources:e,view:t,_selectionMap:i,showHighlight:n}=this,s=this._vizTaskId;for(const o of e){const a=i.get(o),h=Ge(o)?o.parent:o;if(h!=null&&oo(h)){if(so(h))continue;t.whenLayerView(h).then(c=>{a?.highlightHandle?.remove(),a!=null&&n&&s===this._vizTaskId&&"highlight"in c&&typeof c.highlight=="function"&&a.selection.length>0&&(a.highlightHandle=c.highlight(a.selection,this.highlightName))}).catch(()=>{a?.highlightHandle?.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(oe);for(const e of this.sources){const t=Ge(e)?e.parent:e;if(t!=null&&ci(t)){const i=t.on("edits",n=>{this._handleEditChanges(n,e)});this._layerEditHandles.push(i)}}}_handleEditChanges(e,t){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(t)){const i=e.deletedFeatures.filter(n=>n.error==null).map(n=>n.objectId).filter(bt);this.removeFromSelection(t,i)}}_setSelection(e,t){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const i=this._selectionMap.get(e);if(i===void 0||!Ph(i,{selection:t})){i!==void 0&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...t]});const n={layer:e,selection:[...t],...ys(i!==void 0?i.selection:[],t)};this._onSelectionChange([n])}}};r([l({readOnly:!0,nonNullable:!0})],ue.prototype,"selections",null),r([l({readOnly:!0,nonNullable:!0})],ue.prototype,"count",null),r([l({constructOnly:!0,nonNullable:!0})],ue.prototype,"view",void 0),r([l({readOnly:!0,nonNullable:!0})],ue.prototype,"hasSelection",null),r([l()],ue.prototype,"showHighlight",void 0),r([l()],ue.prototype,"sources",null),r([l()],ue.prototype,"highlightName",void 0),ue=r([v("esri.views.SelectionManager")],ue);const so=e=>Ge(e)?e.parent?.isTable===!0:e.isTable,Sh=e=>e.layer!==void 0,oo=e=>e?.when!==void 0,Ph=(e,t)=>{if(e==null&&t==null)return!0;if(e!=null&&t==null||e==null&&t!=null)return!1;if(e!=null&&t!=null&&e.selection!=null&&t.selection!=null){const i=[...e.selection],n=[...t.selection];if(i.length!==n.length)return!1;i.sort(),n.sort();for(let s=0;s<i.length;s++)if(i[s]!==n[s])return!1}return!0},ao=async(e,t,i={})=>{let n;if(Sh(e)){const s=e;n=s===void 0?null:await s.queryFeatures(new zs({...i,objectIds:t})).then(o=>({data:o,layer:e.layer}))}else{const s=e;n=s===void 0?null:await s.queryFeatures(new zs({...i,objectIds:t})).then(o=>({data:o,layer:s}))}return n},kh=ue;let kt=class extends Ei.ClonableMixin(M){constructor(e){super(e),this.accentColor=new Ue([255,127,0]),this.textColor=new Ue([255,255,255])}};r([l({type:Ue,nonNullable:!0})],kt.prototype,"accentColor",void 0),r([l({type:Ue,nonNullable:!0})],kt.prototype,"textColor",void 0),kt=r([v("esri.views.Theme")],kt);const en=kt;var tn;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(tn||(tn={}));const ro=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],lo={};function ho(e){return!!lo[e]}function Ch(e){for(const t of e)if(!ho(t))return!1;return!0}ro.forEach(e=>{lo[e]=!0});let co=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:t,priority:i},n)=>this.inputManager?.installHandlers(n,[t],i))}disconnect(){this.inputManager&&this._handlers.forEach((e,t)=>this.inputManager?.uninstallHandlers(t)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,t,i,n){const s=Array.isArray(e)?e:e.split(",");if(!Ch(s))return s.some(ho)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(t)?a=t:(o=t,a=[]),typeof i=="function"?o=i:n=i,n=n??we.DEFAULT;const h=this._createUniqueGroupName(),c=new Eh(this.view,s,a,o);this._handlers.set(h,{handler:c,priority:n});for(const d of s){const p=this._handlerCounts.get(d)||0;this._handlerCounts.set(d,p+1)}return this.inputManager&&this.inputManager.installHandlers(h,[c],n),qt(()=>this._removeHandler(h,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,t){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of t){const n=this._handlerCounts.get(i);n===void 0||(n===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,n-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},Eh=class extends O{constructor(e,t,i,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of t)switch(s){case"click":this.registerIncoming("click",i,o=>n(Rh(e,o)));break;case"double-click":this.registerIncoming("double-click",i,o=>n(Lh(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>n(Vh(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>n(Oh(e,o)));break;case"hold":this.registerIncoming("hold",i,o=>n(Ah(e,o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>n(zh(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>n(Nh(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>n(Et(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>n(Et(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>n(Et(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>n(Fh(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>n(Hh(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>n(Et(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>n(Et(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{n(Zh(o))});break;case"focus":this.registerIncoming("focus",i,o=>{n(Ih(o))});break;case"blur":this.registerIncoming("blur",i,o=>{n(Dh(o))})}}_wrapDrag(e){const t=e.data,{x:i,y:n}=t.center,{action:s,pointerType:o,button:a}=t;if(s==="start"&&(this._latestDragStart=t),!this._latestDragStart)return;const h=t.pointer.native,c=t.buttons,{cancelable:d,timestamp:p}=e,m={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:m,pointerType:o,button:a,buttons:c,radius:t.radius,angle:Pr(t.angle),native:h,timestamp:p,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}};function Ih(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function Dh(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}function Rh(e,t){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:h,eventId:c}=t.data,{cancelable:d,timestamp:p}=t;return{type:"click",pointerType:i,button:n,buttons:s,x:o,y:a,native:h,timestamp:p,screenPoint:A(o,a),mapPoint:Ct(e,o,a),eventId:c,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function Lh(e,t){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:h,eventId:c}=t.data,{cancelable:d,timestamp:p}=t;return{type:"double-click",pointerType:i,button:n,buttons:s,x:o,y:a,native:h,timestamp:p,mapPoint:Ct(e,o,a),eventId:c,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function Vh(e,t){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:h,eventId:c}=t.data,d=h.pointerId,{cancelable:p,timestamp:m}=t;return{type:"immediate-click",pointerId:d,pointerType:i,button:n,buttons:s,x:o,y:a,native:h,timestamp:m,mapPoint:Ct(e,o,a),eventId:c,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}function Oh(e,t){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:h,eventId:c}=t.data,d=h.pointerId,{cancelable:p,timestamp:m}=t;return{type:"immediate-double-click",pointerId:d,pointerType:i,button:n,buttons:s,x:o,y:a,native:h,timestamp:m,mapPoint:Ct(e,o,a),eventId:c,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}function Ah(e,t){const{pointerType:i,button:n,buttons:s,x:o,y:a,native:h}=t.data,{cancelable:c,timestamp:d}=t;return{type:"hold",pointerType:i,button:n,buttons:s,x:o,y:a,native:h,timestamp:d,mapPoint:Ct(e,o,a),cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}function Ct(e,t,i){return e.toMap(A(t,i),{exclude:[]})}function zh(e){const{key:t,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:t,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}function Nh(e){const{key:t,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:t,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}function Et(e,t){const{x:i,y:n,button:s,buttons:o,native:a,eventId:h}=e.data,c=a.pointerId,d=a.pointerType,{cancelable:p,timestamp:m}=e;return{type:t,x:i,y:n,pointerId:c,pointerType:d,button:s,buttons:o,native:a,timestamp:m,eventId:h,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function Fh(e){const{x:t,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,h=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,d=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:m,timestamp:u}=e;return{type:"pointer-drag",x:t,y:i,pointerId:h,pointerType:c,button:a,buttons:n,action:d,origin:p,native:s,timestamp:u,eventId:o,cancelable:m,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}function Hh(e){const{cancelable:t,data:i,timestamp:n}=e,{x:s,y:o,deltaY:a,native:h}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:h,timestamp:n,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}function Zh(e){const{action:t,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:h}=i;return{type:"gamepad",device:n,timestamp:o,action:t,buttons:a,axes:h,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}var at,nn,sn;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(at||(at={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(nn||(nn={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(sn||(sn={}));function Gh(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return I.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function on(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag(at.USER)&&e.getEditableFlag(at.MANAGER)}function le(e){return A(e.x,e.y)}function po(e,t){const i=(e instanceof HTMLElement?e:e.surface)?.getBoundingClientRect();return i?A(t.clientX-i.left,t.clientY-i.top):A(0,0)}function uo(e,t){return t instanceof Event?po(e,t):le(t)}function mo(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Uh=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._externallyDragging=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":yo(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0?this._stopDrag=!0:e.action==="start"?this._externallyDragging=!0:e.action==="end"&&(this._externallyDragging=!1),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!fo(e))break;const n=le(e),s=rt(n,e.pointerType,t.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,t),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&t.activeTool==null&&(this._revertToNullActiveTool=!0,t.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!fo(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=n?.manipulator,o=n?.tool;if(s==null||o==null)break;const a=le(e);a.x=wt(a.x,0,t.view.width),a.y=wt(a.y,0,t.view.height);const h=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:h,screenPoint:a}):s.events.emit("drag",{action:"start",start:h,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:h}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:h,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const n=le(e),s=rt(n,e.pointerType,t.forEachTool);if(Wh(e)||t.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let d=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,d=!0)}),d&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const h=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:h,stopPropagation:i}),an(o,i);break}case"click":{const n=le(e),s=rt(n,e.pointerType,t.forEachTool),o=s?.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=le(e),s=rt(n,e.pointerType,t.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),an(o,i);break}case"immediate-double-click":{const n=le(e),s=rt(n,e.pointerType,t.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),e.pointerType==="mouse"&&an(o,i);break}}this._onFocusChange(t.forEachTool)}_releaseManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:le(t)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorRelease(i.setActiveTool)}_handlePointerEnd(e,t){const i=this._grabbedManipulators.get(e.pointerId)?.manipulator;i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:le(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(t.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=go(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=go(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:n})=>{t.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{i.add(n)}),e(n=>{n.hasGrabbedManipulators=t.has(n),n.hasHoveredManipulators=i.has(n);const s=this._grabbedManipulators.values(),o=kr(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:t,setActiveTool:i},n=!0,s){const o=(a,h)=>a===e&&(s==null||s===h);this._grabbedManipulators.forEach(({tool:a,manipulator:h,pointerType:c},d)=>{o(a,h)&&(this._grabbedManipulators.delete(d),h.grabbing=!1,h.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:h},c)=>{o(a,h)&&(this._draggedManipulators.delete(c),h.dragging=!1,h.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:h},c)=>{o(a,h)&&(this._hoveredManipulators.delete(c),h.hovering=!1)}),this._afterManipulatorRelease(i),this._onFocusChange(t)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition(A(t.x,t.y),i,t.pointerType,e)})}handleHoverEvent(e,t){const i=e.type;i!=="pointer-up"&&i!=="immediate-click"&&i!=="pointer-move"||!yo(e.pointerType)||(i!=="pointer-up"&&this._externallyDragging?this._clearHoveredManipulatorStates(e.pointerId):this._updateHoveredStateForPointerAtScreenPosition(le(e),e.pointerId,e.pointerType,t))}_updateHoveredStateForPointerAtScreenPosition(e,t,i,n){let s=rt(e,i,n);const o=this._hoveredManipulators.get(t)?.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(t,s)):this._hoveredManipulators.delete(t),this._onFocusChange(n))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}_clearHoveredManipulatorStates(e){this._hoveredManipulators.forEach(({manipulator:t},i)=>{e===i&&(this._hoveredManipulators.delete(e),t.hovering=!1)})}};function go(e){for(const{manipulator:t}of e.values())if(t!=null&&t.interactive){if(t.grabbing&&t.grabCursor)return t.grabCursor;if(t.cursor)return t.cursor}return null}function rt(e,t,i){let n=null;return i(s=>{if(s.manipulators==null||!on(s))return!1;const o=s.manipulators.intersect(e,t);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}function yo(e){return e==="mouse"}function fo(e){return e.pointerType!=="mouse"||e.button===0}function Wh(e){return!!e.native.shiftKey}function an(e,t){e?.consumesClicks&&t()}const vo="attached",rn="tools",qh=1e3;let me=class extends M{constructor(e){super(e),this._updatingHandles=new ti,this._clock=Mt,this._manipulatorState=new Uh,this.tools=new k,this.cursor=null,this._interacting=!1,this._interactingTimeout=qh,this._interactingTimeoutHandle=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.addHandles([this.view.on(ro,e=>{this._handleInputEvent(e)},we.TOOL),...Gh(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void I.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),t?.deactivate(),e?.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const n=on(i);this.activeTool!=null&&n||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=oe(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){this.view.type==="3d"?this.addHandles([_(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>this._forEachManipulator(e=>e.onViewChange())),this.view.elevationProvider?.on("elevation-change",e=>this._forEachManipulator(t=>t.onElevationChange(e)))],vo):this.addHandles(_(()=>this.view.extent,()=>this._forEachManipulator(e=>e.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(vo),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(n=>{!t&&n.visible&&n.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(rn),this._forEachTool(e=>{if(e instanceof M){const t=_(()=>[e.cursor,e.visible,e.editable],()=>{on(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(t,rn)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],rn)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag?.(at.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){}};r([l({constructOnly:!0,nonNullable:!0})],me.prototype,"view",void 0),r([l({value:null})],me.prototype,"activeTool",null),r([l({readOnly:!0,type:k})],me.prototype,"tools",void 0),r([l({readOnly:!0})],me.prototype,"cursor",void 0),r([l({readOnly:!0})],me.prototype,"updating",null),r([l()],me.prototype,"_interacting",void 0),r([l({readOnly:!0})],me.prototype,"interacting",null),me=r([v("esri.views.ToolViewManager")],me);var ln;let J=ln=class extends M{constructor(e){super(e),this.name=Ns,this.color=ml.clone(),this.haloColor=null,this.haloOpacity=gl,this.fillOpacity=yl,this.shadowColor=fl.clone(),this.shadowOpacity=vl,this.shadowDifference=_l,this.haloWidth=2.1,this.haloBlur=.8/this.haloWidth}equals(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity&&this.haloWidth===e.haloWidth&&this.haloBlur===e.haloBlur&&this.shadowColor.equals(e.shadowColor)&&this.shadowOpacity===e.shadowOpacity&&this.shadowDifference===e.shadowDifference}clone(){return new ln({...this,color:this.color.clone(),haloColor:this.haloColor?.clone(),shadowColor:this.shadowColor?.clone()})}assignFrom(e){this.color=e.color.clone(),this.haloColor=e.haloColor?.clone(),this.haloOpacity=e.haloOpacity,this.fillOpacity=e.fillOpacity,this.shadowColor=e.shadowColor.clone(),this.shadowDifference=e.shadowDifference,this.shadowOpacity=e.shadowOpacity,this.haloBlur=e.haloBlur,this.haloWidth=e.haloWidth}};r([l({type:String,constructOnly:!0,nonNullable:!0})],J.prototype,"name",void 0),r([l({type:Ue,nonNullable:!0})],J.prototype,"color",void 0),r([l({type:Ue})],J.prototype,"haloColor",void 0),r([l({nonNullable:!0})],J.prototype,"haloOpacity",void 0),r([l({nonNullable:!0})],J.prototype,"fillOpacity",void 0),r([l({type:Ue,nonNullable:!0})],J.prototype,"shadowColor",void 0),r([l({nonNullable:!0})],J.prototype,"shadowOpacity",void 0),r([l({nonNullable:!0})],J.prototype,"shadowDifference",void 0),r([l({nonNullable:!0})],J.prototype,"haloWidth",void 0),r([l({nonNullable:!0})],J.prototype,"haloBlur",void 0),J=ln=r([v("esri.views.support.HighlightOptions")],J);const be=J;function jh(){return new(k.ofType(be))([new be({name:Ns}),new be({name:wl,color:bl})])}let lt=class extends M{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Bh.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Kh[this.deviceType]}};r([l({nonNullable:!0,readOnly:!0})],lt.prototype,"nativeIndex",void 0),r([l({type:String,readOnly:!0})],lt.prototype,"deviceType",null),r([l({type:Number,readOnly:!0})],lt.prototype,"axisThreshold",null),lt=r([v("esri.views.input.gamepad.GamepadInputDevice")],lt);const hn=lt,Bh=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Kh={standard:.15,spacemouse:.025,unknown:0};let It=class extends M{constructor(...e){super(...e),this.devices=new k,this.enabledFocusMode="document"}};r([l({type:k.ofType(hn),readOnly:!0})],It.prototype,"devices",void 0),r([l({type:["document","view","none"]})],It.prototype,"enabledFocusMode",void 0),It=r([v("esri.views.input.gamepad.GamepadSettings")],It);const $h=It;let di=class extends M{constructor(){super(...arguments),this.gamepad=new $h}};r([l({readOnly:!0})],di.prototype,"gamepad",void 0),di=r([v("esri.views.input.Input")],di);const Yh=di,cn=()=>Cr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,dn=()=>l({type:["pan","rotate","zoom","none"],nonNullable:!0});let Be=class extends M{constructor(e){super(e),this.dragPrimary="pan",this.dragSecondary="rotate",this.dragTertiary="zoom",this.mouseWheel="zoom"}};r([dn()],Be.prototype,"dragPrimary",void 0),r([dn()],Be.prototype,"dragSecondary",void 0),r([dn()],Be.prototype,"dragTertiary",void 0),r([l({type:["zoom","none"],nonNullable:!0})],Be.prototype,"mouseWheel",void 0),Be=r([v("esri.views.navigation.NavigationActionMap")],Be);const pn=Be;let ze=class extends M{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};r([l({type:Boolean,nonNullable:!0})],ze.prototype,"enabled",void 0),r([l({type:hn})],ze.prototype,"device",void 0),r([l({type:["pan","zoom"],nonNullable:!0})],ze.prototype,"mode",void 0),r([l({type:["forward-down","forward-up"],nonNullable:!0})],ze.prototype,"tiltDirection",void 0),r([l({type:Number,nonNullable:!0})],ze.prototype,"velocityFactor",void 0),ze=r([v("esri.views.navigation.gamepad.GamepadSettings")],ze);const _o=ze;let Ne=class extends M{constructor(e){super(e),this.actionMap=new pn,this.browserTouchPanEnabled=!0,this.gamepad=new _o,this.momentumEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!cn()}get mouseWheelZoomEnabled(){return this.actionMap.mouseWheel==="zoom"}set mouseWheelZoomEnabled(e){Er(I.getLogger(this),"mouseWheelZoomEnabled",{replacement:"actionMap.mouseWheel",version:"4.32",warnOnce:!0}),this.actionMap.mouseWheel=e?"zoom":"none"}};r([l({type:pn,nonNullable:!0})],Ne.prototype,"actionMap",void 0),r([l({type:Boolean})],Ne.prototype,"browserTouchPanEnabled",void 0),r([l({type:_o,nonNullable:!0})],Ne.prototype,"gamepad",void 0),r([l({type:Boolean})],Ne.prototype,"momentumEnabled",void 0),r([l({type:Boolean})],Ne.prototype,"mouseWheelZoomEnabled",null),Ne=r([v("esri.views.navigation.Navigation")],Ne);const pi=Ne;function Xh(e,t,i){const n=bo(e),s=t,o=Qh(n,s,i);if(n){const a=ii.deriveUnitFromSR(n,e.spatialReference).heightUnit;if(!i&&a!==n.heightUnit){const h=new T("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a});return new T("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:n,error:h})}}if(!Jh(e)||o===j.Unsupported)return new T("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:n});switch(o){case j.Units:{const a=n?.heightUnit||"unknown",h=s?.heightUnit||"unknown",c=new T("layerview:incompatible-height-unit",`The vertical units of the layer (${a}) must match the vertical units of the scene (${h})`,{layerUnit:a,sceneUnit:h});return new T("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:s,error:c})}case j.HeightModel:{const a=n?.heightModel||"unknown",h=s?.heightModel||"unknown",c=new T("layerview:incompatible-height-model",`The height model of the layer (${a}) must match the height model of the scene (${h})`,{layerHeightModel:a,sceneHeightModel:h});return new T("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:s,error:c})}case j.CRS:{const a=n?.vertCRS||"unknown",h=s?.vertCRS||"unknown",c=new T("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${a}) must match the vertical datum of the scene (${h})`,{layerDatum:a,sceneDatum:h});return new T("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:n,sceneHeightModelInfo:s,error:c})}}return null}function Qh(e,t,i){if(!wo(e)||!wo(t))return j.Unsupported;if(e==null||t==null)return j.Ok;if(!i&&e.heightUnit!==t.heightUnit)return j.Units;if(e.heightModel!==t.heightModel)return j.HeightModel;switch(e.heightModel){case"gravity-related-height":return j.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?j.Ok:j.CRS;default:return j.Unsupported}}var j;function wo(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function Jh(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!xo(e)}function bo(e){if(e.type==="integrated-mesh-3dtiles")return null;const t=e.url?Ir(e.url):void 0;return!(e.spatialReference?.vcsWkid==null&&t!=null&&t.serverType==="ImageServer")&&Mo(e)&&e.heightModelInfo?e.heightModelInfo:xo(e)?ii.deriveUnitFromSR(ec,e.spatialReference):null}function Mo(e){return"heightModelInfo"in e}function To(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function xo(e){return To(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Po(e)}function So(e){return e.layers!=null||Po(e)||To(e)||Mo(e)}function Po(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"parquet":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"viewshed":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(j||(j={}));const ec=new ii({heightModel:"gravity-related-height"});let un,mn=null;async function tc(e){mn||(mn=import("./geometryServiceUtils-CBD3Mhys.js").then(t=>un=t)),await mn,De(e)}async function ko(e,t,i,n){if(!e)return null;const s=e.spatialReference;return Fi()||Hi(s,t)?xt(e,t):un?un.projectGeometry(e,t,i,n):(await Promise.race([tc(n),Zi(n)]),ko(e,t,i,n))}let S=class extends M{constructor(e){super(e),this.required={extent:!1,heightModelInfo:!1,tileInfo:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Oi(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){const e=this.map?.(),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};let e;if(this._collectLayers(this.mapCollections,i=>{const n=this._getSupportedSpatialReferences(i);if(n.length>0){const s=this._narrowDownSpatialReferenceCandidates(e,n);s!=null&&(e=s)}return e?.length===1})&&e?.length!==1)return{updating:!0};const t=this._pickSpatialReferenceCandidate(e);return{spatialReference:t?.spatialReference??null,viewingMode:t?.viewingMode??null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};const e=this.map?.(),t=this.spatialReference;if(!t)return{updating:this._spatialReferenceTask.updating};let i;const n=this._collectLayers([{parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers}],s=>!(!("tileInfo"in s)||!s.tileInfo?.spatialReference.equals(t))&&(i=s,!0),s=>"tileInfo"in s);return i?{tileInfo:i.tileInfo,updating:!1}:{updating:n}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};let e={};const t=this._collectLayers(this.mapCollections,i=>{const n=bo(i);return!!n&&(e={heightModelInfo:n,vcsWkid:i.spatialReference?.vcsWkid,latestVcsWkid:i.spatialReference?.latestVcsWkid},!0)},i=>So(i));return{...e,updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=[],t=this._collectLayers(this.mapCollections,i=>{const n="fullExtents"in i&&i.fullExtents||(i.fullExtent!=null?[i.fullExtent]:[]),s=this.requiresExtentInSpatialReference?null:n[0],o=n.find(a=>a.spatialReference.equals(this.spatialReference))??s;if(o)return e.push({extent:o,layer:i}),!0;if(this._getSupportedSpatialReferences(i).length>0)for(const a of n)e.push({extent:a,layer:i});return!1});return{candidates:e,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),n=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Oi(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:n.clone(),task:Ri(async s=>{try{const o=await ko(i.extent,n,"portalItem"in i.layer?i.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Dr(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;const i=new Array;for(const n of e)for(const s of t){if(!n.spatialReference.equals(s.spatialReference))continue;const o=nc(n.viewingMode,s.viewingMode);if(o!==!1){i.push({spatialReference:n.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return e==null||e.length<1?t?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==Fs.Local)&&(e=e.filter(({viewingMode:i})=>i!==Fs.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const n of t){const s=this.getSpatialReferenceSupport(n,e);if(s!=null){const o=s.constraints??[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:h}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:h})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e,t,i=()=>!0){switch(this._loadMaybe(this.map?.())){case"loading":return!0;case"failed":return!1}const n=new ic(i,t);for(const s of e)if(this._collectCollection(s,n),n.done||n.preloading===this.sourcePreloadCount)break;return n.updating}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers)if(t.layerFilter(i)){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":if(t.updating||(t.done=t.pushLayer(i)),t.done||t.preloading===this.sourcePreloadCount)break;"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.done||t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{ms(t)}),"loading"):e.loadStatus:"loaded"}};r([l()],S.prototype,"required",void 0),r([l({constructOnly:!0})],S.prototype,"map",void 0),r([l({constructOnly:!0})],S.prototype,"getSpatialReferenceSupport",void 0),r([l()],S.prototype,"defaultSpatialReference",void 0),r([l()],S.prototype,"userSpatialReference",void 0),r([l()],S.prototype,"sourcePreloadCount",void 0),r([l()],S.prototype,"priorityCollection",void 0),r([l()],S.prototype,"requiresExtentInSpatialReference",void 0),r([l()],S.prototype,"suspended",void 0),r([l({readOnly:!0})],S.prototype,"ready",null),r([l({readOnly:!0})],S.prototype,"heightModelInfoReady",null),r([l({readOnly:!0})],S.prototype,"spatialReference",null),r([l({readOnly:!0})],S.prototype,"extent",null),r([l({readOnly:!0})],S.prototype,"heightModelInfo",null),r([l({readOnly:!0})],S.prototype,"vcsWkid",null),r([l({readOnly:!0})],S.prototype,"latestVcsWkid",null),r([l({readOnly:!0})],S.prototype,"viewingMode",null),r([l({readOnly:!0})],S.prototype,"tileInfo",null),r([l({readOnly:!0})],S.prototype,"mapCollections",null),r([l({readOnly:!0})],S.prototype,"_spatialReferenceTask",null),r([l({readOnly:!0})],S.prototype,"_tileInfoTask",null),r([l({readOnly:!0})],S.prototype,"_heightModelInfoTask",null),r([l({readOnly:!0})],S.prototype,"_extentCandidatesTask",null),r([l()],S.prototype,"_extentTask",null),r([l()],S.prototype,"_projectExtentTask",void 0),S=r([v("esri.views.support.DefaultsFromMap")],S);let ic=class{constructor(e,t){this.layerFilter=e,this.pushLayer=t,this.preloading=-1,this.updating=!1,this.done=!1}};function nc(e,t){return e!=null?t!=null?e===t&&e:e:t}let ht=class extends M{constructor(e){super(e),this.featureTitleFields=!1,this.utilityNetworkFields=!1,this.globalIdField=!1}};r([l()],ht.prototype,"featureTitleFields",void 0),r([l()],ht.prototype,"utilityNetworkFields",void 0),r([l()],ht.prototype,"globalIdField",void 0),ht=r([v("esri.views.support.RequiredFieldsOptions")],ht);const sc=ht;var Dt;let y=Dt=class extends Kt.EventedMixin(fs.EsriPromiseMixin(M)){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.handles=new vs,this.updatingHandles=new ti,this.allLayerViews=new Is({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:ac}),this.groundView=null,this.basemapView=null,this.displayFilterEnabled=!0,this.fatalError=null,this.graphics=new Os,this.analyses=new hi,this.typeSpecificPreconditionsReady=!0,this.layerViews=new k,this.magnifier=new no,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this._readyStateWaitingTask=null,this.supportsGround=!0,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Yh,this.navigation=new pi,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new co(this),this.persistableViewModels=new k,this.requiredFieldsOptions=new sc,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this._userTimeExtent=null,this._lockedTimeExtent=null,this.theme=null,this.handles.add(_(()=>this.preconditionsReady,t=>{const i=this.ready;if(t?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,this._lockedTimeExtent=this.timeExtent,Dt.views.add(this)):(this._lockedSpatialReference=null,Dt.views.remove(this)),this.notifyChange("spatialReference"),!t&&i)this.toolViewManager?.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),this.layerViewManager?.clear(),this._teardown();else if(t&&!i){try{this._startup()}catch(n){return void queueMicrotask(()=>{this.fatalError=new T("startup-error",null,n)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Tt))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Di(()=>this.ready)))),this.basemapView=new _h({view:this}),this.layerViewManager=new Th({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new me({view:this}),this.selectionManager=new kh({view:this}),this.addHandles([We(()=>this.readyState==="map-content-error"&&!this.spatialReference,()=>{I.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),_(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},ae),_(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},Tt),_(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},ae)])}destroy(){this.destroyed||(Dt.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=re(this.graphics),this.analyses=re(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),re(this.analysisViewManager),this.toolViewManager=re(this.toolViewManager),this.layerViewManager=re(this.layerViewManager),this.selectionManager=re(this.selectionManager),this.basemapView=re(this.basemapView),this.groundView?.destroy(),this.layerViews?.forEach(e=>e.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=re(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return I.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){return this.toolViewManager?.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new S({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(e,t)=>this.getSpatialReferenceSupport(e,t),...this.defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get highlights(){return this._get("highlights")??jh()}set highlights(e){this._set("highlights",gs(e,this._get("highlights"),k.ofType(be)))}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||_s.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e?.destroyed&&(I.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),_s.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get readyState(){if(this.destroyed)return this._get("readyState");if(!this.map)return"missing-map";if("container"in this&&!this.container)return"missing-container";if(this.fatalError)return"rendering-error";if((this.defaultsFromMap?.ready??!1)&&!this.spatialReference){const e=!("loaded"in this.map)||this.map.loaded,t=this.map.ground.loaded,i=this.map.basemap?.loaded??!0;return e&&i&&t&&!this.map?.allLayers.length?"empty-map":(this._readyStateWaitingTask||(this._readyStateWaitingTask=Ri(n=>Rr(U("view-readyState-waiting-delay"),null,n)),this.addHandles(this._readyStateWaitingTask),this.addHandles(this._readyStateWaitingTask,"ready-state-task")),this._readyStateWaitingTask?.finished?"map-content-error":"loading")}return this._readyStateWaitingTask=Oi(this._readyStateWaitingTask),this.removeHandles("ready-state-task"),this.ready?"ready":"loading"}get spatialReference(){const e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&this.defaultsFromMap?.required?.heightModelInfo){const t=e.clone();return t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,t}return e}set spatialReference(e){const t=!$t(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeExtent(){return this._userTimeExtent??this._lockedTimeExtent??this.getDefaultTimeExtent()??null}set timeExtent(e){this._userTimeExtent=e}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Lr}set timeZone(e){this._userTimeZone=e,dl(e)||I.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){return this.toolViewManager?.tools}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){return this.toolViewManager?.cursor??this._cursor??"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new en}whenLayerView(e){return this.layerViewManager?.whenLayerView(e)??Promise.reject()}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}getDefaultTimeZone(){return null}getDefaultTimeExtent(){return null}importLayerView(e){throw new T("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport(e)!=null}when(e,t){return this.isResolved()&&!this.ready&&I.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(We(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};y.views=new k,r([l()],y.prototype,"_userSpatialReference",void 0),r([l()],y.prototype,"activeTool",null),r([l({readOnly:!0})],y.prototype,"allLayerViews",void 0),r([l()],y.prototype,"groundView",void 0),r([l()],y.prototype,"animation",null),r([l()],y.prototype,"basemapView",void 0),r([l()],y.prototype,"center",null),r([l()],y.prototype,"defaultsFromMapSettings",null),r([l()],y.prototype,"defaultsFromMap",null),r([l()],y.prototype,"displayFilterEnabled",void 0),r([l()],y.prototype,"fatalError",void 0),r([l({type:qe})],y.prototype,"extent",null),r([l(As(Os,"graphics"))],y.prototype,"graphics",void 0),r([l(As(hi,"analyses"))],y.prototype,"analyses",void 0),r([l({readOnly:!0,type:ii})],y.prototype,"heightModelInfo",null),r([l({type:k.ofType(be)})],y.prototype,"highlights",null),r([l({readOnly:!0})],y.prototype,"interacting",null),r([l({readOnly:!0})],y.prototype,"navigating",null),r([l({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],y.prototype,"preconditionsReady",null),r([l({readOnly:!0})],y.prototype,"typeSpecificPreconditionsReady",void 0),r([l({type:k,readOnly:!0})],y.prototype,"layerViews",void 0),r([l()],y.prototype,"resolution",null),r([l({type:no})],y.prototype,"magnifier",void 0),r([l({value:null,type:ll})],y.prototype,"map",null),r([l()],y.prototype,"padding",void 0),r([l({readOnly:!0})],y.prototype,"ready",void 0),r([l()],y.prototype,"_readyStateWaitingTask",void 0),r([l({readOnly:!0})],y.prototype,"readyState",null),r([l({type:Yt})],y.prototype,"spatialReference",null),r([l()],y.prototype,"stationary",null),r([l({readOnly:!0})],y.prototype,"supportsGround",void 0),r([l({type:cl})],y.prototype,"timeExtent",null),r([l({type:String,nonNullable:!0})],y.prototype,"timeZone",null),r([l()],y.prototype,"tools",null),r([l()],y.prototype,"toolViewManager",void 0),r([l({readOnly:!0})],y.prototype,"type",void 0),r([l({type:Number})],y.prototype,"scale",void 0),r([l({readOnly:!0})],y.prototype,"updating",void 0),r([l({readOnly:!0})],y.prototype,"initialExtentRequired",void 0),r([l({readOnly:!0})],y.prototype,"initialExtent",null),r([l()],y.prototype,"cursor",null),r([l({readOnly:!0})],y.prototype,"input",void 0),r([l({type:pi,nonNullable:!0})],y.prototype,"navigation",void 0),r([l()],y.prototype,"layerViewManager",void 0),r([l()],y.prototype,"analysisViewManager",void 0),r([l()],y.prototype,"selectionManager",void 0),r([l()],y.prototype,"width",void 0),r([l()],y.prototype,"height",void 0),r([l({readOnly:!0})],y.prototype,"resizing",void 0),r([l({value:null,readOnly:!0})],y.prototype,"size",null),r([l({readOnly:!0})],y.prototype,"suspended",void 0),r([l({readOnly:!0})],y.prototype,"viewEvents",void 0),r([l({readOnly:!0})],y.prototype,"persistableViewModels",void 0),r([l()],y.prototype,"_isValid",void 0),r([l()],y.prototype,"_readyCycleForced",void 0),r([l()],y.prototype,"_lockedSpatialReference",void 0),r([l()],y.prototype,"_userTimeZone",void 0),r([l()],y.prototype,"_lockedTimeZone",void 0),r([l()],y.prototype,"_userTimeExtent",void 0),r([l()],y.prototype,"_lockedTimeExtent",void 0),r([l({type:en})],y.prototype,"theme",void 0),r([l({readOnly:!0,type:en})],y.prototype,"effectiveTheme",null),y=Dt=r([v("esri.views.View")],y);const gn=globalThis.$arcgis;gn&&!gn.views&&Object.defineProperty(gn,"views",{configurable:!1,enumerable:!0,writable:!1,value:y.views});const oc=y;function ac(e){return e.layerViews}function ge(){return[1,0,0,1,0,0]}function Co(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function rc(e,t,i,n,s,o){return[e,t,i,n,s,o]}function lc(e,t){return new Float64Array(e,t,6)}const hc=ge();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:hc,clone:Co,create:ge,createView:lc,fromValues:rc},Symbol.toStringTag,{value:"Module"}));const Eo=96,Io=39.37,cc=180/Math.PI;function Do(e){return e.wkid?e:e.spatialReference||Yt.WGS84}function yn(e,t){return t.type?z(e,t.x,t.y):St(e,t)}function Ro(e){return bs(e)}function ui(e,t,i=0){let n=e.width,s=e.height;if(i!==0){const h=Ai(i),c=Math.abs(Math.cos(h)),d=Math.abs(Math.sin(h));n=e.width*c+e.height*d,s=e.width*d+e.height*c}const o=Math.max(1,t[0]),a=Math.max(1,t[1]);return Math.max(n/o,s/a)*fc(e.spatialReference)}async function Rt(e,t,i,n){let s,o;if(!e||Array.isArray(e)&&!e.length)return null;if(k.isCollection(e)&&(e=e.toArray()),Array.isArray(e)&&e.length&&typeof e[0]=="object"){const h=e.every(p=>"attributes"in p),c=e.some(p=>!p.geometry);let d=e;if(h&&c&&t&&t.allLayerViews){const p=new Map;for(const f of e){const b=f.layer,D=p.get(b)||[],E=f.attributes[b.objectIdField];E!=null&&D.push(E),p.set(b,D)}const m=[];p.forEach((f,b)=>{const D=t.allLayerViews?.find(E=>E.layer.id===b.id);if(D&&"queryFeatures"in D){const E=b.createQuery();E.objectIds=f,E.returnGeometry=!0,m.push(D.queryFeatures(E))}});const u=await Promise.all(m),g=[];for(const f of u)if(f&&f.features&&f.features.length)for(const b of f.features)b.geometry!=null&&g.push(b.geometry);d=g}for(const p of d)n=await Rt(p,t,i,n);return n}if(Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number")s=new L(e);else if(e instanceof Ms)s=e;else if("geometry"in e){if(e.geometry)s=e.geometry;else if(e.layer){const h=e.layer,c=t.allLayerViews?.find(d=>d.layer.id===h.id);if(c&&"queryFeatures"in c){const d=h.createQuery();d.objectIds=[e.attributes[h.objectIdField]],d.returnGeometry=!0,s=(await c.queryFeatures(d))?.features?.[0]?.geometry}}}if(s==null)return null;switch(s.type){case"point":o=new qe({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":o=Vl(s);break;default:o=s.extent}if(!o)return null;Fi()||Hi(o.spatialReference,i)||await Zi();const a=xt(o,i);if(!a)return null;if(n){const h=a.center,c=h.clone();c.x=Bi(h.x,n.center.x,i),c.x!==h.x&&a.centerAt(c),n=n.union(a)}else n=a;return n}function dc(e){if(e&&(!Array.isArray(e)||typeof e[0]!="number")&&(typeof e=="object"||Array.isArray(e)&&typeof e[0]=="object")){if("layer"in e&&e.layer?.minScale!=null&&e.layer.maxScale!=null){const t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every(t=>"layer"in t)){let t=0,i=0;for(const n of e){const s=n.layer;s?.minScale&&s.maxScale&&(t=s.minScale<t?s.minScale:t,i=s.maxScale>i?s.maxScale:i)}return t&&i?{min:t,max:i}:null}}}function Lo(e,t){const i=Do(e);return $t(i,t)||i.imageCoordinateSystem||t.imageCoordinateSystem?e:xt(e,t)}async function pc(e,t){if(!e||!t)return new X({targetGeometry:new L,scale:0,rotation:0});let i=t.spatialReference;const{constraints:n,padding:s,viewpoint:o,size:a}=t,h=[s?a[0]-s.left-s.right:a[0],s?a[1]-s.top-s.bottom:a[1]];let c=null;e instanceof X?c=e:e.viewpoint?c=e.viewpoint:e.target&&e.target.declaredClass==="esri.Viewpoint"&&(c=e.target);let d=null;c?.targetGeometry?d=c.targetGeometry:e instanceof qe?d=e:e instanceof Ms?d=await Rt(e,t,i):e&&(d=await Rt(e.center,t,i)||await Rt(e.target,t,i)||await Rt(e,t,i)),!d&&o?.targetGeometry?d=o.targetGeometry:!d&&t.extent&&(d=t.extent),i||(i=Do(t.spatialReference||t.extent||d)),Fi()||$t(d.spatialReference,i)||Hi(d.spatialReference,i)||await Zi();const p=Lo(d,i),m="center"in p?p.center:p;t.pickClosestTarget!==!1&&m.type==="point"&&o.targetGeometry?.type==="point"&&(m.x=Bi(m.x,o.targetGeometry.x,m.spatialReference));let u=0;c?u=c.rotation:e.hasOwnProperty("rotation")?u=e.rotation:o&&(u=o.rotation);let g=0;g=c?.targetGeometry!=null&&c.targetGeometry.type==="point"?c.scale:"scale"in e&&e.scale?e.scale:"zoom"in e&&e.zoom!==-1&&n&&n.effectiveLODs?n.zoomToScale(e.zoom):Array.isArray(d)||d.type==="point"||d.type==="extent"&&d.width===0&&d.height===0?o.scale:ui(Lo(d.extent,i),h,u);const f=dc(e.target??e);f&&(f.min&&f.min<g?g=f.min:f.max&&f.max>g&&(g=f.max));let b=new X({targetGeometry:m,scale:g,rotation:u});return n&&(b=n.fit(b),n.constrainByGeometry(b),n.rotationEnabled||(b.rotation=o.rotation)),b}function F(e,t){const i=e.targetGeometry,n=t.targetGeometry;return i.x=n.x,i.y=n.y,i.spatialReference=n.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function Vo(e,t,i){return i?z(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):ni(e,t,.5)}const uc=function(){const e=V();return function(t,i,n){const s=i.targetGeometry;yn(e,s);const o=.5*ct(i);return t.xmin=e[0]-o*n[0],t.ymin=e[1]-o*n[1],t.xmax=e[0]+o*n[0],t.ymax=e[1]+o*n[1],t.spatialReference=s.spatialReference,t}}();function mc(e,t,i,n,s){return Tn(e,t,i.center),e.scale=ui(i,n),s?.constraints?.constrain(e),e}function gc(e,t,i,n){return bn(e,t,i,n),js(e,e)}const fn=function(){const e=V();return function(t,i,n){return Gs(t,vc(t,i),Vo(e,i,n))}}(),yc=function(){const e=ge(),t=V();return function(i,n,s,o){const a=ct(n),h=_n(n);return z(t,a,a),El(e,t),ji(e,e,h),si(e,e,fn(t,s,o)),si(e,e,[0,o.top-o.bottom]),z(i,e[4],e[5])}}();function ct(e){return e.scale*vn(e.targetGeometry?.spatialReference)}function vn(e){return ws(e)?1/(Ro(e)*Io*Eo):1}function _n(e){return Us(e.rotation)||0}function fc(e){return ws(e)?Ro(e)*Io*Eo:1}function vc(e,t){return ni(e,t,.5)}const wn=function(){const e=V(),t=V(),i=V();return function(n,s,o,a,h,c){return Ml(e,s),ni(t,o,.5*c),z(i,1/a*c,-1/a*c),Ws(n,t),h&&ji(n,n,h),qs(n,n,i),si(n,n,e),n}}(),bn=function(){const e=V();return function(t,i,n,s){const o=ct(i),a=_n(i);return yn(e,i.targetGeometry),wn(t,e,n,o,a,s)}}(),_c=function(){const e=V();return function(t,i,n,s){const o=ct(i);return yn(e,i.targetGeometry),wn(t,e,n,o,0,s)}}();function Mn(e){const t=Ts(e);return t?t.valid[1]-t.valid[0]:0}function wc(e,t){return Math.round(Mn(e)/t)}const Oo=function(){const e=V(),t=V(),i=[0,0,0];return function(n,s,o){Wi(e,n,s),Hs(e,e),Wi(t,n,o),Hs(t,t),Tl(i,e,t);let a=Math.acos(xl(e,t)/(Zs(e)*Zs(t)))*cc;return i[2]<0&&(a=-a),isNaN(a)&&(a=0),a}}(),bc=function(){const e=V();return function(t,i,n,s){const o=t.targetGeometry;return F(t,i),yc(e,i,n,s),o.x+=e[0],o.y+=e[1],t}}(),Tn=function(e,t,i){F(e,t);const n=e.targetGeometry;return n.x=i.x,n.y=i.y,n.spatialReference=i.spatialReference,e},Mc=function(){const e=V();return function(t,i,n,s,o){o||(o="center"),Gs(e,n,s),ni(e,e,.5);const a=e[0],h=e[1];switch(o){case"center":z(e,0,0);break;case"left":z(e,-a,0);break;case"top":z(e,0,h);break;case"right":z(e,a,0);break;case"bottom":z(e,0,-h);break;case"top-left":z(e,-a,h);break;case"bottom-left":z(e,-a,-h);break;case"top-right":z(e,a,h);break;case"bottom-right":z(e,a,-h)}return Lt(t,i,e),t}}();function Tc(e,t,i){return F(e,t),e.rotation+=i,e}function xc(e,t,i){return F(e,t),e.rotation=i,e}const Sc=function(){const e=V();return function(t,i,n,s,o){return F(t,i),isNaN(n)||n===0||(zo(e,s,i,o),t.scale=i.scale*n,No(e,e,t,o),Lt(t,t,z(e,e[0]-s[0],s[1]-e[1]))),t}}();function Ao(e,t,i){return F(e,t),e.scale=i,e}const xn=function(){const e=V();return function(t,i,n,s,o,a){return F(t,i),isNaN(n)||n===0||(zo(e,o,i,a),t.scale=i.scale*n,t.rotation+=s,No(e,e,t,a),Lt(t,t,z(e,e[0]-o[0],o[1]-e[1]))),t}}(),Pc=function(){const e=V(),t=V();return function(i,n,s,o,a,h,c){return fn(t,h,c),Sl(e,a,t),o?xn(i,n,s,o,e,h):Sc(i,n,s,e,h)}}(),zo=function(){const e=ge();return function(t,i,n,s){return _e(t,i,gc(e,n,s,1))}}(),No=function(){const e=ge();return function(t,i,n,s){return _e(t,i,bn(e,n,s,1))}}(),Lt=function(){const e=V(),t=ge();return function(i,n,s){F(i,n);const o=ct(n),a=i.targetGeometry;return Cl(t,_n(n)),qs(t,t,kl(o,o)),_e(e,s,t),a.x+=e[0],a.y+=e[1],i}}();function Vt(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function Fo(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function kc(e,t,i,n,s,o,a,h,c){const d=new Float32Array(9);return d[0]=e,d[1]=t,d[2]=i,d[3]=n,d[4]=s,d[5]=o,d[6]=a,d[7]=h,d[8]=c,d}function Cc(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Fo,create:Vt,createView:Cc,fromValues:kc},Symbol.toStringTag,{value:"Module"}));function Ec(e){return e instanceof Float32Array&&e.length>=2}function Ic(e){return Array.isArray(e)&&e.length>=2}function Sn(e){return Ec(e)||Ic(e)}var Pn;const Me=[0,0];let Te=Pn=class extends Ii{constructor(e){super(e),this._viewpoint2D={center:V(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new qe,this.id=0,this.inverseTransform=ge(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=ge(),this.transformNoRotation=ge(),this.displayMat3=Vt(),this.displayViewMat3=Vt(),this.viewMat3=Vt(),this.viewMat2d=Il(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}get visibleArea(){const[e,t]=this.size;return[this.toMap([0,0],0,0),this.toMap([0,0],0,t),this.toMap([0,0],e,t),this.toMap([0,0],e,0)]}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=F(i,e.viewpoint),this._set("size",St(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new Pn({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return Sn(t)?_e(e,t,this.inverseTransform):(Me[0]=t,Me[1]=i,_e(e,Me,this.inverseTransform))}toScreen(e,t,i){return Sn(t)?_e(e,t,this.transform):(Me[0]=t,Me[1]=i,_e(e,Me,this.transform))}toScreenNoRotation(e,t,i){return Sn(t)?_e(e,t,this.transformNoRotation):(Me[0]=t,Me[1]=i,_e(e,Me,this.transformNoRotation))}wrapMapCoordinate(e,t){St(e,t);const[i]=t,[n]=this.center,{extent:s,spatialReference:o}=this;let{xmin:a,xmax:h}=s;if(o.isWrappable){const c=Mn(o)/2;a=Math.max(a,n-c),h=Math.min(h,n+c)}return(i<a||i>h)&&(e[0]=Bi(i,n,o)),e}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size");return wn(e,i,s,t,0,n),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:n}=this._viewpoint2D,s=this._get("pixelRatio")||1,o=this._get("size"),a=new X({targetGeometry:new L(e[0],e[1],t),scale:i,rotation:n});if(this._set("viewpoint",a),!o||!t||!i)return;this.resolution=ct(a),this.rotation=n,this.scale=i,this.spatialReference=t,St(this.center,e);const h=o[0]!==0?2/o[0]:0,c=o[1]!==0?-2/o[1]:0;Ol(this.displayMat3,h,0,0,0,c,0,-1,1,1);const d=Al(this.viewMat3),p=$s(o[0]/2,o[1]/2),m=$s(-o[0]/2,-o[1]/2),u=Us(n);Ks(d,d,p),zl(d,d,u),Ks(d,d,m),Nl(this.displayViewMat3,this.displayMat3,d);const g=Ws(this.viewMat2d,p);return ji(g,g,u),si(g,g,m),uc(this.extent,a,o),bn(this.transform,a,o,s),js(this.inverseTransform,this.transform),_c(this.transformNoRotation,a,o,s),this.worldScreenWidth=wc(this.spatialReference,this.resolution),this._set("id",this.id+1),this.notifyChange("visibleArea"),this}};r([l({readOnly:!0})],Te.prototype,"id",void 0),r([l({value:1,json:{write:!0}})],Te.prototype,"pixelRatio",null),r([l({json:{write:!0}})],Te.prototype,"size",null),r([l()],Te.prototype,"spatialReference",void 0),r([l({type:X,json:{write:!0}})],Te.prototype,"viewpoint",null),r([l({readOnly:!0})],Te.prototype,"visibleArea",null),Te=Pn=r([v("esri.views.2d.ViewState")],Te);const Ho=Te;var kn,Cn;let xe=kn=class extends M{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new kn({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};r([l()],xe.prototype,"left",void 0),r([l()],xe.prototype,"top",void 0),r([l()],xe.prototype,"right",void 0),r([l()],xe.prototype,"bottom",void 0),xe=kn=r([v("esri.views.2d.PaddedViewState.Padding")],xe);let dt=Cn=class extends Ho{constructor(...e){super(...e),this.paddedViewState=new Ho,this._updateContent=(()=>{const t=V();return()=>{const i=this._get("size"),n=this._get("padding");if(!i||!n)return;const s=this.paddedViewState;z(t,n.left+n.right,n.top+n.bottom),Wi(t,i,t),St(s.size,t);const o=s.viewpoint;o&&(this.viewpoint=o)}})(),this.addHandles(_(()=>[this.size,this.padding],()=>this._updateContent(),Tt)),this.padding=new xe,this.size=[0,0]}set padding(e){this._set("padding",e||new xe)}set viewpoint(e){if(e){this.paddedViewState.viewpoint=e;let t=e;const i=this._get("padding");i&&(t=bc(e.clone(),e,this._get("size"),i));const{targetGeometry:n,rotation:s,scale:o}=t,{x:a,y:h,spatialReference:c}=n,d=this._viewpoint2D;d.center[0]=a,d.center[1]=h,d.rotation=s,d.scale=o,d.spatialReference=c,this._update()}}clone(){return new Cn({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};r([l()],dt.prototype,"paddedViewState",void 0),r([l({type:xe})],dt.prototype,"padding",null),r([l()],dt.prototype,"viewpoint",null),dt=Cn=r([v("esri.views.2d.PaddedViewState")],dt);const En=dt;let Dc=class{constructor(e){this.view=e,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this._scheduler=Fl(),this._schedulerHandle=We(()=>this._scheduler.updating,()=>this.requestFrame()),this.stationary=!0,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions,this._updateParameters.targetState.copy(this.view.state),this.view.animation?.target==null||xs(this.view.animation.target)||(this._updateParameters.targetState.viewpoint=this.view.animation.target))},this.update=t=>{if(this._updateRequested=!1,this.view?.destroyed)return;const{allLayerViews:i,graphicsView:n,labelManager:s,state:{id:o}}=this.view;i?.forEach(this._updateLayerView,this),s!=null&&(s.lastUpdateId!==o&&(s.viewChange(),s.lastUpdateId=o),s.updateRequested&&s.processUpdate(this._updateParameters)),n!=null&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(this._updateParameters)),this.view.graphicsTileStore?.setViewState(this._updateParameters.state),this.view.animation?this._scheduler.state=oi.ANIMATING:this.view.interacting?this._scheduler.state=oi.INTERACTING:this._scheduler.state=oi.IDLE,this._scheduler.frame(t)||this._updateRequested||this._scheduler.state!==oi.IDLE||this._frameTaskHandle?.pause()}}destroy(){this.stop(),this._schedulerHandle.remove(),this._scheduler.destroy()}get scheduler(){return this._scheduler}start(){if(this._frameTaskHandle)return;const e=this.view;this.stationary=e.stationary,this._updateParameters={state:e.state,targetState:new En,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:e.renderingOptions},this._stationaryHandle=_(()=>e.stationary,t=>{this.stationary=t,this.requestFrame()}),this._frameTaskHandle=st(this),this.requestUpdate()}stop(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle?.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){if(!e.attached)return void this.requestUpdate();const t=this.view.state,i=e.lastUpdateId;i!=null&&(this.stationary||e.moving)||(e.moving=!0),i!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews?.forEach(this._updateLayerView,this)}},Fe=class extends fs{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=jt(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._resolver?.reject(new T("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._resolver?.resolve())}update(e,t){t||(t=xs(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};r([l({readOnly:!0})],Fe.prototype,"done",null),r([l({readOnly:!0,type:String})],Fe.prototype,"state",void 0),r([l()],Fe.prototype,"target",void 0),Fe=r([v("esri.views.ViewAnimation")],Fe),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Fe||(Fe={}));const In=Fe;let mi=class extends M{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,t){if(!e)return void I.getLogger(this).error("#goTo()","target cannot be null or undefined");const i=new In;this.view.animation=i,await Di(()=>this.view.ready,t);const n={...t,animate:t?.animate??!cn(),animationMode:t?.animationMode??"auto"},{extent:s,spatialReference:o,size:a,viewpoint:h,constraints:c,padding:d,allLayerViews:p}=this.view,m=pc(e,{extent:s,spatialReference:o,size:a,viewpoint:h,constraints:c,padding:d,allLayerViews:p,pickClosestTarget:t?.pickClosestTarget??!0});return i?.update(m),this._gotoTask={},n.animate?this._gotoAnimated(m,n):this._gotoImmediate(m,n)}_gotoImmediate(e,t){const i=this._gotoTask,n=this.view.animation,s=e.then(o=>{if(De(t),i!==this._gotoTask)throw new T("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=n.target=o,n.finish()});return this._cancellableGoTo(i,n,s,t)}_gotoAnimated(e,t){const i=this._gotoTask,n=this.view.animation;if(!n)return Promise.resolve();const s=e.then(o=>{if(De(t),i!==this._gotoTask)throw new T("view:goto-interrupted","Goto was interrupted");return n.update(o),this.view.animationManager.animate(n,this.view.viewpoint,t),n.when().then(()=>{},()=>{})});return this._cancellableGoTo(i,n,s,t)}_cancellableGoTo(e,t,i,n){const s=()=>e===this._gotoTask;return Vr(i,n).finally(()=>{s()&&(t.done||t.stop())})}};r([l({constructOnly:!0})],mi.prototype,"view",void 0),mi=r([v("esri.views.2d.GoToManager")],mi);function Rc(e,t){const{spatialReference:i}=t,n=[t.x,t.y];let s,o,a,h;const c=[0,0],d=Lc(e);for(let u=0;u<d.length;u++){const g=d[u];for(let f=0;f<g.length-1;f++){Or(c,n,g,f);const b=Pl(n,c);(s==null||b<s)&&(s=b,o=[...c],a=u,h=f)}}if(s==null||!o||a==null||h==null)throw new T("nearest-coordinate:failed","Failed to find the nearest coordinate");const[p,m]=o;return{coordinate:new L({x:p,y:m,spatialReference:i}),distance:s}}function Lc(e){switch(e.type){case"extent":return[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]];case"polygon":return e.rings;case"polyline":return e.paths}}var Dn;let Ke=Dn=class extends zi.NumericIdentifiableMixin(M){constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return xt(this.geometry,this.spatialReference)}catch(e){return I.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:e}),null}return this.geometry}constrain(e,t){if(this.normalizedGeometry==null)return e;const i=e.targetGeometry;if(this.normalizedGeometry.type==="extent"?Ni(this.normalizedGeometry,i):Ss(this.normalizedGeometry,i))return e;const{coordinate:n}=Rc(this.normalizedGeometry,i);return n&&(e.targetGeometry=n),e}clone(){return new Dn({geometry:this.geometry?.clone(),spatialReference:this.spatialReference?.clone()})}};r([l({constructOnly:!0})],Ke.prototype,"geometry",void 0),r([l({readOnly:!0})],Ke.prototype,"normalizedGeometry",null),r([l({constructOnly:!0})],Ke.prototype,"spatialReference",void 0),Ke=Dn=r([v("esri.views.2d.constraints.GeometryConstraint")],Ke);var Rn;let Ot=Rn=class extends zi.NumericIdentifiableMixin(M){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t&&(this.rotationEnabled||(e.rotation=t.rotation)),e}clone(){return new Rn({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};r([l()],Ot.prototype,"enabled",void 0),r([l()],Ot.prototype,"rotationEnabled",void 0),Ot=Rn=r([v("esri.views.2d.constraints.RotationConstraint")],Ot);const Zo=Ot;var Ln;let B=Ln=class extends zi.NumericIdentifiableMixin(M){constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:n,minZoom:s,maxZoom:o}=this,a=-1,h=-1,c=!1,d=!1;if(i!==0&&n!==0&&i<n&&([i,n]=[n,i]),!t?.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",n);t=t.map(p=>p.clone()),t.sort((p,m)=>m.scale-p.scale),t.forEach((p,m)=>p.level=m);for(const p of t)!c&&i>0&&i>=p.scale&&(a=p.level,c=!0),!d&&n>0&&n>=p.scale&&(h=e?e.level:-1,d=!0),e=p;s===-1&&(s=i===0?0:a),o===-1&&(o=n===0?t.length-1:h),s=Math.max(s,0),s=Math.min(s,t.length-1),o=Math.max(o,0),o=Math.min(o,t.length-1),s>o&&([s,o]=[o,s]),i=t[s].scale,n=t[o].scale,t.splice(0,s),t.splice(o-s+1,t.length),t.forEach((p,m)=>{this._lodByScale[p.scale]=p,this._scales[m]=p.scale}),this._set("effectiveLODs",t),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",o),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",n)}constrain(e,t){if(t&&e.scale===t.scale)return e;const i=this.effectiveMinScale,n=this.effectiveMaxScale,s=e.targetGeometry,o=t&&t.targetGeometry,a=n!==0&&e.scale<n,h=i!==0&&e.scale>i;if(a||h){const c=h?i:n;if(t&&o){const d=(c-t.scale)/(e.scale-t.scale);s.x=o.x+(s.x-o.x)*d,s.y=o.y+(s.y-o.y)*d}e.scale=c}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);const t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);const t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];const i=Math.floor(e),n=Math.ceil(e);return t[i]+(e-i)*(t[n]-t[i])}scaleToZoom(e){if(!this.effectiveLODs)return-1;const t=this._scales;let i,n;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let s=0;s<t.length-1;s++){if(i=t[s],n=t[s+1],n===e)return s+this.effectiveMinZoom+1;if(i>e&&n<e)return s+this.effectiveMinZoom+1-(e-n)/(i-n)}return-1}snapToClosestScale(e){if(!this.effectiveLODs)return e;const t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new Ln({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t,this._scales[0])),this._lodByScale[e].scale}};r([l({readOnly:!0})],B.prototype,"effectiveLODs",void 0),r([l({readOnly:!0})],B.prototype,"effectiveMinZoom",void 0),r([l({readOnly:!0})],B.prototype,"effectiveMaxZoom",void 0),r([l({readOnly:!0})],B.prototype,"effectiveMinScale",void 0),r([l({readOnly:!0})],B.prototype,"effectiveMaxScale",void 0),r([l()],B.prototype,"lods",void 0),r([l()],B.prototype,"minZoom",void 0),r([l()],B.prototype,"maxZoom",void 0),r([l()],B.prototype,"minScale",void 0),r([l()],B.prototype,"maxScale",void 0),r([l()],B.prototype,"snapToZoom",void 0),B=Ln=r([v("esri.views.2d.constraints.ZoomConstraint")],B);const Go=B,Vc={base:null,key:"type",typeMap:{extent:qe,polygon:Ps}};let R=class extends M{constructor(e){super(e),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new k}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get version(){return`${this._zoom?.uid}/${this._rotation?.uid}/${this._geometry?.uid}`}get _geometry(){const e=this._get("_geometry");return e&&this.geometry===e.geometry&&this.view?.constraintsInfo.spatialReference===e.spatialReference?e:new Ke({geometry:this.geometry,spatialReference:this.view?.constraintsInfo.spatialReference})}get _rotation(){return new Zo({rotationEnabled:this.rotationEnabled})}get _zoom(){const e=this._get("_zoom"),t=this.lods||this.view?.constraintsInfo.lods,i=this.minZoom,n=this.maxZoom,s=this.minScale,o=this.maxScale,a=this.snapToZoom;return e&&e.lods===t&&e.minZoom===i&&e.maxZoom===n&&e.minScale===s&&e.maxScale===o&&e.snapToZoom===a?e:new Go({lods:t,minZoom:i,maxZoom:n,minScale:s,maxScale:o,snapToZoom:a})}canZoomInTo(e){const t=this.effectiveMaxScale;return t===0||e>=t}canZoomOutTo(e){const t=this.effectiveMinScale;return t===0||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),this.customConstraints.forEach(i=>i.constrain(e,t)),e}constrainByGeometry(e){return this._geometry.constrain(e),this.customConstraints.forEach(t=>t.applyPanConstraint?.(e)),e}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};r([l({readOnly:!0})],R.prototype,"effectiveLODs",null),r([l({readOnly:!0})],R.prototype,"effectiveMinScale",null),r([l({readOnly:!0})],R.prototype,"effectiveMaxScale",null),r([l({readOnly:!0})],R.prototype,"effectiveMinZoom",null),r([l({readOnly:!0})],R.prototype,"effectiveMaxZoom",null),r([l({types:Vc,value:null})],R.prototype,"geometry",null),r([l({type:[tl]})],R.prototype,"lods",void 0),r([l()],R.prototype,"minScale",void 0),r([l()],R.prototype,"maxScale",void 0),r([l()],R.prototype,"minZoom",void 0),r([l()],R.prototype,"maxZoom",void 0),r([l()],R.prototype,"rotationEnabled",void 0),r([l()],R.prototype,"snapToZoom",void 0),r([l({type:k})],R.prototype,"customConstraints",void 0),r([l()],R.prototype,"view",void 0),r([l({readOnly:!0})],R.prototype,"version",null),r([l({type:Ke,readOnly:!0})],R.prototype,"_geometry",null),r([l({type:Zo})],R.prototype,"_rotation",null),r([l({readOnly:!0,type:Go})],R.prototype,"_zoom",null),R=r([v("esri.views.2d.MapViewConstraints")],R);const Uo=R;let H=class extends M{constructor(e){super(e),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([_(()=>this.constraints?.version,t=>{this.constraints&&t&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},Tt)])}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:t}=this.state.paddedViewState;return this.state.commitProperty("id"),new L({x:e[0],y:e[1],spatialReference:t})}set center(e){if(e==null)return;if(!this.ready)return void this._set("center",e);let t;try{t=this._project(e,this.state.spatialReference)}catch(n){return void I.getLogger(this).error(new T("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:n}))}const i=this.viewpoint;Tn(i,i,t),this.viewpoint=i}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(e){if(e==null)return;if(!e.width||!e.height)return void I.getLogger(this).error(new T("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",e),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let t;try{t=this._project(e,this.state.spatialReference)}catch(n){return void I.getLogger(this).error(new T("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:n}))}const i=this.viewpoint;mc(i,i,t,this.state.size,{constraints:this.constraints}),this.viewpoint=i}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const t=this.viewpoint;xc(t,t,e),this.viewpoint=t}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",void 0);const i=this._get("extent");return void(i&&(this._set("extent",void 0),this._set("center",i.center)))}const t=this.viewpoint;Ao(t,t,e),this.viewpoint=t}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(e){if(e==null)return;if(!this.ready)return this._set("viewpoint",e),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let t,i;try{t=this._project(e,this.state.spatialReference),!e.scale||isNaN(e.scale)?i=new T("mapview:invalid-viewpoint",`invalid scale value of ${e.scale}`):e.targetGeometry==null&&(i=new T("mapview:invalid-viewpoint","geometry not defined"))}catch(s){i=new T("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:s})}if(i)return void I.getLogger(this).error(i);this._scaleBeforeChangingSpatialReference=null;const n=new X({targetGeometry:new L,scale:0,rotation:0});F(n,t),this.constraints?.constrain(n,this.state.paddedViewState.viewpoint),this.state.viewpoint=n,this._set("viewpoint",n)}get visibleArea(){return this.ready?this.state.visibleArea:null}get zoom(){return this.ready?this.constraints?.scaleToZoom(this.scale)??-1:this._get("zoom")}set zoom(e){if(!(e>=0))return;if(!this.ready){this._set("zoom",e),this._set("scale",void 0);const n=this._get("extent");return void(n&&(this._set("extent",void 0),this._set("center",n.center)))}const t=this.constraints?.zoomToScale(e)??0;if(!t)return void this._set("zoom",-1);const i=this.viewpoint;Ao(i,i,t),this.viewpoint=i,this._set("zoom",this.constraints?.scaleToZoom(this.scale)??-1)}getUserStartupOptions(e){if(!e[0]&&!e[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:t,constraints:i}=this,n=this._get("center"),s=this._get("extent"),o=this._get("scale"),a=this._get("rotation"),h=this._get("viewpoint"),c=this._get("zoom"),d=c!=null&&i!=null&&i.zoomToScale(c)||void 0;let p,m,u;const g=h?.rotation,f=h?.targetGeometry;f?.type==="extent"?p=f:f?.type==="point"&&(m=f,u=h?.scale);const b=s??p;return{center:n??m??b?.center,rotation:a??g,scale:(o??d??u??(b&&ui(b,[e[0]-t.left-t.right,e[1]-t.top-t.bottom])))||void 0}}startup(e,t,i,n){const s=e.targetGeometry;try{this._project(e,i)}catch(o){I.getLogger(this).warn(new ks("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:s.toJSON(),spatialReference:i,error:o})),e.targetGeometry=n||new L({x:0,y:0,spatialReference:i})}this.constraints?.fit(e),this._set("state",new En({padding:this.padding,size:t,viewpoint:e})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[e,t],spatialReference:i,rotation:n,scale:s}=this.state.paddedViewState,o=new L({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",o),this._set("zoom",-1),this._set("rotation",n),this._set("scale",s),this._set("state",null)}changeSpatialReference(e){const t=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=t.scale;else{const h=t.viewpoint.clone();h.scale=this._scaleBeforeChangingSpatialReference,t.viewpoint=h}const i=t.clone(),[n,s]=t.center;let o=null;try{o=this._project(new L({x:n,y:s,spatialReference:t.spatialReference}),e)}catch(h){Ar()||I.getLogger(this).warn(new ks("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:o?.toJSON(),spatialReference:e,error:h}))}o||(o=new L({x:0,y:0,spatialReference:e}));const a=Tn(new X({targetGeometry:new L,scale:0,rotation:0}),t.viewpoint,o);i.viewpoint=a;try{const h=[t.size[0]/2,t.size[1]/2],c=[h[0]+20,h[1]],d=t.toMap([0,0],c),{x:p,y:m}=this._project(new L({x:d[0],y:d[1],spatialReference:t.spatialReference}),e);d[0]=p,d[1]=m,i.toScreen(d,d);const u=Oo(h,d,c),g=Math.hypot(d[0]-h[0],d[1]-h[1])/20;!Number.isFinite(g)||Math.abs(g)>4?(a.rotation=0,a.targetGeometry=new L({x:0,y:0,spatialReference:e})):(a.scale*=g,a.scale>U("mapview-srswitch-adjust-rotation-scale-threshold")?a.rotation=0:a.rotation+=Number.isFinite(u)?u:0)}catch{}this._get("constraints")?.constrain(a,void 0),this._get("state").viewpoint=a}resize(e,t){if(!this.ready)return;const i=this.state;let n=this.state.paddedViewState.viewpoint;const s=this.state.paddedViewState.size.slice();i.size=[e,t],Mc(n,n,s,this.state.paddedViewState.size,this.resizeAlign),n=this.constraints?.constrain(n,void 0)??n,this.state.viewpoint=n}toMap(e){if(!this.ready)return null;const t=[0,0],[i,n]=this.state.toMap(t,[e.x,e.y]),s=this.state.spatialReference;return new L({x:i,y:n,spatialReference:s})}toScreen(e,t){if(!this.ready)return null;const i=this._project(e,this.state.spatialReference),n=[i.x,i.y];return t?.pickClosestTarget===!1||this.state.paddedViewState.wrapMapCoordinate(n,n),this.state.toScreen(n,n),A(n[0],n[1])}_project(e,t){const i=e?.targetGeometry||e;if(!t)return e;if(!i)return null;if(t.imageCoordinateSystem||i.spatialReference?.imageCoordinateSystem||$t(t,i.spatialReference))return e;const n=xt(i,t);if(!n)throw new T("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:i,spatialReference:t});return Oc(e)?(e.targetGeometry=n,e):n}};function Oc(e){return e?.declaredClass==="esri.Viewpoint"}r([l({type:L})],H.prototype,"center",null),r([l()],H.prototype,"constraints",void 0),r([l({type:qe})],H.prototype,"extent",null),r([l({value:{top:0,right:0,bottom:0,left:0},cast:e=>({top:0,right:0,bottom:0,left:0,...e})})],H.prototype,"padding",null),r([l()],H.prototype,"ready",void 0),r([l()],H.prototype,"resizeAlign",void 0),r([l({readOnly:!0})],H.prototype,"resolution",null),r([l({type:Number})],H.prototype,"rotation",null),r([l({type:Number})],H.prototype,"scale",null),r([l({readOnly:!0})],H.prototype,"state",void 0),r([l({type:X})],H.prototype,"viewpoint",null),r([l({readOnly:!0})],H.prototype,"visibleArea",null),r([l()],H.prototype,"zoom",null),H=r([v("esri.views.2d.ViewStateManager")],H);function Wo(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function qo(e,t){return t.some(i=>Wo(e,i))}function jo(e,{dragPrimary:t,dragSecondary:i,dragTertiary:n}){return[{key:"primary",value:t},{key:"secondary",value:i},{key:"tertiary",value:n}].filter(s=>s.value===e).map(s=>s.key)}let Bo=class extends O{constructor(e,t){super(!0),this._view=e,this.registerIncoming("double-click",t,i=>this._handleDoubleClick(i,t))}_handleDoubleClick(e,t){Wo(e.data,"primary")&&(e.stopPropagation(),t?this._view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this._view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}},Ac=class extends O{constructor(e,t,i){super(!0),this.view=e,this.pointerType=t,this.registerIncoming("double-tap-drag",i,n=>this._handleDoubleTapDrag(n))}_handleDoubleTapDrag(e){const{data:t}=e,{pointerType:i}=t;if(i!==this.pointerType)return;e.stopPropagation();const{action:n,delta:s}=t,{view:o}=this,{mapViewNavigation:a}=o;switch(n){case"begin":{const{scale:h}=o;this._startScale=h,this._currentScale=h,this._previousDelta=s,a.begin();break}case"update":{if(this._previousDelta.y===s.y)return;this._previousDelta=s;const h=1.015**s.y,c=this._startScale*h,d=c/this._currentScale;a.setViewpointImmediate(d),this._currentScale=c;break}case"end":{const{constraints:h}=o,{effectiveLODs:c,snapToZoom:d}=h;if(!d||!c)return void a.end();const p=h.snapScale(this._currentScale),m=(s.y>0?Math.max(p,h.snapToPreviousScale(this._startScale)):Math.min(p,h.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(m).then(()=>{a.end()});break}}}},gi=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const t=e.data,i=t.pointers.size;switch(t.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){this._startEvent=e,this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){this._callbacks.condition?.(this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},zc=class extends O{constructor(e,t,i){super(!0),this.view=e,this.pointerActions=t,this.registerIncoming("drag",i,n=>this._handleDrag(n)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(e){super.onInstall(e),this._dragEventSeparator=new gi({start:(t,i)=>{this.view.mapViewNavigation.pan.begin(this.view,i.data),i.stopPropagation()},update:(t,i)=>{this.view.mapViewNavigation.pan.update(this.view,i.data),i.stopPropagation()},end:(t,i)=>{this.view.mapViewNavigation.pan.end(this.view,i.data),i.stopPropagation()},condition:(t,i)=>t===1&&qo(i.data,this.pointerActions)})}_handleDrag(e){const t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},Nc=class extends O{constructor(e,t,i){super(!0),this._view=e,this.pointerActions=t;const n=this._view.mapViewNavigation;this._dragEventSeparator=new gi({start:(s,o)=>{n.rotate.begin(this._view,o.data),o.stopPropagation()},update:(s,o)=>{n.rotate.update(this._view,o.data),o.stopPropagation()},end:(s,o)=>{n.rotate.end(),o.stopPropagation()},condition:(s,o)=>s===1&&qo(o.data,this.pointerActions)}),this.registerIncoming("drag",i,s=>this._dragEventSeparator.handle(s))}};function he(e){let t=e*e;return e<0&&(t*=-1),t}function Fc(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function Hc(e,t,i){const n=i,s=e.state,o=e.device,a=t.tiltDirection==="forward-down"?1:-1,h=1;return o.deviceType==="standard"?(n.translation[0]=he(s.axes[0]),n.translation[1]=he(s.axes[1]),n.translation[2]=he(s.buttons[7])-he(s.buttons[6]),n.heading=he(s.axes[2]),n.tilt=he(s.axes[3])):o.deviceType==="spacemouse"&&(n.translation[0]=1.2*he(s.axes[0]),n.translation[1]=1.2*he(s.axes[1]),n.translation[2]=2*-he(s.axes[2]),n.heading=1.2*he(s.axes[5]),n.tilt=1.2*he(s.axes[3])),n.tilt*=a,Hl(n.translation,n.translation,h),n}function Zc(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let Gc=class extends O{constructor(e){super(!0),this._view=e,this._frameTask=null,this._watchHandles=new vs,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",t=>this._handleGamePadEvent(t)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([_(()=>this._view.navigation.gamepad?.enabled,t=>{t?(this._handle.resume(),this._frameTask||(this._frameTask=st({update:i=>this._frameUpdate(i.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},G)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(e){const t=this._view.navigation.gamepad.device;t&&e.data.device!==t||this._currentDevice&&this._currentDevice!==e.data.device||(e.data.action==="end"?(this._currentDevice=null,Fc(this._transformation)):(this._currentDevice=e.data.device,Hc(e.data,this._view.navigation.gamepad,this._transformation)),this._frameTask?.resume())}_frameUpdate(e){const t=this._transformation;if(Zc(t))return void this._frameTask?.pause();const i=this._view.viewpoint.clone(),n=this._view.navigation.gamepad.velocityFactor,s=Wc*n*e;Lt(i,i,[t.translation[0]*s,-t.translation[1]*s]);const o=1+t.translation[2]*qc*e,a=this._view.constraints.rotationEnabled?-t.heading*Uc*e:0,h=this._view.size,c=[h[0]/2,h[1]];xn(i,i,o,a,c,h);const d=this._view.constraints.constrain(i,this._view.viewpoint);this._view.viewpoint=d}};const Uc=.06,Wc=.7,qc=6e-4;function Ko(e){const t=()=>e(document.visibilityState==="visible");return document.addEventListener("visibilitychange",t),qt(()=>document.removeEventListener("visibilitychange",t))}let jc=class extends O{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=n=>{const s=this._keyMap[n.data.key];if(n.modifiers.has("Meta")||n.modifiers.has("Control"))return void this._stopMovement();if(s==null)return;n.stopPropagation(),n.preventDefault();const o=n.type==="key-down";if(this._pressedKeys[o?"add":"delete"](s),o){if(this._direction===s)return;this._direction=s,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{const a=this._timeout===void 0,h=this._pressedKeys.size>0;a||h?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[t.left]:"left",[t.right]:"right",[t.up]:"up",[t.down]:"down"},this.registerIncoming("key-down",i,this._handleKey),this.registerIncoming("key-up",i,this._handleKey),this.registerIncoming("blur",i,this._stopMovement),this._visibilityHandle=Ko(n=>n?null:this._stopMovement())}onUninstall(){this._stopMovement(),this._visibilityHandle?.remove()}get _direction(){return this._currentDirection}set _direction(e){const t=this._currentDirection!=null;if(e!=null){if(t||this.view.mapViewNavigation.begin(),this._currentDirection!==e)switch(e){case"left":this.view.mapViewNavigation.continuousPanLeft();break;case"right":this.view.mapViewNavigation.continuousPanRight();break;case"up":this.view.mapViewNavigation.continuousPanUp();break;case"down":this.view.mapViewNavigation.continuousPanDown()}}else t&&this.view.mapViewNavigation.stop();this._currentDirection=e}_setTimeout(e){clearTimeout(this._timeout),this._timeout=e===void 0?void 0:setTimeout(()=>{this._timeout=void 0,e()},this._stickyKeyDuration)}},Bc=class extends O{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._keyToDirection=new Map,this._pressed=!1,this._addKeysMapping(t),this.registerIncoming("key-down",i,n=>this._handleKeyDown(n)),this.registerIncoming("key-up",i,n=>this._handleKeyUp(n)),this.registerIncoming("blur",i,()=>this._handleStop()),this._visibilityHandle=Ko(n=>n?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove(),this._handleStop()}_addKeysMapping(e){this._addKeyMapping(e.clockwise,"clockwise"),this._addKeyMapping(e.counterClockwise,"counterClockwise"),this._addKeyMapping(e.reset,"reset")}_addKeyMapping(e,t){for(const i of e)this._keyToDirection.set(i,t)}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,t){const i=e.modifiers;if(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)return;const n=this._keyToDirection.get(e.data.key);if(this._pressed=n!=null,this._pressed){if(e.preventDefault(),t)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continuousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continuousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}};var pt;(function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"})(pt||(pt={}));let Kc=class extends O{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._keysToZoomAction={},this.registerIncoming("key-down",i,n=>this._handleKeyDown(n)),t.zoomIn.forEach(n=>this._keysToZoomAction[n]=pt.IN),t.zoomOut.forEach(n=>this._keysToZoomAction[n]=pt.OUT)}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const t=e.modifiers;if(t.size>0&&!t.has("Shift"))return;const{key:i}=e.data;if(!(i in this._keysToZoomAction))return;const n=this._keysToZoomAction[i],{mapViewNavigation:s}=this.view;let o=null;switch(n){case pt.IN:o=s.zoomIn();break;case pt.OUT:o=s.zoomOut();break;default:return}s.begin(),o.then(()=>s.end()),e.stopPropagation()}};const $c=.6;let Yc=class extends O{constructor(e,t){super(!0),this._view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",t,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(this._view.navigation.actionMap.mouseWheel!=="zoom"||(e.preventDefault(),e.stopPropagation(),!this._canZoom))return;const t=this._view.mapViewNavigation,{x:i,y:n,deltaY:s}=e.data,o=1/$c**(1/60*s),a=t.zoom(o,[i,n]);a&&(this._canZoom=!1,a.catch(()=>{}).then(()=>{this._canZoom=!0,t.end()}))}},Xc=class extends O{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",i=>this._handleDrag(i)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const t=this.view.mapViewNavigation;this._dragEventSeparator=new gi({start:(i,n)=>{t.pinch.begin(this.view,n.data),n.stopPropagation()},update:(i,n)=>{t.pinch.update(this.view,n.data),n.stopPropagation()},end:(i,n)=>{t.pinch.end(this.view),n.stopPropagation()},condition:i=>i>=2})}_handleDrag(e){this._dragEventSeparator.handle(e)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function $o(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value||1:0),axes:t.axes.map(i=>ed(i,e.axisThreshold))}:{buttons:[],axes:[]}}function Qc(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function Jc(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function ed(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}let td=class{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,h=this._inputDevices[a];h&&(this._emitGamepadEvent(o,$o(h),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(h),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(Yo(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const t=new hn(e);t.deviceType!=="unknown"&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=st({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!t;Yo(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=$o(s),h=i||Jc(a);o&&(o.timestamp===n.timestamp||!o.active&&h||Qc(o.state,a))||this._emitGamepadEvent(n,a,!h)})}_emitGamepadEvent(e,t,i){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:o})}};function id(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}function Yo(e){for(const t of navigator.getGamepads())id(t)&&e(t)}const Xo=U("edge"),nd=U("chrome"),sd=U("ff"),od=U("safari"),Qo="esri-view-surface",ut={touchNone:`${Qo}--touch-none`,touchPan:`${Qo}--touch-pan`};let Jo=class lr{constructor(t,i){this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new td(t,i),this._gamepadSource.onEvent=n=>this._callback("gamepad",n)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(t=>this._releasePointerCaptureSafe(t)),this._activePointerCaptures.clear(),this._gamepadSource=re(this._gamepadSource),this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const n=this._active[i];this._element.removeEventListener(Vn[i],n),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&Vn[i]){const n=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(Vn[i],n),this._active[i]=n}}),this._gamepadSource&&(this._gamepadSource.hasEventListeners=t?.has("gamepad")??!1)}setPointerCapture(t,i){i?this._setPointerCaptureSafe(t.pointerId):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?ut.touchNone:ut.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?ut.touchPan:ut.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(ut.touchNone),this._element.classList.remove(ut.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCaptureSafe(t){try{this._element.setPointerCapture(t),this._activePointerCaptures.add(t)}catch{}}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const n=po(this._element,t);return lr.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),i.x=n.x,i.y=n.y,i}_handleKey(t,i){const{key:n}=i;n&&t==="key-up"&&this._keyDownState.delete(n);const s={native:i,key:n,repeat:!!n&&this._keyDownState.has(n)};n&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const n=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,n)}_handlePointerPreventDefault(t,i){const n=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,n)}_getDeltaFromTrackpadOrMouseWheel(t){return t.shiftKey&&U("mac")&&t.deltaY===0?t.deltaX:t.deltaY}_handleMouseWheel(t,i){let n=this._getDeltaFromTrackpadOrMouseWheel(i);switch(i.deltaMode){case 0:Xo&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}Xo?n*=.7:nd||od?n*=.6:sd&&(n*=1.375);const s=100,o=Math.abs(n);o>s&&(n=n/o*200/(1+Math.exp(-.02*(o-s))));const a=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:n});this._callback(t,a)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const n={native:i};i.preventDefault(),this._callback(t,n)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}};Jo.test={disableSubpixelCoordinates:!1};const Vn={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let ad=class extends O{constructor(){super(!0),this.registerIncoming("context-menu",e=>e.data.native.preventDefault())}};const N={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function yi(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function rd(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function ld(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:A()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[P,x]=e,[Z,$]=[x.x-P.x,x.y-P.y];return t.radius=Math.sqrt(Z*Z+$*$)/2,t.center.x=(P.x+x.x)/2,t.center.y=(P.y+x.y)/2,t}let i=0,n=0;for(let P=0;P<e.length;P++)i+=e[P].x,n+=e[P].y;i/=e.length,n/=e.length;const s=e.map(P=>P.x-i),o=e.map(P=>P.y-n);let a=0,h=0,c=0,d=0,p=0,m=0,u=0;for(let P=0;P<s.length;P++){const x=s[P],Z=o[P],$=x*x,fe=Z*Z;a+=$,h+=fe,c+=x*Z,d+=$*x,p+=fe*Z,m+=x*fe,u+=Z*$}const g=.5*(d+m),f=.5*(p+u),b=a*h-c*c,D=(g*h-f*c)/b,E=(a*f-c*g)/b,de=A(D+i,E+n);return{radius:Math.sqrt(D*D+E*E+(a+h)/e.length),center:de}}function $e(e){const{native:t}=e,{pointerId:i,button:n,pointerType:s}=t;return s==="mouse"?`${i}:${n}`:`${s}`}let hd=class extends O{constructor(e=N.maximumDoubleClickDelay,t=N.maximumDoubleClickDistance,i=N.maximumDoubleTouchDelay,n=N.maximumDoubleTouchDistance,s=Mt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=A(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new gi({start:(o,a)=>this._dragStart(o,a),update:(o,a)=>this._dragUpdate(a),end:(o,a)=>this._dragEnd(a)}),this.registerIncoming("drag",o=>this._dragEventSeparator.handle(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(e=>{e.doubleTapTimeout=oe(e.doubleTapTimeout)})}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleTapTimeout!=null)return!0;return!1}_clearPointerDown(e){const t=this._pointerState.get(e);t&&(t.doubleTapTimeout=oe(t.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())}_dragStart(e,t){if(!this._doubleTapDragReady||e!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:i,modifiers:n}=t,{center:s}=i;this._dragStartCenter=s;const o=On("begin",A(0,0),i);this._doubleTapDrag.emit(o,void 0,n),t.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:n}=t,s=On("update",A(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),t);this._doubleTapDrag.emit(s,void 0,i),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:n}=t,s=On("end",A(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),t);this._doubleTapDrag.emit(s,void 0,i),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:t}=e,i=$e(t),n=this._pointerState.get(i),{pointerType:s}=t.native;if(n){const o=s==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(i),yi(n.event.data,t)>o?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(e){const{data:t}=e,{pointerType:i}=t.native,n=$e(t),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(n),s);this._pointerState.set(n,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}};function On(e,t,i){const{button:n,buttons:s,pointer:o,pointers:a,pointerType:h,timestamp:c}=i;return{action:e,delta:t,button:n,buttons:s,pointer:o,pointers:a,pointerType:h,timestamp:c}}let cd=class extends O{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,i,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:n,pointers:dd(this._activePointerMap),pointer:t,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const t=e.native.pointerId,i=fi(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,n);const s=vi(n,ea(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const t=e.native.pointerId,i=this._activePointerMap.get(t);i?i.event=e:this._addPointer(e)}_removePointer(e){const t=fi(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=fi(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=vi(i,t)-e,i.lastAngle=vi(i,t)-e})}_emitEvent(e,t,i){const n=fi(this._activePointerMap);this._drag.emit(this._createPayload(e,t,n,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,i=ee(e.timestamp);this._activePointerMap.get(t)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,ee(e.timestamp))))}_handlePointerDrag(e){const t=e.data,i=t.currentEvent,n=ee(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function ea(e){const t=[];return e.forEach(i=>{t.push(A(i.event.x,i.event.y))}),ld(t)}function fi(e){const t=ea(e);let i=0;return e.forEach(n=>{let s=vi(n,t),o=s-n.lastAngle;for(;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;s=n.lastAngle+o,n.lastAngle=s;const a=s-n.initialAngle;i+=a}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function dd(e){const t=new Map;return e.forEach((i,n)=>t.set(n,i.event)),t}function vi(e,t){const i=e.event,n=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,n)}var ta;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(ta||(ta={}));let pd=class extends O{constructor(e=N.maximumDoubleClickDelay,t=N.maximumDoubleClickDistance,i=N.maximumDoubleTouchDelay,n=N.maximumDoubleTouchDistance,s=Mt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=$e(t);if(!this._pointerState.has(i)){const n={downButton:t.native.button,x:t.x,y:t.y,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(t.native)}}_handlePointerUp(e){const t=e.data,i=$e(t),n=this._pointerState.get(i);if(n&&n.downButton===t.native.button){const s=n.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),yi(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(t))):yi(n,e.data)>o?this._removeState(t):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,t){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const t=$e(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},ud=class extends O{constructor(e=N.maximumClickDelay,t=N.movementUntilMouseDrag,i=N.movementUntilPenDrag,n=N.movementUntilTouchDrag,s=N.holdDelay,o=Mt){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=t,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",a=>this._handlePointerDown(a)),this.registerIncoming("pointer-up",a=>this._handlePointerLoss(a,"pointer-up")),this.registerIncoming("pointer-capture-lost",a=>this._handlePointerLoss(a,"pointer-capture-lost")),this.registerIncoming("pointer-cancel",a=>this._handlePointerLoss(a,"pointer-cancel")),this._moveHandle=this.registerIncoming("pointer-move",a=>this._handlePointerMove(a)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=oe(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=t.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const t=e.data,i=t.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(_i("update",n,t),void 0,n.modifiers):rd(t,n.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),n.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const t=e.data,i=t.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(_i("start",n,t)):this._pointerDrag.emit(_i("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,t){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(_i("end",s,t==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):t==="pointer-up"&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}};function _i(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}let md=class extends O{constructor(e=N.maximumDoubleClickDelay,t=N.maximumDoubleClickDistance,i=N.maximumDoubleTouchDelay,n=N.maximumDoubleTouchDistance,s=Mt){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",o=>this._handleImmediateClick(o)),this.registerIncoming("pointer-down",o=>this._handlePointerDown(o))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=oe(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(e.doubleClickTimer!=null)return!0;return!1}_clearDoubleClickTimer(e,t){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=oe(i.doubleClickTimer),t&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);t.pointerDownCount===1&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const t=e.data,{pointerType:i}=t.native,n=gd(t);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,h=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;yi(o,t)>h?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const t=$e(e.data),i=this._pointerState.get(t);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:i}}=t,n=$e(t),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s);this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function gd(e){const{pointerId:t,pointerType:i,button:n}=e.native;return i==="mouse"?`${t}:${n}`:`${i}`}const wi={counter:"Control",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwise:["a","A"],counterClockwise:["d","D"],reset:["n","N"]}},ia=Symbol("handles");let Ye=class extends M{initialize(){const e=()=>this.view?.ready;this.addHandles([We(()=>!e(),()=>this._disconnect()),We(e,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??!1}isModifierKeyDown(e){return this._inputManager?.isModifierKeyDown(e)??!1}_disconnect(){this.view.viewEvents.disconnect(),this.removeHandles(ia),this._inputManager=re(this._inputManager)}_connect(){const e=this.view.surface,t=new Jo(e,this.view.input),i=[new pd,new ud,new md,new cd(this.view.navigation),new hd],n=new te({eventSource:t,recognizers:i}),s=new zc(this.view,["primary"]),o=new Nc(this.view,["secondary"]);n.installHandlers("prevent-context-menu",[new ad],we.INTERNAL),n.installHandlers("navigation",[new Xc(this.view),new Gc(this.view),new Yc(this.view),new Bo(this.view),new Bo(this.view,[wi.counter]),s,new jc(this.view,wi.pan),new Kc(this.view,wi.zoom),new Bc(this.view,wi.rotate),o,new Ac(this.view,"touch")],we.INTERNAL),this.view.viewEvents.connect(n),this._source=t,this._inputManager=n,this.addHandles([_(()=>this.view?.navigation?.browserTouchPanEnabled,a=>{this._source&&(this._source.browserTouchPanningEnabled=!a)},G),_(()=>{const{actionMap:a}=this.view.navigation;return{panActions:jo("pan",a),rotateActions:jo("rotate",a)}},({panActions:a,rotateActions:h})=>{s.pointerActions=a,o.pointerActions=h},ae)],ia)}get test(){}};r([l()],Ye.prototype,"view",void 0),r([l()],Ye.prototype,"latestPointerType",null),r([l()],Ye.prototype,"latestPointerLocation",null),r([l()],Ye.prototype,"multiTouchActive",null),Ye=r([v("esri.views.2d.input.MapViewInputManager")],Ye);const yd=Ye,na=160;let At=class extends M{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=na&&this.clear()},na))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};r([l()],At.prototype,"_timer",void 0),r([l()],At.prototype,"stationary",null),At=r([v("esri.views.2d.support.StationaryManager")],At);const fd=e=>{let t=class extends e{constructor(...i){super(...i),this.fullOpacity=1,this.stateManager=new H({constraints:new Uo({view:this})}),this.goToManager=new mi({view:this}),this.stationaryManager=new At,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!1,labelsAnimationTime:0,labelCollisionsEnabled:!1},this.frameTask=new Dc(this),this.inputManager=new yd({view:this}),this.viewEvents=new co(this),this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([_(()=>this.viewpoint,()=>this.stationaryManager.flip(),Tt),this.on("resize",n=>this.stateManager.resize(n.width,n.height))])}get constraintsInfo(){return{lods:null,spatialReference:null}}get extent(){return this.stateManager?.extent??null}set extent(i){this.stateManager.extent=i}get state(){return this.stateManager.state}get interacting(){return this.navigating}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}set animation(i){const n=this._get("animation");if(i===n)return;if(n&&n.stop(),i!==this.animationManager.animation&&this.animationManager.stop(),!i||i.isFulfilled())return void this._set("animation",null);this._set("animation",i);const s=()=>{this.destroyed||i===this._get("animation")&&(this._set("animation",null),this.frameTask?.requestFrame())};i.when(s,s)}get constraints(){return this.stateManager?.constraints}set constraints(i){i.view=this;const n=this.stateManager.constraints;this.stateManager.constraints=i,n?.destroy()}get padding(){return this.stateManager?.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(i){this.stateManager.resizeAlign=i}get rotation(){return this.stateManager.rotation??0}set rotation(i){const{rotationEnabled:n}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=i,this.constraints.rotationEnabled=n}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(i){this.stateManager.viewpoint=i,this.frameTask.requestFrame()}on(i,n,s,o){return this.inputManager&&this.viewEvents.on(i,n,s,o)||super.on(i,n)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}goTo(i,n){return this.goToManager.goTo(i,n)}};return r([l({readOnly:!0})],t.prototype,"animationManager",void 0),r([l({readOnly:!0})],t.prototype,"fullOpacity",void 0),r([l()],t.prototype,"stateManager",void 0),r([l()],t.prototype,"constraintsInfo",null),r([l()],t.prototype,"extent",null),r([l()],t.prototype,"goToManager",void 0),r([l({readOnly:!0})],t.prototype,"state",null),r([l({readOnly:!0})],t.prototype,"mapViewNavigation",void 0),r([l()],t.prototype,"renderingOptions",void 0),r([l({readOnly:!0})],t.prototype,"interacting",null),r([l()],t.prototype,"stationary",null),r([l()],t.prototype,"animation",null),r([l({type:Uo})],t.prototype,"constraints",null),r([l({readOnly:!0})],t.prototype,"inputManager",void 0),r([l()],t.prototype,"padding",null),r([l()],t.prototype,"resizeAlign",null),r([l()],t.prototype,"rotation",null),r([l({readOnly:!0})],t.prototype,"viewEvents",void 0),r([l({type:X})],t.prototype,"viewpoint",null),t=r([v("esri.views.Viewport2DMixin")],t),t};let sa=class{constructor(e){this._view=e,this.viewpoint=new X({targetGeometry:new L,scale:0,rotation:0})}get view(){return this._view}get size(){const[e,t]=this._view.size;return Math.sqrt(e*e+t*t)}get scale(){return this.viewpoint.scale}get rotation(){return this.viewpoint.rotation}get center(){return this.viewpoint.targetGeometry}get scaleToResolutionFactor(){return vn(this.center.spatialReference)}pixelsPerPanAtZoom(e){return 1/(e*this.scaleToResolutionFactor)}zoomAtPixelsPerPan(e){return 1/(e*this.scaleToResolutionFactor)}pixelsPerRotate(){return this.size/2}compareTo(e,t){t.pan=zr(this.center,e.center);let i=Math.abs(e.rotation-this.rotation);i=i>=180?360-i:i,t.rotate=Ai(i),t.sourceZoom=this.scale,t.targetZoom=e.scale}interpolate(e,t,i){const{pan:n,rotate:s,zoom:o,zoomOffset:a}=i,{center:h}=this;h.spatialReference=e.center.spatialReference,h.x=Xt(e.center.x,t.center.x,n),h.y=Xt(e.center.y,t.center.y,n),this.viewpoint.scale=Xt(e.scale,t.scale+a,o);let c=e.rotation;const d=t.rotation;Math.abs(d-c)>=180&&(c+=360*(c<d?1:-1)),this.viewpoint.rotation=Xt(c,d,s)}copyFrom(e){F(this.viewpoint,e.viewpoint),this._view=e.view}};const vd=e=>e,bi=e=>e*e,An=e=>1-bi(1-e),_d=e=>e<.5?bi(2*e)/2:(An(2*(e-.5))+1)/2,zn=e=>e*e*e,oa=e=>1-zn(1-e),wd=e=>e<.5?zn(2*e)/2:(oa(2*(e-.5))+1)/2,Nn=e=>e*e*e*e,aa=e=>1-Nn(1-e),bd=e=>e<.5?Nn(2*e)/2:(aa(2*(e-.5))+1)/2,Fn=e=>e*e*e*e*e,ra=e=>1-Fn(1-e),Md=e=>e<.5?Fn(2*e)/2:(ra(2*(e-.5))+1)/2,Hn=e=>1-Math.cos(e*Math.PI/2),la=e=>1-Hn(1-e),Td=e=>e<.5?Hn(2*e)/2:(la(2*(e-.5))+1)/2,Zn=e=>2**(10*(e-1)),Gn=e=>1-Zn(1-e),xd=e=>e<.5?Zn(2*e)/2:(Gn(2*(e-.5))+1)/2,Un=e=>-(Math.sqrt(1-e*e)-1),ha=e=>1-Un(1-e),Sd=e=>e<.5?Un(2*e)/2:(ha(2*(e-.5))+1)/2;function ne(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return n=>n<i?e*n*n:t*n-t+1}function se(e,t){return(i,n)=>i<t?t*e(i/t,n):1-e((1-i)/(1-t),n)*(1-t)}const Pd=se(ne(1),1),kd=se(ne(1),0),Wn=se(ne(1),.5),Cd=se(ne(2),1),Ed=se(ne(2),0),Id=se(ne(2),.5),Dd=se(ne(3),1),Rd=se(ne(3),0),Ld=se(ne(3),.5),Vd=se(ne(4),1),Od=se(ne(4),0),Ad=se(ne(4),.5),ca={linear:vd,"in-quad":bi,"out-quad":An,"in-out-quad":_d,"in-coast-quad":Pd,"out-coast-quad":kd,"in-out-coast-quad":Wn,"in-cubic":zn,"out-cubic":oa,"in-out-cubic":wd,"in-coast-cubic":Cd,"out-coast-cubic":Ed,"in-out-coast-cubic":Id,"in-quart":Nn,"out-quart":aa,"in-out-quart":bd,"in-coast-quart":Dd,"out-coast-quart":Rd,"in-out-coast-quart":Ld,"in-quint":Fn,"out-quint":ra,"in-out-quint":Md,"in-coast-quint":Vd,"out-coast-quint":Od,"in-out-coast-quint":Ad,"in-sine":Hn,"out-sine":la,"in-out-sine":Td,"in-expo":Zn,"out-expo":Gn,"in-out-expo":xd,"in-circ":Un,"out-circ":ha,"in-out-circ":Sd,ease:e=>ai.ease(e),"ease-in":e=>ai.easeIn(e),"ease-out":e=>ai.easeOut(e),"ease-in-out":e=>ai.easeInOut(e)};let zd=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const zt={desiredScreenFlow:2,minDuration:ee(500),maxDuration:ee(8e3)},da={...zt,maxDuration:ee(4e3)};let Nd=class hr{constructor(t){this._createCamera=t,this.compared=new zd,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:zt.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new hr(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,n){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=n.desiredScreenFlow??zt.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>qi()}get hasFov(){return Math.abs(this.compared.fov)>qi()}get hasRotate(){return this.compared.rotate>qi()}},Fd=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},Hd=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,t)=>Y(e+t.time),Y(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0;const s=this.definition,o=this.segments.reduce((a,h)=>a||h.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const h=this.segments[a],c=h.definition;if(e<=h.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(h,h.time===0?0:e/h.time,t),s.hasPan&&!isNaN(t.pan)&&isFinite(s.compared.pan)?t.pan=(i+c.compared.pan*t.pan)/s.compared.pan:t.pan=1,s.hasRotate&&!isNaN(t.rotate)&&isFinite(s.compared.rotate)?t.rotate=(n+c.compared.rotate*t.rotate)/s.compared.rotate:t.rotate=1,o&&!isNaN(t.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:d,targetZoom:p}=c.compared,m=t.zoom*(p-d)+d,u=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,f=Math.abs(p-u)>Math.abs(d-u)?p:d;t.zoomOffset=f-g,t.zoom=(m-u)/(f-u)}else t.zoom=1;return t}e-=h.time,i+=c.compared.pan,n+=c.compared.rotate}}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i)}},qn=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,i=t.sourceZoom,n=t.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotate()+e.target.pixelsPerRotate())/2;this._rotatePixels=t.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;i&&(n&&(o=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const h=this.definition.desiredPixelFlow;if(i&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*h,this._panPixelFlow=a/c*h,this._rotatePixelFlow=o/c*h}else if(i&&n){const c=1+o;this._zoomPixelFlow=o/c*h,this._panPixelFlow=1/c*h}else if(i&&s){const c=1+a;this._zoomPixelFlow=a/c*h,this._rotatePixelFlow=1/c*h}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,d=1+c;this._panPixelFlow=c/d*h,this._rotatePixelFlow=1/d*h}else n?this._panPixelFlow=h:i?this._zoomPixelFlow=h:s&&(this._rotatePixelFlow=h);if(this._time=Y(Math.max(this.rotateTime,this.zoomTime,this.panTime)),this.fovTime>this._time){const c=this.fovTime/this._time;this._time=this.fovTime,this._zoomPixelFlow/=c,this._panPixelFlow/=c,this._rotatePixelFlow/=c}}get rotateTime(){return this.definition.hasRotate?Y(this._rotatePixels/this._rotatePixelFlow):Y(0)}get zoomTime(){return this.definition.hasZoom?Y(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):Y(0)}get fovTime(){return this.definition.hasFov?Y(Math.abs(this.definition.compared.fov)/Zd):Y(0)}get panTime(){if(!this.definition.hasPan)return Y(0);if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return Y(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return Y(this._panPixelsAtSource/this._panPixelFlow)}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(t*(t/i)**-e-t)/(i-t)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:t,segmentEnd:i}=this.definition;return t+e*(i-t)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),t.zoom=this._interpolateComponentsZoom(e),t.pan=this._interpolateComponentsPan(e),t.rotate=this._interpolateComponentsRotate(e),t.zoomOffset=0,t.fov=this._interpolateComponentsFov(e)}};const Zd=Ai(45);function Gd(e,t,i){const n=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(n);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function Ud(e,t,i){const n=1/t,s=Math.log(e.compared.sourceZoom*n),o=1/e.desiredPixelFlow,a=1/Math.LN2,h=t-e.compared.sourceZoom,c=1/h,d=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(h))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*o*a*c*d-e.halfWindowSize*s*o*a*c+e.halfWindowSize*s*o*a*d/(h*h)}function Wd(e,t,i){const n=t-e.compared.sourceZoom,s=1/n,o=1/t,a=Math.log(e.compared.sourceZoom*o),h=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(n))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*o*h+2*s*a+2*o-2*a*h/(n*n)-h/(t*t))/(e.desiredPixelFlow*Math.LN2)}function qd(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function jd(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function Bd(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function Kd(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function $d(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function Yd(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function Xd(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function Qd(e,t,i){const n=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,o=1/Math.LN2,a=-t+e.compared.targetZoom,h=1/a,c=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*n*s*o*h+e.halfWindowSize*n*s*o*c/(a*a)+e.halfWindowSize*s*o*h*c/t}function Jd(e,t,i){const n=t-e.compared.targetZoom,s=1/n,o=1/t,a=Math.log(t/e.compared.targetZoom),h=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*o*h-2*s*a+2*o+2*a*h/(n*n)-h/(t*t))/(e.desiredPixelFlow*Math.LN2)}function ep(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function tp(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ip(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function np(e){const t=e.compared.sourceZoom-e.compared.targetZoom;if(t===0)return e.compared.pan*e.halfWindowSize/(e.desiredPixelFlow*e.halfWindowPanAtZoom(e.compared.sourceZoom));const i=Math.LN2*e.compared.pan,n=t,s=e.halfWindowPanAtZoom(n),o=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*s);return e.compared.sourceZoom<=e.compared.targetZoom?o*(i-s):o*(i+s)}function sp(e,t){let i=op(e,t);const n={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=n.ascensionFactor===0,o=n.descensionFactor===0,a=s?qd:Gd,h=s?jd:Ud,c=s?Bd:Wd,d=o?ep:Xd,p=o?tp:Qd,m=o?ip:Jd,u=x=>a(e,x,n)+Kd(e,x,n)+d(e,x,n),g=x=>h(e,x,n)+$d(e,x,n)+p(e,x,n),f=x=>c(e,x,n)+Yd(e,x,n)+m(e,x,n);let b=u(i);const D=np(e);let E;const de=t.maximumIterations||20,P=t.maximumDistance!=null?t.maximumDistance:1/0;for(E=0;E<de;E++){const x=t.desiredSlope??1e-6;let Z=g(i);Math.abs(Z)>x&&(Z+=x);const $=Z/f(i);if(isNaN($)||i>=P&&$<0){if(!isFinite(P))return null;i=P,b=u(i);break}if(i-=$,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const fe=u(i);if(Math.abs(fe-b)/b<=.005)break;b=fe}return b>D*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function op(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),n=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return n<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,n):n}let ap=class extends Hd{constructor(e,t){super(),this._preallocSegments=[new qn,new qn,new qn],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const i=t?.apex?sp(e,t.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i?this._updateWithApex(i,t?.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,t,i){e.interpolateComponentsAt(t,i),e===this._ascensionSegment?i.zoom=An(i.zoom):e===this._descensionSegment&&(i.zoom=bi(i.zoom))}_updateWithApex(e,t){const[i,n,s]=this._preallocSegments,o=t?.ascensionFactor??.5,a=Math.min(1-o,t?.ascensionFactor!=null&&t.descensionFactor!=null?t.descensionFactor:.5),h=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.definition.segmentEnd=o,i.update(),this._ascensionSegment=i,this.segments.push(i),h>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*h,n.definition.compared.rotate=this.definition.compared.rotate*h,n.definition.segmentStart=i.definition.segmentEnd,n.definition.segmentEnd=i.definition.segmentEnd+h,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.definition.segmentStart=o+h,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const rp=new Fd;let lp=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=ee(0),this._easing=Wn,this.definition=new Nd(e),this.path=new ap}update(e,t,i){this.definition.update(e,t,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Nr(isFinite(this.path.time)?this.path.time:Y(0)),i),this._easing=i.easing??(this._time>=1e3?Wn:Gn)}cameraAt(e,t){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,rp);t.interpolate(this.definition.source,this.definition.target,i)}_normalizedEasing(e){const t=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(i-t)}_applyTimeSettings(e,t){const i=t.speedFactor!=null?t.speedFactor:1,n=t.minDuration??zt.minDuration/i,s=t.maxDuration??zt.maxDuration/i;return e=t.duration!=null?ee(t.duration):ee(Math.min(Math.max(e/i,n),s))}};const hp=2e3,cp=64;let dp=class{constructor(e){this._view=e,this._animation=new lp(()=>new sa(this._view)),this._current=new sa(this._view)}get _source(){return this._animation.definition.source}get _target(){return this._animation.definition.target}get duration(){return this._animation.time}get animation(){return this._animation}update(e,t,i={}){F(this._current.viewpoint,e),F(this._source.viewpoint,e),F(this._target.viewpoint,t),this._animation.update(this._source,this._target,i)}applyRatio(e,t){this._animation.cameraAt(t,this._current),F(e,this._current.viewpoint)}},mt=class extends M{constructor(e){super(e),this._animation=null,this._destinationViewState=new En,this.updateFunction=null,this.easing=ca.ease,this.viewpoint=new X({targetGeometry:new L,scale:0,rotation:0}),this._updateTask=st({postRender:this._postRender.bind(this)}),this._updateTask.pause(),this._transition=new dp(e.view)}destroy(){this._updateTask=oe(this._updateTask)}get animation(){return this._animation}set animation(e){this._animation=e,this.view.animation=e}animate(e,t,i){this.stop();const n=this.viewpoint;F(n,t);const s=e.target;this._transition.update(this.viewpoint,s,{apex:{maximumDistance:Math.min(Math.min(t.scale,s.scale)*cp,this.view.constraints.effectiveMinScale),desiredSlope:5e-8},duration:i?.duration,maxDuration:i?.animationMode==="auto"?ee(1/0):i?.maxDuration??da.maxDuration,speedFactor:i?.speedFactor,easing:(typeof i?.easing=="string"?ca[i.easing]:i?.easing)||this.easing}),i?.animationMode==="auto"&&(this._destinationViewState.copy(this.view.state),this._destinationViewState.viewpoint=s,pp(this._transition.animation,i,this.view.state,this._destinationViewState)||this._transition.update(this.viewpoint,s,{duration:ee(0)}));const o=()=>{this.animation===e&&this._updateTask&&(e.state==="finished"&&(this._transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinuous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;const i=new In({target:e.clone()}),n=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){const t=this.animation;if(t&&t.state!==In.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime),this.animation?.update(this.viewpoint);else{const i=performance.now()-this._startTime,n=this._transition.duration,s=n>0?i/n:1,o=s>=1;this._transition.applyRatio(this.viewpoint,s),o&&this.animation?.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};function pp(e,t,i,n){if(t?.duration!=null)return!0;const{time:s,isLinear:o}=e,a=t?.speedFactor||1;if(s>(t?.maxDuration??da.maxDuration/a))return!1;if(o){const h=V(),c=A(...n.toScreen(h,...i.center)),d=A(...i.toScreen(h,...n.center)),p=d!=null&&d.x>-1*i.size[0]&&d.x<(1.5+.5)*i.size[0]&&d.y>-1*i.size[1]&&d.y<(1.5+.5)*i.size[1],m=c!=null&&c.x>-1*n.size[0]&&c.x<(1.5+.5)*n.size[0]&&c.y>-1*n.size[1]&&c.y<(1.5+.5)*n.size[1];if(s>hp/a&&!p&&!m)return!1}return!0}r([l()],mt.prototype,"easing",void 0),r([l()],mt.prototype,"view",void 0),r([l()],mt.prototype,"viewpoint",void 0),mt=r([v("esri.views.2d.AnimationManager")],mt);const up=mt;function C(){return Promise.all([import("./webglDeps-B_grlYgT.js"),import("./mapViewDeps-CF678-65.js")])}const Nt=()=>C().then(()=>import("./TileLayerView2D-DqLs5dSi.js")),Xe=()=>C().then(()=>import("./FeatureLayerView2D-CZmvnEI3.js").then(e=>e.F)),pa={"base-dynamic":()=>C().then(()=>import("./BaseDynamicLayerView2D-COcuxxMD.js")),"base-tile":Nt,"bing-maps":Nt,catalog:()=>C().then(()=>import("./CatalogLayerView2D-D6HpDadR.js")),"catalog-dynamic-group":()=>C().then(()=>import("./CatalogDynamicGroupLayerView2D-DC6KBhBa.js")),"catalog-footprint":()=>C().then(()=>import("./CatalogFootprintLayerView2D-BAJ4J7Wd.js")),csv:Xe,"geo-rss":()=>C().then(()=>import("./GeoRSSLayerView2D-D_eEXPxX.js")),feature:Xe,geojson:Xe,parquet:Xe,graphics:()=>C().then(()=>import("./GraphicsLayerView2D-qRm9s_LL.js")),group:()=>C().then(()=>import("./GroupLayerView2D-Bn3p0N2U.js")),imagery:()=>C().then(()=>import("./ImageryLayerView2D-BaRZOc1G.js")),"imagery-tile":()=>C().then(()=>import("./ImageryTileLayerView2D-CfvB_gsS.js")),kml:()=>C().then(()=>import("./KMLLayerView2D-CtKgHAj9.js")),"knowledge-graph":()=>C().then(()=>import("./KnowledgeGraphLayerView2D-CYjkH3P6.js")),"link-chart":()=>C().then(()=>import("./KnowledgeGraphLayerView2D-CYjkH3P6.js")),"knowledge-graph-sublayer":Xe,"map-image":()=>C().then(()=>import("./MapImageLayerView2D-Birckke5.js")),"map-notes":()=>C().then(()=>import("./MapNotesLayerView2D-DA01sLOa.js")),media:()=>C().then(()=>import("./MediaLayerView2D-qqZ9XH9P.js")),"ogc-feature":()=>C().then(()=>import("./OGCFeatureLayerView2D-CO7UkwwH.js")),"open-street-map":Nt,"oriented-imagery":Xe,route:()=>C().then(()=>import("./RouteLayerView2D-CSJXihDW.js")),stream:()=>C().then(()=>import("./StreamLayerView2D-D-0bX2f6.js")),"subtype-group":()=>C().then(()=>import("./SubtypeGroupLayerView2D-BPQRkVmX.js")),tile:Nt,"vector-tile":()=>C().then(()=>import("./VectorTileLayerView2D-BJOCM8hn.js")),video:()=>C().then(()=>import("./VideoLayerView2D-CXBb4nVD.js")),wcs:()=>C().then(()=>import("./ImageryTileLayerView2D-CfvB_gsS.js")),"web-tile":Nt,wfs:Xe,wms:()=>C().then(()=>import("./WMSLayerView2D-B94iMsxS.js")),wmts:()=>C().then(()=>import("./WMTSLayerView2D-ytQXzNNK.js")),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,viewshed:null,voxel:null,scene:null,unknown:null,unsupported:null};function mp(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new T(`${i}:view-not-supported`,`${t} is not supported in 2D`)}const ua={hasLayerViewModule:e=>pa[e.type]!=null,importLayerView:e=>{const t=pa[e.type];if(t==null)throw mp(e);return t(e)}},Qe={added:[],removed:[]},jn=new Set,gp=new Zl(0,0,0,0);function yp(e,t){const i=Ts(t);if(!i)return null;const[n,s]=i.valid;return e[2]>s?[Qt([e[0],e[1],s,e[3]]),Qt([n,e[1],n+e[2]-s,e[3]])]:e[0]<n?[Qt([n,e[1],e[2],e[3]]),Qt([s-(n-e[0]),e[1],s,e[3]])]:null}let fp=class extends Kt{constructor(e){super(),this._tiles=new Map,this._index=Dl(9,U("esri-csp-restrictions")?t=>({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}getIntersectingTiles(e){if(!e||Fr(e)===0||Hr(e)===0)return[];const t=yp(e,this.tileScheme.spatialReference);return t!=null?[...new Set([...this.boundsIntersections(t[0]),...this.boundsIntersections(t[1])])]:this.boundsIntersections(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const i of e.added)if(!this.has(i)){const n=new Bs(this.tileScheme,i);this._tiles.set(i,n),this._index.insert(n),t.added.push(n)}for(const i of e.removed)if(this.has(i)){const n=this.get(i);this._tiles.delete(i),this._index.remove(n),t.removed.push(n)}this.tiles.length=0,this._tiles.forEach(i=>this.tiles.push(i)),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:i,lodInfo:n}=t,{level:s}=n;if(i.length>0)for(const{row:o,colFrom:a,colTo:h}of i)for(let c=a;c<=h;c++){const d=gp.set(s,o,n.normalizeCol(c),n.getWorldForColumn(c)).id;if(jn.add(d),!this.has(d)){const p=new Bs(this.tileScheme,d);this._tiles.set(d,p),this._index.insert(p),this.tiles.push(p),Qe.added.push(p)}}for(let o=this.tiles.length-1;o>=0;o--){const a=this.tiles[o];jn.has(a.id)||(this._tiles.delete(a.id),this.tiles.splice(o,1),this._index.remove(a),Qe.removed.push(a))}(Qe.added.length||Qe.removed.length)&&this.emit("update",Qe),Rl.pool.release(t),jn.clear(),Qe.added.length=0,Qe.removed.length=0}};const ma=1,vp=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],_p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ft=256,Bn=()=>I.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function wp(e,t){t.fillColor[0]=e.color.r/255,t.fillColor[1]=e.color.g/255,t.fillColor[2]=e.color.b/255,t.fillColor[3]=e.color.a,e.haloColor?(t.outlineColor[0]=e.haloColor.r/255,t.outlineColor[1]=e.haloColor.g/255,t.outlineColor[2]=e.haloColor.b/255,t.outlineColor[3]=e.haloColor.a):(t.outlineColor[0]=t.fillColor[0],t.outlineColor[1]=t.fillColor[1],t.outlineColor[2]=t.fillColor[2],t.outlineColor[3]=t.fillColor[3]),t.fillColor[3]*=e.fillOpacity,t.outlineColor[3]*=e.haloOpacity,t.fillColor[0]*=t.fillColor[3],t.fillColor[1]*=t.fillColor[3],t.fillColor[2]*=t.fillColor[3],t.outlineColor[0]*=t.outlineColor[3],t.outlineColor[1]*=t.outlineColor[3],t.outlineColor[2]*=t.outlineColor[3],t.outlineWidth=(1-e.haloBlur)*e.haloWidth,t.outerHaloWidth=e.haloBlur*e.haloWidth/2,t.innerHaloWidth=e.haloBlur*e.haloWidth/2,t.outlinePosition=0}const bp=[0,0,0,0];let ga=class{constructor(){this.type="single",this._highlightOptions=new be,this._convertedHighlightOptions={fillColor:[0,0,0,0],outlineColor:[0,0,0,0],outlinePosition:0,outlineWidth:0,innerHaloWidth:0,outerHaloWidth:0},this._optionsShadeTexKey="",this._texelData=new Uint8Array(4*Ft),this._minMaxDistance=[0,0]}setHighlightOptions(e){this._highlightOptions=e}applyHighlightOptions(e,t){this._updateGradientTexture(e),e.bindTexture(this._shadeTex,Gl),t.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose(),this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<Ul)-1,activeGradient:this}]}_updateGradientTexture(e){const t=Mp(this._highlightOptions);if(t===this._optionsShadeTexKey)return;this._optionsShadeTexKey=t,wp(this._highlightOptions,this._convertedHighlightOptions);const i=this._convertedHighlightOptions,n=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,s=i.outlinePosition-i.outlineWidth/2,o=i.outlinePosition+i.outlineWidth/2,a=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,h=Math.sqrt(Math.PI/2)*ma,c=Math.abs(n)>h?Math.round(10*(Math.abs(n)-h))/10:0,d=Math.abs(a)>h?Math.round(10*(Math.abs(a)-h))/10:0;let p;c&&!d?Bn().error("The outer rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!c&&d?Bn().error("The inner rim of the highlight is "+d+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):c&&d&&Bn().error("The highlight is "+Math.max(c,d)+"px away from the edge of the feature; consider reducing some width values.");const m=[void 0,void 0,void 0,void 0];function u(f,b,D){m[0]=(1-D)*f[0]+D*b[0],m[1]=(1-D)*f[1]+D*b[1],m[2]=(1-D)*f[2]+D*b[2],m[3]=(1-D)*f[3]+D*b[3]}const{_texelData:g}=this;for(let f=0;f<Ft;++f)p=n+f/(Ft-1)*(a-n),p<n?(m[0]=0,m[1]=0,m[2]=0,m[3]=0):p<s?u(bp,i.outlineColor,(p-n)/(s-n)):p<o?[m[0],m[1],m[2],m[3]]=i.outlineColor:p<a?u(i.outlineColor,i.fillColor,(p-o)/(a-o)):[m[0],m[1],m[2],m[3]]=i.fillColor,g[4*f]=255*m[0],g[4*f+1]=255*m[1],g[4*f+2]=255*m[2],g[4*f+3]=255*m[3];if(this._minMaxDistance[0]=n,this._minMaxDistance[1]=a,!this._shadeTex){const f=new jl;f.wrapMode=Wl.CLAMP_TO_EDGE,f.width=Ft,f.height=1,this._shadeTex=new Bl(e,f)}this._shadeTex.updateData(0,0,0,Ft,1,this._texelData)}};function Mp(e){return`${e.color};${e.haloColor};${e.haloOpacity};${e.fillOpacity};${e.haloWidth};${e.haloBlur}`}let Tp=class{constructor(){this.type="multi",this.gradients=[]}setHighlightOptions(e){for(let t=0;t<e.length;t++)this.gradients[t]||(this.gradients[t]=new ga),this.gradients[t].setHighlightOptions(e[t]);for(let t=e.length+1;t<this.gradients.length;t++)this.gradients[t].destroy();this.gradients.length=e.length}destroy(){for(const e of this.gradients)e.destroy()}getReasonsWithGradients(){let e=1;const t=[];for(let i=0;i<this.gradients.length;i++){const n=this.gradients[i];t.push({activeReasons:e,activeGradient:n}),e<<=1}return t}};var ya,Kn,$n,fa,Yn,va,Ht,Xn,Qn;(function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT",e[e.LABEL=4]="LABEL"})(ya||(ya={})),function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(Kn||(Kn={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}($n||($n={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(fa||(fa={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(Yn||(Yn={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SIMPLE=1]="SIMPLE",e[e.DOT_DENSITY=2]="DOT_DENSITY",e[e.OUTLINE_FILL=3]="OUTLINE_FILL",e[e.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",e[e.HEATMAP=5]="HEATMAP",e[e.PIE_CHART=6]="PIE_CHART"}(va||(va={})),function(e){e[e.All=0]="All",e[e.Highlight=1]="Highlight",e[e.InsideEffect=2]="InsideEffect",e[e.OutsideEffect=3]="OutsideEffect"}(Ht||(Ht={})),function(e){e[e.BATCHING=0]="BATCHING",e[e.STRICT_ORDER=1]="STRICT_ORDER",e[e.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"}(Xn||(Xn={})),function(e){e[e.FILL=0]="FILL",e[e.LINE=1]="LINE",e[e.MARKER=2]="MARKER",e[e.TEXT=3]="TEXT"}(Qn||(Qn={}));const _a={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:ql.EQUAL,mask:255,op:{fail:Ki.KEEP,zFail:Ki.KEEP,zPass:Ki.REPLACE}}}},xp={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},Sp={..._a,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function wa({pixelRatio:e,state:t,displayLevel:i,requiredLevel:n},s){const o=1/2**(i-s.key.level),a=1/2**(n-s.key.level);return{displayMat3:t.displayMat3,displayViewMat3:t.displayViewMat3,displayViewScreenMat3:s.transforms.displayViewScreenMat3,viewMat3:t.viewMat3,tileMat3:s.transforms.tileMat3,displayZoomFactor:o,requiredZoomFactor:a,tileOffset:[s.x,s.y],currentScale:t.scale,currentZoom:i,metersPerSRUnit:bs(t.spatialReference),rotation:t.rotation,pixelRatio:e}}function Jn(e){return e.passOptions?.type==="highlight"}function es(e){return e.passOptions?.type==="hittest"}function Pp(e){if(!es(e))return null;const{position:t,distance:i,smallSymbolDistance:n,smallSymbolSizeThreshold:s}=e.passOptions;return{position:t,distance:i,smallSymbolDistance:n,smallSymbolSizeThreshold:s}}function kp(e){if(!Jn(e))return null;const{activeReasons:t,highlightAll:i}=e.passOptions;return{activeReasons:t,highlightAll:i?1:0}}function Cp(e,t,i){const n={};for(const s in i)i[s]instanceof Function?n[s]=i[s](e,t):n[s]=i[s];return n}function Ep(e,t){const{attributeView:i,context:n}=e;return{storage:i.getUniforms(n),view:wa(e,t),hittestRequest:Pp(e),highlight:kp(e)}}function Ip(e){return{inside:e.selection===Ht.InsideEffect,outside:e.selection===Ht.OutsideEffect}}function ba(e){return es(e)?xp:Jn(e)&&e.passOptions.stepType==="clear"?Sp:_a}function Dp(e){const{row:t,col:i}=e.key,n=i*Ys,s=t*Ys;return{tileOffsetFromLocalOrigin:[n%ri,s%ri],maxIntsToLocalOrigin:[Math.floor(n/ri),Math.floor(s/ri)]}}const Rp=new Zr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function Lp(e){return Rp.toJSON(e)}function Vp(e){const{bandCount:t,attributeTable:i,colormap:n,pixelType:s}=e.raster.rasterInfo;return t===1&&(i!=null||n!=null||s==="u8"||s==="s8")}function Ma(e,t){return t==null?(e?.destroy(),null):(e?.type==="single"&&Array.isArray(t)&&(e.destroy(),e=null),e?.type!=="multi"||Array.isArray(t)||(e.destroy(),e=null),e||(e=Array.isArray(t)?new Tp:new ga),Array.isArray(t)?e.type==="multi"&&e.setHighlightOptions(t):e.type==="single"&&e.setHighlightOptions(t),e)}function Op(e,t,i,n){const{painter:s,highlightGradient:o}=e,{highlight:a}=s.effects;if(!o)return;const h=e.passOptions,c=o.getReasonsWithGradients();for(let d=0;d<c.length;d++){const p={...e,passOptions:{type:"highlight",activeGradient:c[d].activeGradient,activeReasons:c[d].activeReasons,stepType:"burn",highlightAll:t}};if(a.bind(p),i(p),d<c.length-1){let u=0;for(let g=d+1;g<c.length;g++)u|=c[g].activeReasons;i({...e,passOptions:{type:"highlight",activeGradient:c[d].activeGradient,activeReasons:u,stepType:"clear",highlightAll:t}})}const m={...e,passOptions:{type:"highlight",activeGradient:c[d].activeGradient,activeReasons:c[d].activeReasons,stepType:"draw",highlightAll:t}};s.setPipelineState(ba(e)),s.updatePipelineState(e.context),a.draw(m),a.unbind()}e.passOptions=h}function Ap(e){if(!e)return[];let t=Gr(e)?[e]:k.isCollection(e)?e.toArray():Array.isArray(e)?e:[];return t=t?.filter(bt),(t?.length??0)===0?[]:t}const Mi=e=>parseFloat(e)/100;function Ta(e,t,i){const n=typeof e.left=="string"?Mi(e.left)*t:e.left,s=typeof e.right=="string"?Mi(e.right)*t:e.right,o=typeof e.top=="string"?Mi(e.top)*i:e.top,a=typeof e.bottom=="string"?Mi(e.bottom)*i:e.bottom,h=o;return{xmin:n,xmax:Math.max(t-s,n),ymin:h,ymax:Math.max(i-a,o)}}function xa(e,t,i,n){switch(t.type){case"rect":{const{width:s,height:o}=e,{xmin:a,xmax:h,ymin:c,ymax:d}=Ta(t,s,o),{x:p,y:m}=i;return p>a&&p<h&&m>c&&m<d}case"path":return t.path.length===0||!Array.isArray(t.path[0][0])||Ur(t.path,[i.x,i.y]);case"geometry":return t.geometry==null||(t.geometry.type==="polygon"?Ss(t.geometry,n):Ni(t.geometry,n))}}function Sa(e){if(!e.highlights)return null;const t=e.highlights.findIndex(i=>i.name==="default");return t===-1?null:e.highlights.items[t]}function Pa(e,t){if(!e.highlights){if(!t)return;e.highlights=new k([new be])}const i=e.highlights.findIndex(n=>n.name==="default");t?e.highlights.items[i].assignFrom(t):(e.highlights.removeAt(i),e.highlights.length===0&&(e.highlights=null))}async function zp(e,t,i){const n=mo(t)?uo(e,t):t;if(!e.ready||isNaN(n.x)||isNaN(n.y))return{screenPoint:n,results:[]};let s=new Set;const o=new Set;let a=!1,h=null,c=null;i?.include?Ca(i.include,ka(e,u=>{s.add(u),is(u,g=>o.add(g))},(u,g)=>{o.add(u),s.add(g)},u=>{h||(h=new Set),h.add(u)},u=>s.add(u),()=>a=!0)):(a=!0,s=new Set(e.allLayerViews),s.forEach(u=>{is(u,g=>o.add(g))})),i?.exclude&&Ca(i.exclude,ka(e,u=>{s.delete(u),is(u,g=>o.delete(g))},u=>o.delete(u),u=>{c||(c=new Set),c.add(u)}));const d=e.toMap(n),p=e.allLayerViews.filter(u=>!u.suspended&&s.has(u)&&u.clips.every(g=>xa(e,g,n,d))).reverse();let m=[...a?e.graphicsView.hitTest(d).map(u=>({type:"graphic",graphic:u,layer:null,mapPoint:d})):[],...await Promise.all(p.map(u=>u.hitTest(d,n)).toArray())].filter(bt).flat().filter(bt);return m=m.filter(u=>u.type!=="graphic"||u.layer?.type!=="subtype-group"||o.has(u.graphic.layer)),h&&(m=m.filter(u=>!("graphic"in u)||!u.graphic||h?.has(ts(u.graphic)))),c&&(m=m.filter(u=>!("graphic"in u)||!u.graphic||!c?.has(ts(u.graphic)))),{screenPoint:n,results:m}}function ka(e,t,i,n,s,o){return a=>{if(a instanceof Wr){if(a.layer===e)o?.();else{const h=e.allLayerViews.find(c=>c.layer===a.layer);h&&s?.(h)}n(ts(a))}else if(!("layer"in a&&"element"in a))if(a.type==="subtype-sublayer"){const h=e.allLayerViews.find(c=>c.layer===a.parent);h&&i(a,h)}else{const h=e.allLayerViews.find(c=>c.layer===a);h&&t(h)}}}function Ca(e,t){if(e)if(Cs(e))for(const i of e)if(Cs(i))for(const n of i)t(n);else t(i);else t(e)}function ts(e){const t=e.getObjectId();return t?`${e.layer?.uid??e.sourceLayer?.uid??"MapView"}/${t}`:`"MapView/${e.uid}`}function is({layer:e},t){e?.type==="subtype-group"&&e.sublayers.forEach(i=>{t(i)})}function Ea(e,t,i){const{ctx:n,canvas:s}=Da(e,i),o=n.getImageData(0,0,e.width,e.height),a=La(s,t);return Ra(s),{dataUrl:a,data:o}}function Ia(e,t){const{ctx:i,canvas:n}=Da(e,t),s=i.getImageData(0,0,e.width,e.height);return Ra(n),s}function Da(e,t){const i=Np();t.premultipliedAlpha&&Gp(e),i.width=e.width,i.height=e.height;const n=i.getContext("2d",{willReadFrequently:!0});return n.putImageData(e,0,0),t.flipY&&Zp(n),{ctx:n,canvas:i}}function Ra(e){e.width=0,e.height=0}function Np(){return ns==null&&(ns=document.createElement("canvas")),ns}let ns=null;function La(e,t){const i=Up[t.format],n=t.quality/100;return e.toDataURL(i,n)}function Va(e,t){const i=Hp(e),n=qp[i];return{format:i,quality:wt(t??n,0,100)}}function Oa(e,t){return t/Math.max(e[0],e[1])}function Fp(e,t,i,n=0,s=0,o=e.width-n,a=e.height-s,h=!1){const{data:c}=e,{width:d,height:p,data:m}=t,u=o/d,g=a/p,f=Math.ceil(u/2),b=Math.ceil(g/2),D=e.width;for(let E=0;E<p;E++)for(let de=0;de<d;de++){const P=4*(de+(h?p-E-1:E)*d);let x=0,Z=0,$=0,fe=0,rs=0,ls=0;const cr=(E+.5)*g;for(let Gt=Math.floor(E*g);Gt<(E+1)*g;Gt++){const hs=Math.abs(cr-(Gt+.5))/b,dr=(de+.5)*u,pr=hs*hs;for(let Ut=Math.floor(de*u);Ut<(de+1)*u;Ut++){const cs=Math.abs(dr-(Ut+.5))/f,it=Math.sqrt(pr+cs*cs);if(it>=1)continue;let Ie=2*it*it*it-3*it*it+1;const nt=4*(n+Ut+(s+Gt)*D);ls+=Ie*c[nt+3],Z+=Ie,!i&&c[nt+3]<255&&(Ie=Ie*c[nt+3]/255),$+=Ie*c[nt],fe+=Ie*c[nt+1],rs+=Ie*c[nt+2],x+=Ie}}m[P]=$/x,m[P+1]=fe/x,m[P+2]=rs/x,m[P+3]=ls/Z}return t}function Hp(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return Wp}}function Zp(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function Gp(e){const t=e.data,i=t.length;for(let n=0;n<i;n+=4){const s=t[n+3];if(s!==255&&s>0){const o=255/s;t[n]=t[n]*o,t[n+1]=t[n+1]*o,t[n+2]=t[n+2]*o}}}const Up={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Aa=98,Wp="png",qp={png:100,jpg:Aa,jpeg:Aa},jp=Object.freeze(Object.defineProperty({__proto__:null,createEmptyImageData:Kl,encode:Ea,encodeData:Ia,getFormatAndQuality:Va,getMaximumResolutionScale:Oa,resampleHermite:Fp,toDataUrl:La},Symbol.toStringTag,{value:"Module"})),za={flipY:!0,premultipliedAlpha:!0};async function Bp(e,t){const i=await Na(e,t),{format:n,quality:s}=Va(t?.format,t?.quality);return Ea(i,{format:n,quality:s},za)}async function Kp(e,t){const i=await Na(e,t);return Ia(i,za)}function Na(e,t){const i=Xp(t||{},Yp(e.stage,e.size),e.size,e.padding),n=$p(t,e.allLayerViews);return e.stage.takeScreenshot(i,n,e.backgroundColor,t?.rotation)}function $p(e={},t){if(!e.layers)return;const i=[];return e.layers.forEach(n=>{const s=t.find(o=>o.layer.id===n.id);s?.container&&i.push(s.container)}),i}function Yp(e,t){return Math.min(4,Oa(t,Math.min(4096,e.context.parameters.maxTextureSize)))}function Xp(e,t,i,n){e.ignorePadding&&(n={left:0,right:0,top:0,bottom:0});let s=null;e.width!=null&&e.height!=null?s=[e.width,e.height]:e.width==null&&e.height!=null?s=[e.height,e.height]:e.width!=null&&e.height==null?s=[e.width,e.width]:e.width==null&&e.height==null&&(s=null);const o=i[0]-(n.left+n.right),a=i[1]-(n.top+n.bottom);let h,c,d=e.area||{x:0,y:0,width:o,height:a};if(s){const p=o/a,m=s[0]/s[1];if(m>p){const u=d.width/m;d={x:d.x,y:Math.round(d.y+(d.height-u)/2),width:d.width,height:Math.round(u)}}else{const u=d.height*m;d={x:Math.round(d.x+(d.width-u)/2),y:d.y,width:Math.round(u),height:d.height}}}else s=[d.width,d.height];return s[0]>d.width?(h=Math.min(s[0]/d.width,t),c=s[0]/d.width/h):(h=1,c=s[0]/d.width),{cropArea:{x:Math.round((d.x+n.left)*h),y:Math.round((d.y+n.top)*h),width:Math.round(d.width*h),height:Math.round(d.height*h)},outputScale:c,resolutionScale:h}}const Qp=e=>e.includes("Brush");let ss=class{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),Qp(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}};function Jp(e){const t=$l();return t.available?e==="3d"&&t.majorPerformanceCaveat?new T("webgl:major-performance-caveat-detected",`Your WebGL implementation (${t.unmaskedRenderer}) doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.`):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?null:new T("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new T("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new T("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function eu(e){return e&&"nodeType"in e}function tu(e){return e&&typeof e.render=="function"}const Fa={component:"esri-component"};let Je=class extends M{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(e){this._set("id",e)}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Fa.component),t&&t.classList.remove(Fa.component),this._set("node",e))}castNode(e){return this.widget?.destroy(),e?typeof e=="string"||eu(e)?(this._set("widget",null),Rs(e)):(tu(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};r([l()],Je.prototype,"id",null),r([l()],Je.prototype,"node",null),r([Ze("node")],Je.prototype,"castNode",null),r([l({readOnly:!0})],Je.prototype,"widget",void 0),Je=r([v("esri.views.ui.Component")],Je);const Ti=Je,iu={left:0,top:0,bottom:0,right:0},Ha={bottom:30,top:15,right:15,left:15},Se="esri-ui",K={ui:Se,corner:`${Se}-corner`,innerContainer:`${Se}-inner-container`,manualContainer:`${Se}-manual-container`,cornerContainer:`${Se}-corner-container`,topLeft:`${Se}-top-left`,topRight:`${Se}-top-right`,bottomLeft:`${Se}-bottom-left`,bottomRight:`${Se}-bottom-right`};function nu(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function xi(e){return e===0?"0":`${e}px`}function os(e){const t=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(t===null||t===Object.prototype)&&("component"in e||"index"in e||"position"in e)?e:null}function as(e,{top:t,bottom:i,left:n,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=n,e.style.right=s}let ye=class extends Kt.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=qr(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&as(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&as(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([_(()=>[this.view?.padding,this.container],this._applyViewPadding,G),_(()=>this.padding,this._applyUIPadding,G),_(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},G),jr(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(K.ui),nl(e),this._attachContainers(e)),t&&(t.classList.remove(K.ui),as(t,{top:"",bottom:"",left:"",right:""}),t.textContent=""),this._set("container",e))}get height(){const e=this.view?.height??0;if(e===0)return e;const t=this._getViewPadding(),{top:i,bottom:n}=t;return Math.max(e-i-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...Ha,...e}}get width(){const e=this.view?.width??0;if(e===0)return e;const t=this._getViewPadding(),{left:i,right:n}=t;return Math.max(e-i-n,0)}add(e,t){let i,n,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,t));const o=os(e);o&&({index:i,position:t,component:e,key:n}=o),t&&typeof t=="object"&&({index:i,key:n,position:t,internal:s}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,n,s)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(n=>this.remove(n,t));const i=this._find(e);if(i){if(this._componentMap.has(i)&&this._componentMap.get(i)?.key!==t)return;const n=this._components.indexOf(i);return i.node.parentNode?.removeChild(i.node),this._componentMap.delete(i),i.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(n,1)[0]}}empty(e,t={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,t);return}const i=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>s==null?!1:!(this._componentMap.get(s)?.internal??!1)||t.removeInternal);for(const s of n)this.remove(s)}move(e,t){if(Array.isArray(e)&&e.forEach(o=>this.move(o,t)),!e)return;let i;const n=os(e)||os(t);if(n&&(i=n.index,t=n.position,e=n.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e,t={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,t)):this._getComponentsAtPosition(e,t):this._components.filter(i=>t.includeInternal||!this._componentMap.get(i)?.internal).map(({widget:i,node:n})=>i??n)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,n,s){e instanceof Ti||(e=new Ti({node:e}));const{widget:o}=e;o!=null&&o instanceof M&&o.addHandles(qt(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:t,index:i}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof Ti?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.view?.padding??iu}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(K.innerContainer,K.cornerContainer);const t=document.createElement("div");t.classList.add(K.innerContainer,K.manualContainer);const i=document.createElement("div");i.classList.add(K.topLeft,K.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(K.topRight,K.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(K.bottomLeft,K.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(K.bottomRight,K.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=t;const a=sl();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.position??"manual",{component:i,index:n}=e,s=this._positionNameToContainerLookup[t],o=n!=null&&n>-1;if(nu(i.widget)&&i.widget.startup(),!o)return void s.appendChild(i.node);const a=Array.from(s.children);if(n===0){const{firstChild:c}=s;return void(c?c.parentNode?.insertBefore(i.node,c):s.appendChild(i.node))}if(n>=a.length)return void s.appendChild(i.node);const h=a[n];h.parentNode?.insertBefore(i.node,h)}_toPixelPosition(e){return{top:xi(e.top),left:xi(e.left),right:xi(e.right),bottom:xi(e.bottom)}}_findByComponent(e){return this._components.find(t=>t===e)??null}_findById(e){return this._components.find(({id:t})=>t===e)??null}_findByNode(e){return this._components.find(({node:t})=>t===e)??null}_getComponentsAtPosition(e,t){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(bt).filter(n=>t.includeInternal||!this._componentMap.get(n)?.internal).map(({widget:n,node:s})=>n??s)}};r([l()],ye.prototype,"_locale",void 0),r([l()],ye.prototype,"container",null),r([l()],ye.prototype,"height",null),r([l({value:Ha})],ye.prototype,"padding",null),r([Ze("padding")],ye.prototype,"castPadding",null),r([l()],ye.prototype,"view",void 0),r([l()],ye.prototype,"width",null),ye=r([v("esri.views.ui.UI")],ye);const su=ye,ou=new Map;function au(e){return ou.get(e)}function Za(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function ru(e,t){return e.length!==t.length||e.some((i,n)=>i.text!==t[n].text)}function Zt(e,t,i){!i||!t||e.find(n=>n.layerView===t&&n.text===i)||e.push({text:i,layerView:t})}function lu(e){return e.type==="bing-maps"}const Pe=[];let gt=class extends M{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new k,this.view=null,this._allLayerViewsChange=t=>{this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const i=this.view?.allLayerViews;i&&(this.addHandles(i.map(n=>_(()=>[n.suspended,n.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(n=>{n.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(n.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),t?.removed&&t.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([Bt(()=>this.view?.allLayerViews,"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),We(()=>this.view?.stationary===!0,()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.view?.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e?.allLayerViews;if(Pe.length=0,!e||!t)return void this._clear();t.forEach(n=>{if(n.suspended||!n.layer?.attributionVisible)return;const s=n.layer;if(Za(s,"user"))return void Zt(Pe,n,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(n)){const a=this._fetchedAttributionData.get(n);return void(a?Zt(Pe,n,this._getDynamicAttribution(a,e,s)):Za(s)&&Zt(Pe,n,s.copyright))}return void this._fetchAttributionData(n)}const o="portalItem"in s?s.portalItem?.accessInformation:void 0;Zt(Pe,n,o||s.copyright)});const i=t.find(n=>n.layer?.type==="integrated-mesh-3dtiles");if(this.view&&i){const n=au(this.view);if(n){const s=n.getAttributionText();for(let o=0;o<s.length;++o)Zt(Pe,i,s[o])}}ru(this.items,Pe)&&(this.items.removeAll(),this.items.addMany(Pe)),Pe.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Br(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,lu(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const h of a){const c=h.bbox,d=h.zoomMin-(t&&h.zoomMin?1:0),p=h.zoomMax-(t&&h.zoomMax?1:0),m=new qe({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Yt.WGS84}),u={extent:Kr(m),attribution:o.attribution||"",score:h.score!=null?h.score:100,id:s};for(let g=d;g<=p;g++)n[g]??=[],n[g].push(u)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,t,i){const{extent:n,scale:s}=t;let o=i.tileInfo?.scaleToZoom(s)??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],h=$r(n.center.clone().normalize(),Yt.WebMercator),c=new Set;return a?a.filter(d=>{const p=d.id,m=!c.has(p)&&h&&d.extent&&Ni(d.extent,h);return m&&c.add(p),m}).sort((d,p)=>p.score-d.score||d.objectId-p.objectId).map(d=>d.attribution).join(", "):""}};r([l({readOnly:!0,type:k})],gt.prototype,"items",void 0),r([l({readOnly:!0})],gt.prototype,"state",null),r([l()],gt.prototype,"view",void 0),gt=r([v("esri.widgets.Attribution.AttributionViewModel")],gt);const Ga=gt,ce={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function hu(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${String(t)}'`);return{value:du(e[t])}}}function cu(e){const t=e?.type;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function du(e){return function(t,...i){cu(t)?ol(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}const yt="esri-attribution",ft={base:yt,poweredBy:`${yt}__powered-by`,sources:`${yt}__sources`,open:`${yt}--open`,sourcesOpen:`${yt}__sources--open`,link:`${yt}__link`};let W=class extends ei{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new Ga}initialize(){this.addHandles(Bt(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[ft.open]:this._isOpen};return q("div",{bind:this,class:this.classes(ft.base,ce.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return q("div",{class:ft.poweredBy},"Powered by"," ",q("a",{class:ft.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?0:void 0,{attributionText:n}=this,s={[ft.sourcesOpen]:e,[ce.interactive]:t};return q("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(ft.sources,s),innerHTML:n,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(t=!0),this._isOpen){const h=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,h&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};r([l()],W.prototype,"_isOpen",void 0),r([l()],W.prototype,"_isInteractive",null),r([l()],W.prototype,"_attributionTextOverflowed",void 0),r([l()],W.prototype,"_prevSourceNodeHeight",void 0),r([l({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],W.prototype,"attributionText",null),r([l()],W.prototype,"icon",null),r([l()],W.prototype,"itemDelimiter",void 0),r([l()],W.prototype,"label",null),r([l(),Jt("esri/widgets/Attribution/t9n/Attribution")],W.prototype,"messages",void 0),r([l()],W.prototype,"view",null),r([l({type:Ga})],W.prototype,"viewModel",void 0),r([hu()],W.prototype,"_toggleState",null),W=r([v("esri.widgets.Attribution")],W);const pu=W;function Ua(){const e=U("mapview-essential-goto-duration");return e==null?e:ee(e)}function uu(e){return e?.spatialReference?.isWebMercator||e?.spatialReference?.isGeographic||!1}const Wa=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:n}=this;return Yr(n),this.goToOverride?this.goToOverride(n,i):n.goTo(i.target,i.options)}};return r([l()],t.prototype,"goToOverride",void 0),r([l()],t.prototype,"view",void 0),t=r([v("esri.widgets.support.GoTo")],t),t};let et=class extends Wa(M){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._watchForView(G)}destroy(){this.view=null}get canShowNorth(){return uu(this.view)}get state(){return!this.view?.ready||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){this.view?.ready&&(this.view?.type==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:Ua()}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this._set("orientation",{x:0,y:0,z:t})}_updateRotationWatcher(e){this.removeAllHandles(),this._watchForView(),e&&this.addHandles(e.type==="2d"?_(()=>e?.rotation,this._updateForRotation,G):_(()=>e?.camera,this._updateForCamera,G))}_watchForView(e){this.addHandles(_(()=>this.view,this._updateRotationWatcher,e))}};r([l({readOnly:!0})],et.prototype,"canShowNorth",null),r([l({readOnly:!0})],et.prototype,"orientation",void 0),r([l({readOnly:!0})],et.prototype,"state",null),r([l()],et.prototype,"view",void 0),et=r([v("esri.widgets.Compass.CompassViewModel")],et);const qa=et,ja="esri-compass",Ba={base:ja,iconContainer:`${ja}__icon-container`};let ke=class extends ei{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new qa,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return Gi({button:()=>import("./index-DprBlnKG.js"),icon:()=>import("./index-DEbk-pbf.js")})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,{messages:i}=this;return q("div",{class:this.classes(Ba.base,ce.widget)},q("calcite-button",{class:ce.widgetButton,disabled:t==="disabled",kind:"neutral",label:i.reset,onclick:this._reset,round:!0,scale:"s",title:i.reset},q("div",{"aria-hidden":"true",class:Ba.iconContainer,title:i.reset},q("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};r([l()],ke.prototype,"goToOverride",null),r([l()],ke.prototype,"icon",null),r([l()],ke.prototype,"label",null),r([l(),Jt("esri/widgets/Compass/t9n/Compass")],ke.prototype,"messages",void 0),r([l()],ke.prototype,"view",null),r([l({type:qa})],ke.prototype,"viewModel",void 0),ke=r([v("esri.widgets.Compass")],ke);const mu=ke,Ka="esri-navigation-toggle",$a={base:Ka,isLayoutHorizontal:`${Ka}--horizontal`};let vt=class extends M{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(We(()=>this.view?.navigation?.actionMap,()=>this._updateNavigationActionMap()))}destroy(){this.view=null}get state(){return this.view?.ready&&this.view?.type==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._updateNavigationActionMap()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_updateNavigationActionMap(){const e=this.view?.navigation?.actionMap;if(!e)return;const t=this._navigationMode==="pan";e.dragPrimary=t?"pan":"rotate",e.dragSecondary=t?"rotate":"pan"}};r([l({readOnly:!0})],vt.prototype,"state",null),r([l()],vt.prototype,"_navigationMode",void 0),r([l()],vt.prototype,"view",void 0),vt=r([v("esri.widgets.NavigationToggle.NavigationToggleViewModel")],vt);const Ya=vt;let Ce=class extends ei{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Ya,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{const i=this.viewModel?.navigationMode==="pan"?this._rotateButton:this._panButton;al(i),this.toggle()}}loadDependencies(){return Gi({button:()=>import("./index-DprBlnKG.js")})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel?.state==="disabled",t=this.viewModel?.navigationMode==="pan",i=this.messages.toggle;return q("div",{class:this.classes($a.base,ce.widget,{[$a.isLayoutHorizontal]:this.layout==="horizontal"})},q("calcite-button",{afterCreate:n=>{this._panButton=n},appearance:t?"outline-fill":"solid",class:ce.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?void 0:-1,title:i}),q("calcite-button",{afterCreate:n=>{this._rotateButton=n},appearance:t?"solid":"outline-fill",class:ce.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:t?-1:void 0,title:i}))}};r([l()],Ce.prototype,"icon",null),r([l()],Ce.prototype,"label",null),r([l({value:"vertical"})],Ce.prototype,"layout",null),r([l(),Jt("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Ce.prototype,"messages",void 0),r([l()],Ce.prototype,"view",null),r([l({type:Ya})],Ce.prototype,"viewModel",void 0),Ce=r([v("esri.widgets.NavigationToggle")],Ce);const gu=Ce;let tt=class extends M{get canZoomIn(){if(!this.view?.ready)return!1;const e=this.view?.constraints?.effectiveMaxScale;return e===0||this._scale>e}get canZoomOut(){const{view:e}=this;if(!e?.ready)return!1;const t=e.constraints?.effectiveMinScale;return t===0||this._scale<t}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};r([l({readOnly:!0})],tt.prototype,"canZoomIn",null),r([l({readOnly:!0})],tt.prototype,"canZoomOut",null),r([l()],tt.prototype,"view",void 0),r([l()],tt.prototype,"_scale",null),tt=r([v("esri.widgets.Zoom.ZoomConditions2D")],tt);const yu=tt;let _t=class extends M{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};r([l({readOnly:!0})],_t.prototype,"canZoomIn",null),r([l({readOnly:!0})],_t.prototype,"canZoomOut",null),r([l()],_t.prototype,"view",void 0),_t=r([v("esri.widgets.Zoom.ZoomConditions3D")],_t);const fu=_t;let He=class extends M{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){return this._zoomConditions!=null&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new yu({view:e}):e.type==="3d"&&(this._zoomConditions=new fu({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){const e=this.view;this.canZoomIn&&e&&(e.type==="2d"?e.mapViewNavigation.zoomIn():Es(e.goTo({zoomFactor:2})))}zoomOut(){const e=this.view;this.canZoomOut&&e&&(e.type==="2d"?e.mapViewNavigation.zoomOut():Es(e.goTo({zoomFactor:.5})))}};r([l()],He.prototype,"_zoomConditions",void 0),r([l()],He.prototype,"canZoomIn",null),r([l()],He.prototype,"canZoomOut",null),r([l({readOnly:!0})],He.prototype,"state",null),r([l()],He.prototype,"view",null),He=r([v("esri.widgets.Zoom.ZoomViewModel")],He);const Xa=He,Qa={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let Ee=class extends ei{constructor(e,t){super(e,t),this.messages=null,this.viewModel=new Xa,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Gi({button:()=>import("./index-DprBlnKG.js")})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Qa.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:t,canZoomOut:i}=this.viewModel,{zoomIn:n,zoomOut:s}=this.messages;return q("div",{class:this.classes(Qa.base,ce.widget,e)},q("calcite-button",{class:ce.widgetButton,disabled:!t,iconStart:"plus",kind:"neutral",label:n,onclick:this.zoomIn,title:n}),q("calcite-button",{class:ce.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:s,onclick:this.zoomOut,title:s}))}};r([l()],Ee.prototype,"icon",null),r([l()],Ee.prototype,"label",null),r([l({value:"vertical"})],Ee.prototype,"layout",null),r([l(),Jt("esri/widgets/Zoom/t9n/Zoom")],Ee.prototype,"messages",void 0),r([l()],Ee.prototype,"view",null),r([l({type:Xa})],Ee.prototype,"viewModel",void 0),Ee=r([v("esri.widgets.Zoom")],Ee);const vu=Ee;function _u(e){return e?.view!==void 0}let Si=class extends su{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=t=>{this.components.forEach(i=>{const n=this._find(i),s=n?.widget;_u(s)&&(s.view=t)})},this._componentsWatcher=(t,i)=>{this._removeComponents(i),this._addComponents(t),this._adjustPadding(t)}}initialize(){this.addHandles([_(()=>this.components,this._componentsWatcher,G),_(()=>this.view,this._updateViewAwareWidgets,G)])}_add(e,t,i,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,t,i,n,s)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);return new Ti({id:e,node:t})}_createWidget(e){const t=this.view;switch(e){case"attribution":return new pu({view:t});case"compass":return new mu({view:t});case"navigation-toggle":return new gu({view:t});case"zoom":return new vu({view:t})}}};r([l()],Si.prototype,"components",void 0),Si=r([v("esri.views.ui.DefaultUI")],Si);const Ja=Si;let Pi=class extends Ja{constructor(e){super(e),this.components=["attribution","zoom"]}};r([l()],Pi.prototype,"components",void 0),Pi=r([v("esri.views.ui.2d.DefaultUI2D")],Pi);const er=Pi;class wu extends Yl{constructor(t,i){super(t,i,"webmap")}}function ki(e){return e!=null&&typeof e=="object"&&"declaredClass"in e&&e.declaredClass==="esri.WebMap"}new wu(2,33);let tr,ir,nr,sr,or,ar,rr;async function bu(){const[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:n,MagnifierView2D:s,GridView2D:o,Stage:a}]=await Promise.all([import("./webglDeps-B_grlYgT.js"),import("./mapViewDeps-CF678-65.js")]);ir=e,nr=t,sr=i,or=n,ar=s,rr=o,tr=a}let w=class extends fd(eh(yh(oh(oc)))){constructor(e){super(e),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new Is({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.graphicsView=null,this.labelManager=null,this.navigation=new pi({actionMap:new pn({dragTertiary:"none"})}),this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.floors=new k,this.grid=null,this.map=null,this.spatialReferenceLocked=!1,this.timeline=new ss,this.type="2d",this.view2dType=null,this.ui=new er,this.test={takeScreenshot:async t=>Kp(this._getScreenshotView(t),t)},this.padding={top:0,right:0,bottom:0,left:0},Jr()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=re(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new fp(this.featuresTilingScheme)}get constraintsInfo(){const e=this.defaultsFromMap?.tileInfo,t=this.spatialReference;return{lods:e?.spatialReference?.equals(t)?e.lods:null,spatialReference:t}}get initialExtentRequired(){if(!this.stateManager)return!1;const{scale:e,constraints:t,center:i,viewpoint:n,extent:s}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint)&&!s&&(t?.effectiveLODs||(o=-1),(!i||e===0&&o===-1)&&(n?.targetGeometry==null||n.targetGeometry.type!=="extent"&&!n.scale))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const t=e.targetGeometry,i=this.spatialReference;return el(t.spatialReference,i)}get background(){return ki(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){return this.stateManager?.center??null}set center(e){this.stateManager.center=e}get highlightOptions(){return Sa(this)}set highlightOptions(e){Pa(this,e)}get padding(){return this.stateManager?.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){return this.stage?.renderRequested??!1}get resolution(){return this.stateManager.resolution??0}get scale(){return this.stateManager?.scale??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){const e=!(!this.magnifier.visible||this.magnifier.position===null||!this._magnifierView?.updatingHandles.updating),t=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(i=>!i.destroyed&&!("layerViews"in i)&&i.updating===!0)||e);if(U("esri-2d-log-updating")){const i=this.allLayerViews.reduce((n,s)=>({...n,[`${s.layer.id}(${s.layer.type})`]:!s.destroyed&&!("layerViews"in s)&&s.updating}),{});console.log(`Updating MapView: ${t}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${this.layerViewManager?.updating}
-> labelManager.updating: ${this.labelManager?.updating}
-> graphicsView.updating: ${this.graphicsView?.updating}
-> allLayerViews: ${JSON.stringify(i)}
-> updatingMagnifier: ${e}
`)}return t}get visibleArea(){const e=this.stateManager.visibleArea;return e&&new Ps({rings:[e.map(t=>[t[0],t[1]])],spatialReference:this.spatialReference})}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){return this.mapViewNavigation?.interacting??!1}async hitTest(e,t){return zp(this,e,t)}async takeScreenshot(e){return Bp(this._getScreenshotView(e),e)}toMap(e){if(!this.ready)return null;const t=mo(e)?uo(this,e):e;return this.stateManager.toMap(t)}toScreen(e,t){return this.stateManager.toScreen(e,t)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return ki(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return ki(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(e){return ua.hasLayerViewModule(e)}importLayerView(e){return ua.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(I.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(e){const t=this.toMap(e),i=await this.hitTest(e),n=this.allLayerViews.toArray().filter(c=>c.clips.every(d=>xa(this,d,e,t))).reverse(),s=new globalThis.Map(n.map(c=>[c.layer.uid,c])),o=[];let a=0,h=0;for(;a<i.results.length||h<n.length;){const c=i.results.at(a);if(c&&c.type!=="graphic"){++a;continue}const d=s.get((c?.layer??c?.graphic.layer)?.uid);if((!c||d)&&h<n.length&&n.at(h)!==d){const p=n.at(h);"fetchPopupFeaturesAtLocation"in p&&o.push({mapPoint:t,layerView:p}),++h}else c&&(o.push({graphic:c.graphic,layerView:d}),++a)}return{hits:o,location:t}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let e=Jp(this.type);if(U("safari")&&U("safari")<9&&(e=new T("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:U("safari")})),e!=null)throw I.getLogger(this).warn("#validate()",e.message),e}loadAsyncDependencies(){return bu()}_getDefaultViewpoint(){const{constraints:e,initialExtent:t,map:i,padding:n,size:s}=this;if(!e)return null;const o=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,a=this.stateManager.getUserStartupOptions(this.size),h=o?.viewpoint,c=h?.targetGeometry?.extent??t,d=c?.center,p=h?.rotation??0,m=h?.scale||c&&ui(c,[s[0]-n.left-n.right,s[1]-n.top-n.bottom]),u=a.center??d,g=a.rotation??p,f=a.scale??m;return u&&f?new X({targetGeometry:u,scale:f,rotation:g}):null}_startup(){this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;const t=new tr(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=t,this._magnifierView=new ar,this._magnifierView.magnifier=this.magnifier,this._gridView=new rr;const i=new sr({view:this});this._set("labelManager",i);const n=new up({view:this});this._set("animationManager",n);const s=new or({view:this,animationManager:n});this._set("mapViewNavigation",s),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),t.on("webgl-error",a=>this.fatalError=a.error),_(()=>this.stationary,a=>t.stationary=a,ae),_(()=>this.background,a=>{t.backgroundColor=a?.color,this._magnifierView.backgroundColor=a?.color},ae),_(()=>this.magnifier,a=>this._magnifierView.magnifier=a,ae),_(()=>this.grid,a=>this._gridView.grid=a,ae),_(()=>this.renderingOptions,a=>t.renderingOptions=a,ae),_(()=>this.highlights.items.map(a=>({name:a.name,options:{fillColor:a.color,haloColor:a.haloColor,fillOpacity:a.fillOpacity,haloOpacity:a.haloOpacity,haloWidth:a.haloWidth,haloBlur:a.haloBlur}})),()=>{t.highlightGradient=Ma(t.highlightGradient,this.highlights.items)},ae),_(()=>this.state.id,()=>t.state=this.state,ae)],"map-view"),this._updateStageChildren();const o=this._resolveWhenReady;this._resolveWhenReady=[],o.forEach(a=>a(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(t=>{this.stage.addChild(t.container)});const e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const e=new Ll(il.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const t=new ir({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new nr(e)});this._set("graphicsView",t)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){const{allLayerViews:t,padding:i,size:n,stage:s}=this;return{allLayerViews:t,backgroundColor:e?.ignoreBackground?null:this.background?.color,padding:i,size:n,stage:s}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(const t of this.allLayerViews)t.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const t of this.allLayerViews)t.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};w.type="2d",r([l({constructOnly:!0})],w.prototype,"deactivatedWebGLExtensions",void 0),r([l({constructOnly:!0})],w.prototype,"debugWebGLExtensions",void 0),r([l({readOnly:!0})],w.prototype,"featuresTilingScheme",void 0),r([l({readOnly:!0})],w.prototype,"graphicsTileStore",null),r([l()],w.prototype,"graphicsView",void 0),r([l()],w.prototype,"constraintsInfo",null),r([l()],w.prototype,"initialExtentRequired",null),r([l()],w.prototype,"labelManager",void 0),r([l({type:pi,nonNullable:!0})],w.prototype,"navigation",void 0),r([l({constructOnly:!0})],w.prototype,"renderCanvas",void 0),r([l()],w.prototype,"renderingOptions",void 0),r([l({constructOnly:!0})],w.prototype,"supersampleScreenshotsEnabled",void 0),r([l({readOnly:!0})],w.prototype,"supportsGround",void 0),r([l()],w.prototype,"defaultsFromMapSettings",null),r([l({readOnly:!0})],w.prototype,"typeSpecificPreconditionsReady",null),r([l({type:Xl})],w.prototype,"background",null),r([l()],w.prototype,"center",null),r([l({type:k})],w.prototype,"floors",void 0),r([l()],w.prototype,"grid",void 0),r([l({type:be})],w.prototype,"highlightOptions",null),r([l()],w.prototype,"map",void 0),r([l()],w.prototype,"padding",null),r([l({readOnly:!0})],w.prototype,"rendering",null),r([l({readOnly:!0})],w.prototype,"resolution",null),r([l()],w.prototype,"scale",null),r([l({constructOnly:!0})],w.prototype,"spatialReferenceLocked",void 0),r([l({readOnly:!0})],w.prototype,"tileInfo",null),r([l({type:ss,readOnly:!0})],w.prototype,"timeline",void 0),r([l({readOnly:!0})],w.prototype,"type",void 0),r([l({readOnly:!0})],w.prototype,"updating",null),r([l({readOnly:!0})],w.prototype,"view2dType",void 0),r([l({readOnly:!0})],w.prototype,"visibleArea",null),r([l()],w.prototype,"zoom",null),r([l({readOnly:!0})],w.prototype,"navigating",null),r([l(),Ze(e=>e instanceof Ja?e:Xr(er,e))],w.prototype,"ui",void 0),w=r([v("esri.views.View2D")],w);const Mu=w;let Ci=class extends Mu{constructor(e){super(e),this.view2dType="map"}};r([l({readOnly:!0})],Ci.prototype,"view2dType",void 0),Ci=r([v("esri.views.MapView")],Ci);const Tu=Ci,xu=Object.freeze(Object.defineProperty({__proto__:null,default:Tu},Symbol.toStringTag,{value:"Module"}));export{Vo as $,cn as A,Vp as B,Lp as C,Yn as D,Kn as E,vp as F,xn as G,_p as H,ma as I,ss as J,Wa as K,$n as L,Cp as M,Xn as N,Ep as O,Ip as P,ba as Q,Ht as R,Qn as S,Jn as T,wa as U,Dp as V,So as W,Xh as X,to as Y,sn as Z,we as _,ce as a,nn as a0,tn as a1,jp as a2,xu as a3,be as b,Ma as c,Pa as d,Vt as e,eo as f,Op as g,vn as h,Ua as i,X as j,Lt as k,fn as l,Mn as m,le as n,Tc as o,Oo as p,Pc as q,Fo as r,ki as s,Sa as t,Ap as u,es as v,Ta as w,ge as x,Co as y,at as z};
