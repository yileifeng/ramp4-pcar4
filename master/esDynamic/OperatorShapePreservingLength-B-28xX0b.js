import{k as Y,L as H,P as O,a as J,f as K,e as d,b as Q}from"./Transformation2D-Dqu-RtOz.js";import{o as R,a0 as j,n as W,a1 as Z,b as $,k as ee,a as te,N as se,a2 as ne,L as oe,a3 as P}from"./ProjectionTransformation-DKC-VGdP.js";function A(){return{m_pGcs:new d,m_xyz:new P,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:ae,setLength:re,assign:ie}}function ae(i,e,t,n){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(n),this.m_geoLength=t}function re(i){this.m_geoLength=i}function ie(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}class ge{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,u,s){if(e.hasNonLinearSegments()&&(e=new R().execute(e,0,t.getTolerance(0),0,s)),t.isPannable()){let m=90,a=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(m*=Math.PI/180,a*=Math.PI/180),t.getCoordinateSystemType()===2){let x=null;const o=[0,0,0,0];x=t.getPECoordSys(),o[0]=0,o[1]=m,o[2]=0,o[3]=a,j.geogToProj(x,2,o),m=o[1],a=o[3]}const c=new W;e.queryEnvelope(c),c.ymin=a,c.ymax=m,e=new Z().execute(e,c,t,s)}else{const m=t.getPCSHorizon();(e=new $().execute(e,m,t,s))===m&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,u,1,s)}_ExecuteIterativeApproach(e,t,n,u,s,m){const a=oe();n.querySpheroidData(a);const c=a.majorSemiAxis,x=a.e2,o=n.getUnit().getUnitToBaseFactor(),T=40,C=Y(A,T),w=H(T,Number.NaN),f=A(),g=A();let y;const r=[0,0,0,0],V=t.getPECoordSys(),L=new d,E=new d,p=new d,_=new d,S=new d;let k=0;const v=e.querySegmentIterator();for(;v.nextPath();)for(;v.hasNextSegment();){const z=v.nextSegment();L.assign(z.getStartXY()),E.assign(z.getEndXY()),t.getCoordinateSystemType()===2?(r[0]=L.x,r[1]=L.y,r[2]=E.x,r[3]=E.y,j.projToGeog(V,2,r),p.x=r[0]*o,p.y=r[1]*o,_.x=r[2]*o,_.y=r[3]*o):(p.setCoordsPoint2D(L),_.setCoordsPoint2D(E),p.scale(o),_.scale(o));const D=new P,I=new P;U(c,x,p,D),U(c,x,_,I);let l=G(c,D,I);f.setValues(0,p,Number.NaN,D),g.setValues(1,_,l,I),y=s,C[0].assign(g),w[0]=s;let h=0;for(;;){h>128&&Q("iterations exceeded");const q=.5*(f.m_factor+g.m_factor),M=z.getCoord2D(q);t.getCoordinateSystemType()===2?(r[0]=M.x,r[1]=M.y,j.projToGeog(V,1,r),S.x=r[0]*o,S.y=r[1]*o):(S.setCoordsPoint2D(M),S.scale(o)),p.setCoordsPoint2D(f.m_pGcs),_.setCoordsPoint2D(g.m_pGcs);const b=new P;U(c,x,S,b);const B=G(c,f.m_xyz,b),F=G(c,g.m_xyz,b);l=g.m_geoLength,Number.isNaN(l)&&(l=G(c,f.m_xyz,g.m_xyz));const N=B+F,X=y===s&&N>=20&&Math.abs(N-l)>1e-8*(l+N);if(h+2<T&&(X||Math.abs(N-l)>0&&y>0))g.setLength(F),C[h].assign(g),g.setValues(q,S,B,b),C[++h].assign(g),X?(y=s,w[h]=s):(y--,w[h-1]=y,w[h]=y);else{if(k+=N,h===0)break;f.assign(g),g.assign(C[--h]),y=w[h]}}}return k}execute(e,t,n){if(t&&t.getCoordinateSystemType()!==0||O(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null;const s=t.getGCS();s!==t&&(u=ee(t,s,null));const m=e.getGeometryType();if(m===J.enumEnvelope){const a=new te;return a.addEnvelope(e,!1),this._ExecuteShapePreservingLength(a,t,s,u,n)}if(K(m)){const a=new se;return a.addSegment(e,!0),this._ExecuteShapePreservingLength(a,t,s,u,n)}return this._ExecuteShapePreservingLength(e,t,s,u,n)}}function U(i,e,t,n){n.assign(ne(i,e,t))}function G(i,e,t){const n=i,u=new P;u.setSub(e,t);const s=u.length();return 2*n*Math.asin(s/(2*n))}export{ge as w};
