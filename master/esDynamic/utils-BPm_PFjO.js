import{bS as u,E as f,bT as y,bU as $,at as d,bV as T,ao as g,bW as Z,bX as b,a$ as w}from"./main-BC8gbEPx.js";import"./mat4f32-CiZjBg9k.js";import"./mat4-BDUaQr32.js";import"./intl-BsAxaYOa.js";import{h as U}from"./timeZoneUtils-dvSLdrBh.js";const S=",",C={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},D=new Set(["integer","small-integer"]);let l=null;function M(t){return g(t)||Z(t)||b(t)}async function N(t){const{field:n,field2:e,field3:r,normalizationField:a,valueExpression:i}=t;let o=[];if(i){if(!l){const{arcadeUtils:s}=await w();l=s}o=l.extractFieldNames(i)}return n&&o.push(n),e&&o.push(e),r&&o.push(r),a&&o.push(a),o}function m(t){return String(t).padStart(2,"0")}function p(t,n,e){let r;return n==="date"||n==="number"?(n==="number"&&(t=new Date(t)),r=`TIMESTAMP'${e?t.getFullYear():t.getUTCFullYear()}-${m((e?t.getMonth():t.getUTCMonth())+1)}-${m(e?t.getDate():t.getUTCDate())} ${m(e?t.getHours():t.getUTCHours())}:${m(e?t.getMinutes():t.getUTCMinutes())}:${m(e?t.getSeconds():t.getUTCSeconds())}'`):r=t,r}function v(t,n,e,r){const{hasQueryEngine:a}=t,i=`(${p(e,h(t,e),a)} - ${p(n,h(t,n),a)})`;let o=C[r],s="/";return o<1&&(o=1/o,s="*"),{sqlExpression:o===1?i:`(${i} ${s} ${o})`,sqlWhere:null}}function h(t,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const e=t.getField(n);if(n.toLowerCase()==="<now>")return;if(g(e))return"field"}}function E(t,n){const e=n&&t.getField(n);return!!e&&D.has(e.type)}function F(t){return`cast(${t} as float)`}function x(t,n){const{format:e,timeZoneOptions:r,fieldType:a}=n??{};let i,o;if(r&&({timeZone:i,timeZoneName:o}=U(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,u(e||"short-date-short-time"),a)),typeof t=="string"&&isNaN(Date.parse(a==="time-only"?`1970-01-01T${t}Z`:t)))return t;switch(a){case"date-only":{const s=u(e||"short-date");return typeof t=="string"?T(t,{...s}):f(t,{...s,timeZone:d})}case"time-only":{const s=u(e||"short-time");return typeof t=="string"?$(t,s):f(t,{...s,timeZone:d})}case"timestamp-offset":{if(!i&&typeof t=="string"&&new Date(t).toISOString()!==t)return t;const s=e||r?u(e||"short-date-short-time"):void 0,c=s?{...s,timeZone:i,timeZoneName:o}:void 0;return typeof t=="string"?y(t,c):f(t,c)}default:{const s=e||r?u(e||"short-date-short-time"):void 0;return f(typeof t=="string"?new Date(t):t,s?{...s,timeZone:i,timeZoneName:o}:void 0)}}}export{M as $,F as M,x as N,N as U,S as f,E as j,v as k};
