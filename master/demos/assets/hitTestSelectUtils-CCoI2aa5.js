import{az as fn,a9 as yn,aa as gn,fx as vn,B as l,D as u,N as Y,aN as rt,bj as mn,ad as Qt,aK as f,cF as wt,aM as xt,J as ke,bC as $n,hZ as bn,aO as Nn,dq as Ln,bn as En,cL as et,c2 as wn,dr as xn,gd as An,dz as Tn}from"./main-asQ7SttR.js";import{a as kn,n as Mn}from"./Cyclical-BtCZr1qb.js";import{o as dt,m as Xt}from"./quantityUtils-B6HSL2rj.js";import{L as _n,e as A,u as Rn,q as Me,d as U,j as ut,p as nt,l as Sn,B as Pn,_ as zn,o as _e,b as Re,E as ge}from"./vec2-maR1OrZI.js";import{m as jn,n as P,t as Lt,l as In}from"./vec2f64-DohEyf3f.js";import{H as $,s as te,o as V,v as Ft,R as M,P as k,q as E,p as Se,c as ee,_ as At,Z as Ct,j as On,A as qn,J as Bn}from"./vec32-BzCy6cr7.js";import{n as Tt,e as zt,a as Pe}from"./projectVectorToVector-VmpAJgQc.js";import{N as Gt,q as ne,j as kt,b as se}from"./geodesicUtils-DUEAC0ng.js";import{g as Dn}from"./TimeExtent-tqAWy-Dv.js";import{b as Hn}from"./Query-D7n22axe.js";import{f as Un,_ as ze,s as Vn}from"./MapView-CdXdWR5g.js";import{s as Fn,j as Cn}from"./vec42-CKs01hkn.js";import{n as Gn}from"./vec4f64-o2zAXfmz.js";import{i as Zn}from"./projectBuffer-Cx7kBt8y.js";import{M as z,z as Yn,l as jt,Q as Zt,d as je,k as Ie,V as Wn,H as Oe,O as qe,p as Jn}from"./plane-RIh6ulrU.js";import{I as Kn,O as Qn,_ as Xn,$ as ts,U as es}from"./sphere-DET7VZHS.js";import{m as ns,j as re,x as ss,E as rs}from"./elevationInfoUtils-Cb-uJoCx.js";import{e as ft}from"./common-DQOJ18NT.js";const Be="z",De="r",Nr={redo:De,undo:Be,center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},ve={toggle:"Control"},Lr={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},Er={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:Un,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:Be,redo:De};let wr=class{constructor(){this._bindings=new Map}add(t,n){return this.addToggle(t,s=>{s.type==="key-down"&&n(s)})}addToggle(t,n){const s=is.fromDefinition(t,n),r=fn(this._bindings,s.key,()=>[]);return r.push(s),yn(()=>gn(r,s))}register(t,n=ze.WIDGET){return vn([t.on("key-down",s=>this.dispatch(t.inputManager,s),n),t.on("key-up",s=>this.dispatch(t.inputManager,s),n)])}dispatch(t,n){const s=n.key,r=this._bindings.get(s);if(r)for(const i of r)i.process(t,n)}},is=class Yt{constructor(t,n,s,r,i){this.key=t,this.modifiers=n,this.repeats=s,this.continuePropagation=r,this.callback=i}process(t,n){if(!(n.key!==this.key||"repeat"in n&&n.repeat&&!this.repeats)){for(const s of this.modifiers)if(!t.isModifierKeyDown(s))return;this.continuePropagation||n.stopPropagation(),this.callback(n)}}static fromDefinition(t,n){if(typeof t=="string")return new Yt(t,[],!1,!1,n);const{key:s,modifier:r,repeats:i,continuePropagation:a}=t;return new Yt(s,r?Array.isArray(r)?r:[r]:[],!!i,!!a,n)}},Et=class extends rt{constructor(t){super(t),this.enabled=!1}};l([u({type:Boolean,nonNullable:!0})],Et.prototype,"enabled",void 0),Et=l([Y("esri.views.interactive.sketch.SketchLabelOptions")],Et);const He=Et;let ht=class extends rt{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};l([u({type:String,nonNullable:!0})],ht.prototype,"mode",void 0),ht=l([Y("esri.views.interactive.sketch.SketchTooltipElevationOptions")],ht);let L=class extends rt{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};l([u({type:Boolean,nonNullable:!0})],L.prototype,"area",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"coordinates",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"direction",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"distance",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"elevation",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"header",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"helpMessage",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"orientation",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"radius",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"rotation",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"scale",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"size",void 0),l([u({type:Boolean,nonNullable:!0})],L.prototype,"totalLength",void 0),L=l([Y("esri.views.interactive.sketch.SketchTooltipVisibleElements")],L);const Ue=L;let x=class extends rt{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new ht,this.placement="auto",this.offset=null,this.visibleElements=new Ue,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};l([u({type:Boolean,nonNullable:!0})],x.prototype,"enabled",void 0),l([u()],x.prototype,"forceEnabled",void 0),l([u()],x.prototype,"effectiveEnabled",null),l([u()],x.prototype,"helpMessage",void 0),l([u()],x.prototype,"helpMessageIcon",void 0),l([u({type:Boolean,nonNullable:!0})],x.prototype,"inputEnabled",void 0),l([u({type:ht,nonNullable:!0})],x.prototype,"elevation",void 0),l([u()],x.prototype,"placement",void 0),l([u()],x.prototype,"offset",void 0),l([u({type:Ue,nonNullable:!0})],x.prototype,"visibleElements",void 0),l([u()],x.prototype,"visualVariables",void 0),l([u()],x.prototype,"xyMode",void 0),x=l([Y("esri.views.interactive.sketch.SketchTooltipOptions")],x);const Ve=x;let it=class extends rt{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};l([u()],it.prototype,"length",void 0),l([u()],it.prototype,"verticalLength",void 0),l([u()],it.prototype,"area",void 0),it=l([Y("esri.views.interactive.sketch.Units")],it);const Mt=it;var T;function os(e,t){if(e==null||t==null)return;const n=Wt(e,t);return n!=null?dt(n,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(T||(T={}));const Wt=(()=>{const e=f(),t=f();return(n,s)=>(V(e,n.x,n.y,n.z??0),V(t,s.x,s.y,s.z??0),as(e,t,n.spatialReference,s.spatialReference))})(),as=(()=>{const e=P(),t=f(),n=f();return(s,r,i,a)=>{if($(s,r))return;const o=Gt(i),c=Gt(a);if(o&&c&&mn(o,c)&&Tt(s,i,t,o)&&Tt(r,a,n,c)){const{azimuth:h}=ne(cs,t,n,o);return h!=null?Qt(h,"degrees","radians"):void 0}e[0]=r[0]-s[0],e[1]=r[1]-s[1];let p=_n(jn,e);return e[0]<0&&(p=us-p),p}})();function _r(e,t,n,s=T.Absolute){if(t&&n)switch(s){case T.Absolute:return os(t,n);case T.Relative:return $e(me(e,t,n),T.Relative);case T.RelativeBilateral:return $e(me(e,t,n),T.RelativeBilateral)}}function me(e,t,n){if(!e||!t||!n)return;const s=Wt(e,t),r=Wt(t,n);return s!=null&&r!=null?dt(r-s,"radians","geographic"):void 0}function $e(e,t){if(e!=null)switch(t){case T.Absolute:return ls(e);case T.Relative:{const n=_t(e);let s=be.normalize(n,0,!0);return s===-180&&(s=180),dt(s,"degrees","geographic")}case T.RelativeBilateral:{const n=_t(e),s=Math.abs(be.normalize(n,0,!0));return dt(s,"degrees","geographic")}}}function ls(e){const t=_t(e),n=ps.normalize(t,0,!0);return dt(n,"degrees","geographic")}const Rr=(()=>{const e=f();return(t,n,s,r,i,a="geodesic")=>{te(e,n);const o=_t(i);if(a==="geodesic"){const y=Gt(s);if(y&&Tt(e,s,e,y))return kt(t,e,o,r,y),t[2]=n[2],!!Tt(t,y,t,s)}const c=Xt(o,"geographic","arithmetic"),p=Qt(c,"degrees","radians"),h=n[0]+r*Math.cos(p),d=n[1]+r*Math.sin(p),b=n[2];return V(t,h,d,b),!0}})();function _t(e){if(e!=null)return Xt(Fe(e),e.rotationType,"geographic")}function Sr(e){if(e!=null)return Xt(Fe(e),e.rotationType,"arithmetic")}function Fe(e){return Qt(e.value,e.unit,"degrees")}const cs=new se,us=2*Math.PI,ps=kn,be=new Mn(-180,180);let W=class extends rt{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?T.RelativeBilateral:T.Relative;case"absolute":return T.Absolute}}get displayUnits(){return this._get("displayUnits")??new Mt}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new Mt}set inputUnits(e){this._set("inputUnits",e)}};l([u({type:String,nonNullable:!0})],W.prototype,"directionMode",void 0),l([u({type:Boolean,nonNullable:!0})],W.prototype,"relativeDirectionIsBilateral",void 0),l([u()],W.prototype,"effectiveDirectionMode",null),l([u({type:Mt,nonNullable:!0})],W.prototype,"displayUnits",null),l([u({type:Mt,nonNullable:!0})],W.prototype,"inputUnits",null),W=l([Y("esri.views.interactive.sketch.SketchValueOptions")],W);const Ce=W;let ot=class extends rt{constructor(t){super(t),this.labels=new He,this.tooltips=new Ve,this.values=new Ce}};l([u({nonNullable:!0,type:He})],ot.prototype,"labels",void 0),l([u({nonNullable:!0,type:Ve})],ot.prototype,"tooltips",void 0),l([u({nonNullable:!0,type:Ce})],ot.prototype,"values",void 0),ot=l([Y("esri.views.interactive.sketch.SketchOptions")],ot);const zr=ot;var st;function Ge(e,t,n){return R(e,t,n)}function R(e=0,t=0,n=0){return wt(e,t,n)}function jr(e){return e}function Ir(e){return e}function Q(e,t,n){return wt(e,t,n)}function at(e){const[t,n,s]=e;return e.length>3?[t,n,s,e[3]]:[t,n,s]}function Or(e){return e[3]=((e.length>3?e[3]:void 0)??st.NONE)|st.TARGET,e}function qr(e){return!!(((e.length>3?e[3]:void 0)??st.NONE)&st.TARGET)}function Ne(e,t,{coordinateHelper:n,elevationInfo:s},r){return e?hs(n.vectorToDehydratedPoint(e,ds),t,s,r):null}function hs(e,t,n,s=R()){return s[0]=e.x,s[1]=e.y,s[2]=e.z??0,t==null||(t.type==="2d"?s[2]=0:s[2]=ns(t,e,n,re)??0),s}function Br(e,t,n){return n?(Pe(n,e[0],e[1],e[2],t),n):zt(e[0],e[1],e[2],t)}function Dr(e,t,{z:n,m:s},r,i){const{spatialReference:a,elevationInfo:o}=r;let c;n==null&&s==null?c=void 0:t==null||t.type==="2d"?c=n??void 0:c=ss(t,e,a,re,o)??0;const[p,h]=e;return i?Pe(i,p,h,c,a):i=zt(p,h,c,a),s!=null&&(i.m=s,i.hasM=!0),i}function Hr(e,t,n,s,r=R()){const[i,a]=e;return r[0]=i,r[1]=a,e.length>3&&(r[3]=e[3]??st.NONE),n?.type!=="3d"?(r[2]=t.value,r):(r[2]=rs(n,i,a,t.value,s,t.elevationInfo,re)??0,r)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(st||(st={}));const ds=zt(0,0,0,null);let O=class extends ke{constructor(){super(...arguments),this.enabled=!0}};l([u({type:Boolean})],O.prototype,"enabled",void 0),O=l([Y("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],O);let v=class extends ke{constructor(e){super(e),this.lineSnapper=new O,this.parallelLineSnapper=new O,this.rightAngleSnapper=new O,this.rightAngleTriangleSnapper=new O,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new xt([255,127,0]),this.orangeTransparent=new xt([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};l([u({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"lineSnapper",void 0),l([u({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"parallelLineSnapper",void 0),l([u({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"rightAngleSnapper",void 0),l([u({type:O,constructOnly:!0,nonNullable:!0,json:{write:!0}})],v.prototype,"rightAngleTriangleSnapper",void 0),l([u({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],v.prototype,"shortLineThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],v.prototype,"distance",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"pointThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"intersectionParallelLineThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"parallelLineThreshold",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"verticalLineThresholdMeters",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"touchSensitivityMultiplier",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],v.prototype,"pointOnLineThreshold",void 0),l([u({type:xt,nonNullable:!0})],v.prototype,"orange",void 0),l([u({type:xt,nonNullable:!0})],v.prototype,"orangeTransparent",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"lineHintWidthReference",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"lineHintWidthTarget",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"lineHintFadedExtensions",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],v.prototype,"parallelLineHintWidth",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],v.prototype,"parallelLineHintLength",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],v.prototype,"parallelLineHintOffset",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],v.prototype,"rightAngleHintSize",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],v.prototype,"rightAngleHintOutlineSize",void 0),l([u({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],v.prototype,"satisfiesConstraintScreenThreshold",void 0),v=l([Y("esri.views.interactive.snapping.Settings.Defaults")],v);const Vr=new v;var lt;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(lt||(lt={}));const Fr=Symbol("grid-placement-graphic");function fs(e,t){const n=e.x-t.x,s=e.y-t.y;return n*n+s*s}function Cr(e,t){return Math.sqrt(fs(e,t))}function Gr(e,t){t.sort((n,s)=>Ft(n.targetPoint,e)-Ft(s.targetPoint,e))}var Le;function Zr({point:e,distance:t,returnEdge:n,vertexMode:s,coordinateHelper:{spatialReference:r},filter:i},a,o){return o=o!=null?o.clone():new Hn({where:"1=1"}),i&&(o.geometry=i.geometry,o.distance=i.distance,o.spatialRelationship=i.spatialRelationship,o.where=$n(o.where,i.where),o.timeExtent=Dn(o.timeExtent,i.timeExtent),o.objectIds=ys(o.objectIds,i.objectIds)),{point:zt(e[0],e[1],e[2],r.toJSON()),mode:a,distance:t,returnEdge:n,vertexMode:s,query:o.toJSON()}}function ys(e,t){return e||t?t?e?Array.from(bn(new Set(e),new Set(t))):t:e:null}function Yr(e,t,n){return{left:Ne(e.leftVertex.pos,t,n),right:Ne(e.rightVertex.pos,t,n)}}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(Le||(Le={}));const Ee=Symbol("snapping-toggle");function Wr(e,t=()=>{}){const n=Nn(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:s,snappingOptions:r})=>{if(e.removeHandles(Ee),!s||!r)return;const i=ze.TOOL,a=[s.on("key-down",o=>{o.key!==ve.toggle||o.repeat||(r.enabledToggled=!0,t())},i),s.on("key-up",o=>{o.key===ve.toggle&&(r.enabledToggled=!1,t())},i),s.on("pointer-move",o=>{const c=o.native.ctrlKey;r.enabledToggled!==c&&(r.enabledToggled=c,t())},i)];e.addHandles(a,Ee)},Ln);e.addHandles(n)}function Jr(e){return Vn(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}function Ht(e,t){return e[0]*t[1]-e[1]*t[0]}function gs(e,t,n){const s=ut(n,t)/nt(n);return Sn(e,n,s)}function Kr(e,t,n,s,r=n){return A(tt,s,n),A(Rt,t,r),gs(ct,Rt,tt),Rn(e,r,ct)}function Qr(e,t,n,s){A(tt,t,n);const r=s/Me(tt);return U(e,n,tt,r)}function Xr(e,t){const n=e.start,s=e.end,r=t.start,i=t.end,a=A(tt,s,n),o=A(Ze,i,r),c=Ht(a,o);if(Math.abs(c)<=ms)return[];const p=A(Rt,n,r),h=Ht(o,p)/c,d=Ht(a,p)/c;if(h>=0){if(d>=0||t.type===m.LINE)return[U(ct,n,a,h)]}else if(e.type===m.LINE&&(d>=0||t.type===m.LINE))return[U(ct,n,a,h)];return[]}function vs(e,t,n){const s=[],r=A(tt,e.end,e.start),i=A(Ze,e.start,t),a=nt(r),o=2*ut(r,i),c=o*o-4*a*(nt(i)-n*n);if(c===0){const p=-o/(2*a);(e.type===m.LINE||p>=0)&&s.push(U(ct,e.start,r,p))}else if(c>0){const p=Math.sqrt(c),h=(-o+p)/(2*a);(e.type===m.LINE||h>=0)&&s.push(U(ct,e.start,r,h));const d=(-o-p)/(2*a);(e.type===m.LINE||d>=0)&&s.push(U(Rt,e.start,r,d))}return s}var m;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(m||(m={}));const ms=1e-6,tt=P(),Ze=P(),Rt=P(),ct=P();function ie({start:e,end:t,type:n},s,r){const i=[],a=A(yt,t,e),o=A(It,e,s),c=nt(a),p=2*ut(a,o),h=p*p-4*c*(nt(o)-r*r);if(h===0){const d=-p/(2*c);(n===_.PLANE||d>=0)&&i.push(U(P(),e,a,d))}else if(h>0){const d=Math.sqrt(h),b=(-p+d)/(2*c);(n===_.PLANE||b>=0)&&i.push(U(P(),e,a,b));const y=(-p-d)/(2*c);(n===_.PLANE||y>=0)&&i.push(U(P(),e,a,y))}return i}function Ye(e,t){const n=e.start,s=e.end,r=A(yt,s,n),i=V(qt,-r[1],r[0],0),a=t.start,o=t.end,c=M(ae,o,a),p=k(c,i),h=V(nn,n[0],n[1],0),d=M(sn,h,a),b=k(d,i),y=ft();if(Math.abs(p)<y)return[];const N=E(rn,a,c,b/p);if(t.type===m.RAY){const w=M(Jt,N,a);if(k(w,c)<-y)return[]}if(e.type===_.HALF_PLANE){const w=Pn(It,N,n);if(ut(w,r)<-y)return[]}return[et(N)]}function $s(e,t){return Ns(St(le,t[2],e),t)}function We(e,t){return tn(St(le,0,e),St(xs,0,t)).map(([s,r])=>Lt(s,r))}function Je(e,t,n){return Qe(e,St(le,e[2],t),n)}function Ke(e,t,n,s=f()){const r=A(yt,e,t),i=Me(r);return U(s,t,r,i===0?1:n/i),s[2]=e[2],s}function Qe(e,{start:t,end:n,type:s},r=f()){const i=M(Ot,e,t),a=M(qt,n,t),o=k(i,a)/k(a,a);return E(r,t,a,s===m.RAY?Math.max(o,0):o)}const bs=(()=>{const e=f(),t=f(),n=f();return({start:s,end:r},{center:i,radius:a,normal:o,slicePlane:c})=>{const p=jt(i,o,ws);if(g(Zt(p,s),0)&&g(Zt(p,r),0)){je(o,e,t);const d=(N,w)=>(ee(n,w,i),_e(N,k(n,e),k(n,t)),N),b=vs({start:d(yt,s),end:d(It,r),type:m.LINE},In,a),y=[];for(const[N,w]of b){const S=te(f(),i);E(S,S,e,N),E(S,S,t,w),c&&!K(c,S)||y.push(S)}return y}const h=f();return Ie(p,s,r,h)?!g(Se(h,i),a)||c&&!K(c,h)?[]:[h]:[]}})();function Xe({start:e,end:t,type:n},s,r){const i=[],a=ee(Ot,t,e),o=A(It,e,s),c=nt(a),p=2*ut(a,o),h=p*p-4*c*(nt(o)-r*r);if(h===0){const d=-p/(2*c);(n===m.LINE||d>=0)&&i.push(E(f(),e,a,d))}else if(h>0){const d=Math.sqrt(h),b=(-p+d)/(2*c);(n===m.LINE||b>=0)&&i.push(E(f(),e,a,b));const y=(-p-d)/(2*c);(n===m.LINE||y>=0)&&i.push(E(f(),e,a,y))}return i}function tn(e,t){const n=e.start,s=e.end,r=t.start,i=t.end,a=M(Ot,s,n),o=M(qt,i,r),c=M(ae,r,n),p=At(nn,a,o);if(!g(k(c,p),0))return[];const h=Ct(p);if(g(h,0))return[];const d=At(sn,c,o),b=k(d,p)/h,y=E(rn,n,a,b);if(e.type===m.RAY){const N=M(Jt,y,n);if(k(a,N)<-ft())return[]}if(t.type===m.RAY){const N=M(Jt,y,r);if(k(o,N)<-ft())return[]}return[et(y)]}function Ns({start:e,end:t,type:n},s){const r=M(Ot,s,e),i=M(qt,t,e),a=At(ae,i,r),o=Ct(a)/Ct(i),c=ft();if(o<c)switch(n){case m.LINE:return[et(s)];case m.RAY:return k(i,r)<-c?[]:[et(s)]}return[]}function oe(e,t,n,s){const[r,i]=e,[a,o]=n,c=a-r,p=o-i,h=c*c+p*p,d=Math.sqrt(h);if(d>t+s)return[];if(d<Math.abs(t-s))return[];if(g(d,0)&&g(t,s))return[];const b=(t*t-s*s+h)/(2*d),y=Math.sqrt(t*t-b*b),N=y*p/d,w=y*c/d,[S,X]=zn(yt,e,n,b/d);return g(N,w)?[Lt(S,X)]:[Lt(S+N,X-w),Lt(S-N,X+w)]}function St(e,t,{start:n,end:s,type:r}){return V(e.start,n[0],n[1],t),V(e.end,s[0],s[1],t),e.type=Es[r],e}function en(e,t){return g(e[2],t[2])}function g(e,t){return En(Math.abs(e-t),0,ft())}function Ls(e,t){return t.filter(n=>K(e,n))}function K(e,t){return Yn(e,t)}var _;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(_||(_={}));const Es={[_.PLANE]:m.LINE,[_.HALF_PLANE]:m.RAY},yt=P(),It=P(),Ot=f(),qt=f(),ae=f(),nn=f(),sn=f(),rn=f(),Jt=f(),ws=z(),le={start:f(),end:f(),type:m.LINE},xs={start:f(),end:f(),type:m.LINE};class j{intersect(t){return F(this,t)}closestPoints(t){return[this.closestTo(t)]}}class gt extends j{constructor(t){super(),this.point=t}equals(t){return this===t||I(t)&&$(this.point,t.point)}closestTo(){return at(this.point)}}class ce extends j{constructor(t,n,s){super(),this.start=t,this.end=n,this.lineLike={start:t,end:n,type:s}}equals(t){return this===t||B(t)&&this.lineLike.type===t.lineLike.type&&$(this.start,t.start)&&$(this.end,t.end)}closestTo(t){const n=R();return Qe(t,this.lineLike,n),n}}class on extends ce{constructor(t,n){super(t,n,m.LINE)}}class As extends ce{constructor(t,n){super(t,n,m.RAY)}}class an extends j{constructor(t){super(),this.constraints=t}equals(t){return this===t||Kt(t)&&xn(this.constraints,t.constraints,(n,s)=>n.equals(s))}closestTo(t){let n,s=1/0;for(const r of this.constraints){const i=r.closestTo(t),a=Ft(t,i);a<s&&(s=a,n=i)}return at(n??t)}closestPoints(t){return this.constraints.flatMap(n=>n===this?[]:n.closestPoints(t))}}class Ts extends j{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||H(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const n=R();return Ke(t,this.center,this.radius,n),n}}class ue extends j{constructor(t,n){super(),this.center=t,this.radius=n}equals(t){return this===t||G(t)&&$(this.center,t.center)&&this.radius===t.radius}closestTo(t){const n=R();return Ke(t,this.center,this.radius,n),n[2]=this.center[2],n}asCircle(){return new pe(at(this.center),this.radius,Q(0,0,1))}}class pe extends j{constructor(t,n,s,r=void 0){super(),this.center=t,this.radius=n,this.normal=s,this.slicePlane=r}equals(t){return this===t||J(t)&&$(this.center,t.center)&&$(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:n,radius:s}=this;Oe(this.getPlane(ks),t,Ut);const r=M(Ut,Ut,n),i=On(r);if(g(i,0))return at(t);const a=s/Math.sqrt(i),o=R();E(o,n,r,a);const{slicePlane:c}=this;return c&&!K(c,o)?de(c,this)?.closestTo(t)??at(t):o}getPlane(t=z()){return jt(this.center,this.normal,t)}}const Ut=f(),ks=z();class Ms extends j{constructor(t){super(),this.z=t}equals(t){return this===t||C(t)&&this.z===t.z}closestTo(t){return Q(t[0],t[1],this.z)}getPlane(t=z()){return V(we,0,0,this.z),jt(we,Tn,t)}}const we=f();class he extends j{constructor(t,n,s){super(),this.start=t,this.end=n,this.planeLike={start:t,end:n,type:s}}equals(t){return this===t||D(t)&&this.planeLike.type===t.planeLike.type&&$(this.start,t.start)&&$(this.end,t.end)}closestTo(t){const n=R();return Je(t,this.planeLike,n),n}closestEndTo(t){const{start:n,end:s}=this.planeLike;return Math.sign(ut(A(_s,s,n),A(Rs,t,n)))>0?this.end:this.start}getPlane(t=z()){const n=te(xe,this.end);return n[2]+=1,Jn(this.start,this.end,n,t)}getSlicePlane(t=z()){const{start:n,end:s,type:r}=this.planeLike;if(r===_.PLANE)return;const i=V(xe,n[0],n[1],0),a=V(Ae,s[0],s[1],0),o=ee(Ae,a,i);return jt(i,o,t),t}}const _s=P(),Rs=P(),xe=f(),Ae=f();class ti extends he{constructor(t,n){super(t,n,_.HALF_PLANE)}}class ei extends he{constructor(t,n){super(t,n,_.PLANE)}}class Ss extends j{constructor(t,n){super(),this.sphere=Qn(t,n)}equals(t){return this===t||Z(t)&&Xn(this.sphere,t.sphere)}closestTo(t){const n=R();return ts(this.sphere,t,n),n}get center(){return es(this.sphere)}get radius(){return this.sphere[3]}}class Ps extends j{constructor(t,n,s){super(),this.start=t,this.end=n,this.getZ=s,this.planeLike={start:t,end:n,type:_.PLANE}}equals(t){return this===t||Pt(t)&&$(this.start,t.start)&&$(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Bs(this,t)}addIfOnTheGround(t,n){for(const s of n){const r=this.getZ(s[0],s[1])??0;g(s[2],r)&&(s[2]=r,t.push(s))}}}class zs extends j{constructor(t,n,s){super(),this._x=t,this._y=n,this._z=s}equals(t){return this===t||er(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,n,s]){return Ge(this._x??t,this._y??n,this._z??s)}}class js extends j{constructor(t,n,s,r,i){super(),this._origin=t,this._spatialReference=n,this._distanceMeters=s,this._z=r,this._directionDegrees=i}equals(t){return this===t||tr(t)&&ge(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,n,s]){return _e(pt,t,n),ge(pt,this._origin)||this._applyDirectionAndDistance(pt),Ge(pt[0],pt[1],this._z??s)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)kt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Os(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:n}=ne(Is,this._origin,t,this._spatialReference);kt(t,this._origin,n??0,this._distanceMeters,this._spatialReference)}}}const pt=[0,0],Is=new se;function Os(e,t,n,s,r){let{azimuth:i,distance:a}=ne(qs,t,s,r);i??=0;let o=a*Math.cos((i-n)*Zn);o=Math.max(0,o),kt(e,t,n,o,r)}const qs=new se;function Bs(e,t){const n=R();return Je(t,e.planeLike,n),n[2]=e.getZ(n[0],n[1])??cn,n}function F(e,t){if(Kt(e)){const n=[];for(const s of e.constraints){const r=s.intersect(t);r&&n.push(r)}return fe(n)}if(Kt(t))return F(t,e);if(Pt(e))return Te(e,t);if(Pt(t))return Te(t,e);if(I(e)){const{point:n}=e;if(I(t))return $(n,t.point)?e:void 0;const s=t.closestTo(n);return Bn(s,n)?e:void 0}if(B(e)){if(I(t))return F(t,e);if(B(t))return q(tn(e.lineLike,t.lineLike));if(C(t))return Ds(e,t);if(D(t))return q(Ye(t.planeLike,e.lineLike));if(H(t))return q(Xe(e.lineLike,t.center,t.radius));if(J(t))return q(bs(e.lineLike,t));if(G(t))return Hs(e,t);if(Z(t))return Us(e,t)}else if(C(e)){if(I(t)||B(t))return F(t,e);if(C(t))return Vs(e,t);if(D(t))return Fs(e,t);if(H(t))return Cs(e,t);if(J(t))return Zs(e,t);if(G(t))return Gs(e,t);if(Z(t))return Ys(e,t)}else if(D(e)){if(I(t)||B(t)||C(t))return F(t,e);if(D(t))return Vt(We(e.planeLike,t.planeLike));if(H(t))return Vt(ie(e.planeLike,t.center,t.radius));if(J(t))return Js(e,t);if(G(t))return Ws(e,t);if(Z(t))return Ks(e,t)}else if(H(e)){if(I(t)||B(t)||C(t)||D(t))return F(t,e);if(H(t))return Vt(oe(e.center,e.radius,t.center,t.radius));if(J(t))return void 0;if(G(t))return Qs(e,t);if(Z(t))return void 0}else if(J(e)){if(I(t)||B(t)||C(t)||D(t)||H(t))return F(t,e);if(J(t))return void 0;if(G(t))return t.asCircle(),void 0;if(Z(t))return void 0}else if(G(e)){if(I(t)||B(t)||C(t)||D(t)||H(t)||J(t))return F(t,e);if(G(t))return Xs(t,e);if(Z(t))return void 0}else if(Z(e)){if(I(t)||B(t)||C(t)||D(t)||H(t)||G(t))return F(t,e);if(Z(t))return void 0}}const Ds=(()=>{const e=z();return(t,n)=>{const{start:s,end:r}=t;if(en(s,r)&&g(s[2],n.z))return t;const i=R();return Ie(n.getPlane(e),s,r,i)?new gt(i):void 0}})();function Hs({lineLike:e},{center:t,radius:n}){const s=t[2];return q(Xe(e,t,n).filter(r=>g(r[2],s)))}function Us({lineLike:e},{sphere:t}){return q(Kn(t,e.start,e.end))}const de=(()=>{const e=Gn(),t=f(),n=f();return(s,r,i)=>{const{normal:a,center:o,radius:c}=r;je(a,t,n);const p=qe(s),h=c*k(p,t),d=c*k(p,n);Fn(e,o[0],o[1],o[2],1);const b=Cn(s,e),y=Math.hypot(h,d),N=g(y,0);if(g(Zt(s,o),0)){if(N)return r;if(g(c,0))return!i||K(i,o)?new gt(at(o)):void 0;At(t,p,a),qn(t,t);const Dt=new Array,bt=et(o);E(bt,bt,t,c),i&&!K(i,bt)||Dt.push(bt);const Nt=et(o);return E(Nt,Nt,t,-c),i&&!K(i,Nt)||Dt.push(Nt),q(Dt)}if(N)return;const w=-b/y;if(Math.abs(w)>1||g(w,1))return;const S=Math.atan(h/d),X=An(w)-S,ye=Math.PI-X,vt=new Array,mt=f();E(mt,o,t,c*Math.cos(X)),E(mt,mt,n,c*Math.sin(X)),vt.push(mt);const $t=f();return E($t,o,t,c*Math.cos(ye)),E($t,$t,n,c*Math.sin(ye)),vt.push($t),q(i?Ls(i,vt):vt)}})();function Vs(e,t){return g(e.z,t.z)?e:void 0}function Fs({z:e},{planeLike:t}){const[n,s]=t.start,[r,i]=t.end,a=Q(n,s,e),o=Q(r,i,e);return t.type===_.PLANE?new on(a,o):new As(a,o)}function Cs(e,t){const[n,s]=t.center;return new ue(Q(n,s,e.z),t.radius)}function Gs(e,t){return g(t.center[2],e.z)?t:void 0}const Zs=(()=>{const e=z();return(t,n)=>de(t.getPlane(e),n,n.slicePlane)})();function Ys(e,{center:t,radius:n}){const s=Math.abs(t[2]-e.z);if(s>n&&!g(s,n))return;const r=Q(t[0],t[1],e.z),i=Math.sqrt(n**2-s**2);return g(i,0)?void 0:new ue(r,i)}const Ws=(()=>{const e=z();return(t,{center:n,radius:s})=>{const r=ie(t.planeLike,n,s),i=n[2];t.getSlicePlane(e);const a=new Array;for(const[o,c]of r){const p=[o,c,i];K(e,p)&&a.push(p)}return q(a)}})(),Js=(()=>{const e=z(),t=z();return(n,s)=>de(n.getPlane(e),s,n.getSlicePlane(t))})(),Ks=(()=>{const e=z();return(t,{center:n,radius:s})=>{const r=t.getPlane(e),i=Wn(r,n),a=Math.abs(i);if(a>s&&!g(a,s))return;const o=Math.sqrt(s**2-i**2);if(g(o,0)){const h=R();return Oe(r,n,h),new gt(h)}const c=R(),p=et(qe(r));return E(c,n,p,i),new pe(c,o,p,t.getSlicePlane())}})();function Qs(e,t){const n=Re(e.center,t.center);return g(n,0)&&g(e.radius,t.radius)?t:ln(oe(e.center,e.radius,t.center,t.radius),t.center[2])}function Xs(e,t){if(!en(e.center,t.center))return;const n=Re(e.center,t.center);return g(n,0)&&g(e.radius,t.radius)?e:ln(oe(e.center,e.radius,t.center,t.radius),e.center[2])}function Te(e,t){const{planeLike:n,getZ:s}=e,r=new Array;if(I(t))e.addIfOnTheGround(r,$s(n,t.point));else if(B(t))e.addIfOnTheGround(r,Ye(n,t.lineLike));else if(H(t))for(const[i,a]of ie(n,t.center,t.radius)){const o=s(i,a);o!=null&&r.push(wt(i,a,o))}else if(D(t)||Pt(t))for(const[i,a]of We(n,t.planeLike)){const o=s(i,a)??cn;r.push(wt(i,a,o))}return q(r)}function Vt(e){return fe(e.map(([t,n])=>{const s=Q(t,n,0),r=Q(t,n,1);return new on(s,r)}))}function q(e){return fe(e.map(t=>t?new gt(t):void 0))}function ln(e,t){return q(e.map(([n,s])=>[n,s,t]))}function fe(e){if(e.length!==0)return e.length===1?e[0]??void 0:new an(e.filter(wn))}function Kt(e){return e instanceof an}function I(e){return e instanceof gt}function B(e){return e instanceof ce}function C(e){return e instanceof Ms}function D(e){return e instanceof he}function H(e){return e instanceof Ts}function G(e){return e instanceof ue}function J(e){return e instanceof pe}function Z(e){return e instanceof Ss}function Pt(e){return e instanceof Ps}function tr(e){return e instanceof js}function er(e){return e instanceof zs}const cn=0;let Bt=class{constructor(t,n){this.isDraped=t,this.domain=n}},si=class un extends Bt{constructor(t,n,s,r,i=lt.ALL,a=!0,o=!0){super(r,i),this.type=t,this.lineStart=n,this.lineEnd=s,this.fadeLeft=a,this.fadeRight=o}equals(t){return t instanceof un&&this.type===t.type&&$(this.lineStart,t.lineStart)&&$(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return Se(this.lineStart,this.lineEnd)}};class pn extends Bt{constructor(t,n,s=lt.ALL){super(n,s),this.intersectionPoint=t}equals(t){return t instanceof pn&&$(this.intersectionPoint,t.intersectionPoint)}}let ri=class hn extends Bt{constructor(t,n,s,r=lt.ALL){super(s,r),this.lineStart=t,this.lineEnd=n}equals(t){return t instanceof hn&&$(this.lineStart,t.lineStart)&&$(this.lineEnd,t.lineEnd)}};class dn extends Bt{constructor(t,n,s,r,i=lt.ALL){super(r,i),this.previousVertex=t,this.centerVertex=n,this.nextVertex=s}equals(t){return t instanceof dn&&$(this.previousVertex,t.previousVertex)&&$(this.centerVertex,t.centerVertex)&&$(this.nextVertex,t.nextVertex)}}function nr(e){return e?.type==="graphic"}function ii(e){return e.find(nr)??null}export{os as $,si as A,Le as B,pn as C,ri as D,Gr as E,dn as F,Ts as G,hs as H,Kr as I,Qe as J,Dr as K,on as L,Rr as M,Ne as N,Wr as O,He as P,Ve as Q,ei as R,Ce as S,ls as T,$e as U,T as V,Xr as W,zs as X,_t as Y,fe as Z,Ms as _,Bt as a,js as a0,_r as a1,I as a2,Lr as a3,Sr as a4,Br as a5,qr as a6,Hr as a7,Or as b,R as c,Fr as d,Q as e,Ge as f,gt as g,Jr as h,lt as i,ti as j,Cr as k,zr as l,Nr as m,jr as n,Yr as o,Vr as p,as as q,m as r,Ir as s,Qr as t,fs as u,ii as v,Er as w,wr as x,Zr as y,Ps as z};
