const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-BmylKylf.js","./main-asQ7SttR.js","./preload-helper-ExcqyqRp.js","./main-DmIi68wH.css","./Cyclical-BtCZr1qb.js","./quantityUtils-B6HSL2rj.js","./elevationInfoUtils-Cb-uJoCx.js","./ElevationInfo-C-a3Y-El.js","./lengthUtils-GoFDlaqZ.js","./hitTestSelectUtils-CCoI2aa5.js","./vec2-maR1OrZI.js","./common-DQOJ18NT.js","./vec2f64-DohEyf3f.js","./vec32-BzCy6cr7.js","./projectVectorToVector-VmpAJgQc.js","./projectBuffer-Cx7kBt8y.js","./projectPointToVector-CbyHCjYt.js","./projection-G6EI4E6A.js","./geodesicUtils-DUEAC0ng.js","./TimeExtent-tqAWy-Dv.js","./Query-D7n22axe.js","./Field-BLAoQZ_0.js","./fieldType-DNTeE9NS.js","./MapView-CdXdWR5g.js","./CollectionFlattener-C2HA7kkf.js","./workers-BJlMhhTk.js","./Queue-B7j4i-p3.js","./intl-D5myeBIL.js","./TileInfo-DFofX128.js","./TileKey-DZd6gJy7.js","./themeUtils-D3elnwh6.js","./uuid-Cl5lrJ4c.js","./UpdatingHandles-gi6cfx1S.js","./signal-DOJnbrFR.js","./Map-BQqiVqnv.js","./Basemap-CwXISLRi.js","./loadAll-9Cvy7tjC.js","./PortalItem-Nq3zGykG.js","./writeUtils-BnGVzhQw.js","./mat4f32-DcsiF_Rp.js","./mat4-BjwS19gr.js","./TablesMixin-I_JAQrAJ.js","./Layer-Bx8UpsMJ.js","./GraphicsCollection-Cks0A0Ve.js","./HeightModelInfo-B7gpIaa-.js","./timeZoneUtils-CfTu0PZq.js","./ReactiveMap-CzqLFZz5.js","./HighlightDefaults-D0LIiYIH.js","./ViewingMode-HRfKv6NR.js","./Tile-3ZPXJ-cN.js","./TileKey-tjz0o95w.js","./quickselect-QQC62dOK.js","./normalizeUtils-CQip1v0x.js","./normalizeUtilsCommon-B9hLdSv-.js","./utils-CO4HUuqg.js","./utils-CLKe2jGG.js","./mat3-CruJiiUv.js","./vec2f32-BbH2jxlN.js","./Scheduler-CssyMp54.js","./unitBezier-B1N-tmtC.js","./definitions-CPtb4TQS.js","./enums-Dk3osxpS.js","./Texture-DGW9aO8e.js","./getDataTypeBytes-DflDeYgv.js","./imageUtils-C_fUUBhQ.js","./capabilities-Du2wdNlQ.js","./Version-CCEYPWOm.js","./ColorBackground-CkNanFjv.js","./vec42-CKs01hkn.js","./vec4f64-o2zAXfmz.js","./plane-RIh6ulrU.js","./mat3f64-q3fE-ZOt.js","./mat4f64-Dk4dwAN8.js","./quatf64-aQ5IuZRd.js","./sphere-DET7VZHS.js","./geodesicLengthMeasurementUtils-DWI1XB7C.js","./geometryEngine-CVDxMhql.js","./geometryEngineBase-8g0RzW7z.js","./_commonjsHelpers-DCkdB7M8.js","./hydrated-BabTFx4N.js","./GraphicsLayer-CZo360Kr.js","./BlendLayer-DQc1-4op.js","./layerContainerType-C5CzMsLd.js","./jsonUtils-id0_mGIh.js","./parser-Bpna5qKq.js","./ScaleRangeLayer-59UbR5Hw.js","./Stop-pORK5fNb.js","./networkEnums-BhJmnK1i.js","./GridSnappingEngine-T8_aCVPP.js","./scaleUtils-C76ebMnv.js","./gridUtils-Bczhz3pd.js","./FeatureSnappingEngine-BwFCW9j0.js","./FeatureFilter-BMGPBFnL.js","./floorFilterUtils-DKzVzLpH.js","./layerViewUtils-BMRueLxd.js","./editingTools-CO3LJ-R9.js","./SnappingVisualizer2D-Cp391arL.js","./enums-CD-fX3vU.js","./SnappingContext-BsSJ5w8n.js","./PointSnappingHint-dI5J2D4I.js","./automaticLengthMeasurementUtils-BE4jpUja.js","./MeshTransform-D2rUQYB0.js","./quat-sVWee8SJ.js","./axisAngleDegrees-B02ZyS5J.js","./meshVertexSpaceUtils-DhVTAb0c.js","./MeshLocalVertexSpace-Dk8C03Rj.js","./memoize-DsJmrG76.js","./unitFormatUtils-Dsg7E7mQ.js","./ByteSizeUnit-BsxeN7wM.js","./spatialReferenceEllipsoidUtils-Bq6Bg_Dl.js","./earcut-Lltz9D9k.js","./triangle-C4BV5fZD.js","./lineSegment-BNFfqofa.js","./editPlaneUtils-DBan0oZy.js","./ReactiveSet-CIqrwsT8.js","./defaultCIMValues-BZQdnlbk.js","./hydratedFeatures-Biiv0j5A.js","./boundedPlane-Zz4nqCih.js","./cimSymbolUtils-CnrAdmVz.js","./utils-Piv4JJl1.js","./GraphicManipulator-Cyo23Lhi.js","./drapedUtils-BHJ2Ckw0.js","./colorUtils-unU6Ikhg.js","./drawUtils-CHsksDu5.js","./ImageMaterial.glsl-CW6AKEog.js","./Octree-DqQOkamU.js","./InterleavedLayout-CkdA0S5-.js","./BufferView-CVke7kmB.js","./types-D0PSWh4d.js","./RibbonLine.glsl-CKgGtjSy.js","./orientedBoundingBox-BH0jY8bO.js","./computeTranslationToOriginAndRotation-njxIHGyK.js","./Geometry-BYkWVgnK.js","./renderState-z3Gwc6C8.js","./basicInterfaces-CZwQPxTp.js","./ShaderOutput-DnYY5J1_.js","./BindType-BBwFZqyN.js","./glsl-BH37Aalp.js","./VertexAttribute-Cq4MnHjR.js","./requestImageUtils-DZzdNdYu.js","./TextureFormat-1mYWTFa-.js","./Indices-Vgv1m-UC.js","./dehydratedFeatureUtils-lt-r3GBb.js","./doublePrecisionUtils-B0owpBza.js","./vec3f32-nZdmKIgz.js","./floatRGBA-Dmu5dBAP.js","./ShaderBuilder-DGYV3P6E.js","./DefaultLayouts-CZXXQCA4.js","./triangulationUtils-Auu_WNR3.js","./deduplicate-BeN_03We.js","./HUDMaterial-C8F_Ur2i.js","./VertexArrayObject-h88j0new.js","./memoryEstimations-COo-dz1M.js","./VertexElementDescriptor-BOD-G50G.js","./NestedMap-CImDozOA.js","./glUtil-BuljoYCz.js","./IntersectorInterfaces-BgX4KEwK.js","./SelectedVertexTooltipInfo-BNFoikOn.js","./TranslateTooltipInfo-D3n4Uv5T.js","./utils-CwuU6R9D.js","./LRUCache-D1fsA-w6.js","./MemCache-DE3T9NBz.js","./persistable-BSv7YU8_.js","./MD5-C9MwAd2G.js","./multiOriginJSONSupportUtils-C0wm8_Yw.js","./resourceExtension-De9Gpivt.js","./ExtentScaleTooltipInfo-CiMUu77-.js","./LineCallout.glsl-Bcjxh1wy.js","./visualVariableUtils-BKDBW5cJ.js","./dehydratedFeatures-BDJfUoGt.js","./UniqueValueRenderer-CNrg2TdL.js","./commonProperties-BCStlC_N.js","./colorRamps-Dk7bz912.js","./ColorStop-DwDT8ygX.js","./RendererLegendOptions-Bo7pHTmv.js","./styleUtils-seZ9SQXz.js","./LodResources-C5IwlsUX.js","./edgeUtils-BrdbWIHu.js","./NormalAttribute.glsl-C7KdSkvm.js","./DefaultMaterial-IOvhxCYs.js","./OptimizedFeature-CYyXKDHx.js","./optimizedFeatureQueryEngineAdapter-DVjgb7HE.js","./featureConversionUtils-pNtCHoNi.js","./OptimizedFeatureSet-Blu9Ckm7.js","./webStyleAcceptedFormats-CG7ZQ6BV.js","./PooledRBush-CpnlERjP.js","./popupUtils-D99tjxun.js","./geometryServiceUtils-B-eVgLWZ.js","./project-C9nI3Yai.js","./LayerView-DQSUDZhf.js","./Container-CkIb2PRY.js","./GraphicMover-BdmA0XuA.js","./featureUtils-BcTX_nBt.js","./utils-B34IjRvs.js","./Box-BQ6ZO7Zv.js","./settings-DG8IlWY-.js","./Reshape-qYp-jaGh.js"])))=>i.map(i=>d[i]);
import{B as h,D as c,N as V,aN as re,V as $,n as Le,ds as Ke,cL as Ze,aK as se,fA as We,fO as ze,c1 as ve,aO as U,dq as J,b0 as Xe,aJ as Qe,X as ne,g6 as Je,eX as et,dM as fe,dN as tt,dK as it,jS as ot,jT as at,aQ as be,U as N,aP as rt,gu as pe,u as Ee,bj as st,jU as nt,gp as pt,jV as R,eb as we,s as lt,fJ as Se,bD as ht,hf as Y,eS as Te,di as ct,e8 as dt}from"./main-asQ7SttR.js";import{h as xe}from"./UpdatingHandles-gi6cfx1S.js";import Ue from"./GraphicsLayer-CZo360Kr.js";import{a as ut,j as yt,T as gt,w as vt}from"./Stop-pORK5fNb.js";import{_ as G}from"./preload-helper-ExcqyqRp.js";import{O as ye,Q as mt,L as _t,k as ft,K as bt}from"./projection-G6EI4E6A.js";import{v as Ve,l as Et,f as wt,x as St,j as ge}from"./elevationInfoUtils-Cb-uJoCx.js";import{_ as w,n as Oe}from"./MapView-CdXdWR5g.js";import{p as ie,i as C,z as Tt,A,B as k,L as Ot,g as Gt,C as Mt,R as $e,n as Ne,D as Pt,F as Fe,G as Rt,s as Ge,H as B,b as le,K as Me,E as Ct,u as At,l as je,O as kt,v as Dt,m as b,P as It,Q as Ht,S as Lt}from"./hitTestSelectUtils-CCoI2aa5.js";import{c as xt,u as Ut,H as K,I as Vt,s as $t}from"./vec32-BzCy6cr7.js";import{m as Nt}from"./vec2-maR1OrZI.js";import{e as Ft}from"./projectVectorToVector-VmpAJgQc.js";function Pe(e){switch(e){case _.SUPPORTED:break;case _.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case _.GEOMETRY_MISSING:return"no geometry";case _.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case _.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case _.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var _;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(_||(_={}));function jt(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return _.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return _.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return _.GEOMETRY_TYPE_UNSUPPORTED}const i=e.elevationInfo;return Ve(i)?_.ELEVATION_MODE_UNSUPPORTED:_.SUPPORTED}function Yt(e){return qt(e).result}function qt(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:_.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:_.GEOMETRY_MISSING};if(Ve(e.elevationInfo))return{result:_.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,i=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:_.SUPPORTED,geometry:i}:{result:_.GEOMETRY_TYPE_UNSUPPORTED}}function Bt(e){if(e.layer?.type!=="graphics")return _.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return _.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return _.SUPPORTED;default:return _.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(i=>i.type==="object")?_.SYMBOL_TYPE_UNSUPPORTED:Et(e)!=="on-the-ground"&&wt(e)?_.ELEVATION_MODE_UNSUPPORTED:_.SUPPORTED}function Re(e,t,i){if(!t||!e?.map)return;const{map:o}=e,a=o.layers.find(r=>r===t);a||o.add(t,i),a&&i!=null&&o.layers.reorder(a,i)}function Pi(e,t){const i=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(o=>{const a=o.layer;return a===i||"sublayers"in a&&a.sublayers!=null&&a.sublayers.includes(i)})}let L=class extends re{constructor(t){super(t),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new $}};h([c({constructOnly:!0})],L.prototype,"layer",void 0),h([c()],L.prototype,"enabled",void 0),h([c()],L.prototype,"updating",void 0),h([c()],L.prototype,"availability",void 0),h([c()],L.prototype,"sublayerSources",void 0),L=h([V("esri.views.interactive.snapping.FeatureSnappingLayerSource")],L);const Ye=L;let S=class extends re{constructor(t){super(t),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new $,this.distance=ie.distance,this.touchSensitivityMultiplier=ie.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const t=this.featureSources;t.some(Ce)&&Le.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const i=t.filter(Zt),o=this._get("_effectiveFeatureSources")?.filter(Ce)??new $;for(const l of i){const n=o.find(d=>d.layer===l.layer.parent);if(n)n.sublayerSources.includes(l)||n.sublayerSources.add(l);else if(l.layer.parent){const d=new Ye({layer:l.layer.parent});d.sublayerSources.add(l),o.add(d)}}for(const l of o){const n=l.sublayerSources.filter(d=>!i.includes(d));l.sublayerSources.removeMany(n)}o.removeMany(o.filter(l=>l.sublayerSources.length===0));const a=t.filter(Kt),r=this._get("_effectiveFeatureSources")??new $,{added:p,removed:s}=Ke(r.toArray(),[...a,...o]);return r.removeMany(s),r.addMany(p),r}};h([c()],S.prototype,"enabled",void 0),h([c()],S.prototype,"enabledToggled",void 0),h([c()],S.prototype,"forceDisabled",void 0),h([c()],S.prototype,"selfEnabled",void 0),h([c()],S.prototype,"featureEnabled",void 0),h([c()],S.prototype,"gridEnabled",void 0),h([c()],S.prototype,"attributeRulesEnabled",void 0),h([c({type:$.ofType(Ye)})],S.prototype,"featureSources",void 0),h([c()],S.prototype,"distance",void 0),h([c()],S.prototype,"touchSensitivityMultiplier",void 0),h([c({readOnly:!0})],S.prototype,"effectiveEnabled",null),h([c({readOnly:!0})],S.prototype,"effectiveGridEnabled",null),h([c({readOnly:!0})],S.prototype,"effectiveSelfEnabled",null),h([c({readOnly:!0})],S.prototype,"effectiveFeatureEnabled",null),h([c({readOnly:!0})],S.prototype,"_effectiveFeatureSources",null),S=h([V("esri.views.interactive.snapping.SnappingOptions")],S);const me=S;function Ce(e){return e.layer.type==="subtype-group"}function Kt(e){return e.layer.type!=="subtype-group"}function Zt(e){return e.layer.type==="subtype-sublayer"}class j{constructor(t,i,o,a){this.targetPoint=t,this.constraint=i,this.isDraped=o,this.domain=a}}let qe=class extends j{constructor({targetPoint:t,objectId:i,constraint:o,isDraped:a}){super(t,o,a,C.FEATURE),this.objectId=i}},Wt=class extends qe{constructor(t){super({...t,isDraped:!0,constraint:new Tt(t.edgeStart,t.edgeEnd,t.getGroundElevation)})}get hints(){return[new A(k.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},zt=class extends qe{constructor(t){super({...t,constraint:new Ot(t.edgeStart,t.edgeEnd)})}get hints(){return[new A(k.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ee=class extends j{constructor(t,i,o,a){super(t,new Gt(t),a,C.ALL),this.first=i,this.second=o}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Mt(this.targetPoint,this.isDraped,this.domain)]}};class Xt extends j{constructor({lineStart:t,lineEnd:i,targetPoint:o,isDraped:a}){super(o,new $e(t,i),a,C.SELF),this._referenceLineHint=new A(k.REFERENCE_EXTENSION,t,i,a,this.domain)}get hints(){return[this._referenceLineHint,new A(k.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}let Qt=class extends j{constructor({referenceLine:t,lineStart:i,targetPoint:o,isDraped:a}){const r=Ze(i),{left:p,right:s}=t;xt(r,Ut(r,r,s),p),super(o,new $e(i,Ne(r)),a,C.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new A(k.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Pt(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(t=>new A(k.REFERENCE,t.edge.left,t.edge.right,this.isDraped,this.domain,t.fadeLeft,t.fadeRight))]}addReferenceLine(t){const i={edge:t,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(o=>{K(t.right,o.edge.left)&&(o.fadeLeft=!1,i.fadeRight=!1),K(t.right,o.edge.right)&&(o.fadeRight=!1,i.fadeRight=!1),K(t.left,o.edge.right)&&(o.fadeRight=!1,i.fadeLeft=!1),K(t.left,o.edge.left)&&(o.fadeLeft=!1,i.fadeLeft=!1)}),this._referenceLines.push(i)}},Jt=class extends j{constructor({targetPoint:t,constraint:i,previousVertex:o,otherVertex:a,otherVertexType:r,isDraped:p,selfSnappingType:s,objectId:l,domain:n}){super(t,i,p,n??C.SELF),this.previousVertex=o,this.otherVertex=a,this.otherVertexType=r,this.selfSnappingType=s??ae.None,this.objectId=l??null}get hints(){const t=this.previousVertex,i=this.otherVertexType===oe.CENTER?this.otherVertex:this.targetPoint,o=this.otherVertexType===oe.CENTER?this.targetPoint:this.otherVertex;return[new A(k.TARGET,i,o,this.isDraped,this.domain),new A(k.REFERENCE,t,i,this.isDraped,this.domain),new Fe(this.previousVertex,i,o,this.isDraped,this.domain)]}};var oe,ae;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(oe||(oe={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(ae||(ae={}));let ei=class extends j{constructor({targetPoint:t,point1:i,point2:o,isDraped:a}){super(t,new Rt(Ne(Vt(se(),i,o,.5)),.5*Nt(Ge(i),Ge(o))),a,C.SELF),this._p1=i,this._p2=o}get hints(){return[new A(k.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new A(k.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Fe(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function ti(e,t,i,o,a=se()){const r=$t(ii,e);return r[2]=St(o,r,t,i)||0,o.renderCoordsHelper.toRenderCoords(r,t,a),a}const ii=se();function oi(e,t,i,o){return o.type==="2d"?(Z.x=e[0],Z.y=e[1],Z.spatialReference=t,o.toScreen(Z)):(ti(e,t,i,o,Ae),o.state.camera.projectToScreen(Ae,he),We(he[0],he[1]))}const Z=Ft(0,0,0,null),Ae=se(),he=ze();let P=class extends ve.EventedMixin(re){constructor(e){super(e),this.options=new me,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=D.MAIN}initialize(){this.addHandles([U(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:o,effectiveGridEnabled:a}=this.options;return{selfEnabled:i,featureEnabled:o,gridEnabled:this.view.type==="2d"&&a,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=Xe(i=>this._updateEngines(e,t,i))},J),U(()=>this.options,e=>{for(const t of this._engines)t.options=e},Qe)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const o=this._engineCache,a=await Promise.allSettled([e.featureEnabled&&!o.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!o.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!o.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const r of a)r.status==="fulfilled"&&r.value?.engine.destroy();else{for(const r of a)r.status==="fulfilled"&&r.value&&o.set(r.value.type,r.value.engine);this._engines=Array.from(o.values())}}async _createSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await G(()=>import("./SelfSnappingEngine-BmylKylf.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87]),import.meta.url);return ne(e),{type:"self",engine:new t({view:this.view,options:this.options})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:i}=await G(()=>import("./GridSnappingEngine-T8_aCVPP.js"),__vite__mapDeps([88,1,2,3,13,11,17,15,52,53,54,55,89,90,18,9,4,5,10,12,14,16,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,6,7,8,80,81,82,83,84,85,86,87]),import.meta.url);return ne(e),{type:"grid",engine:new i({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await G(()=>import("./FeatureSnappingEngine-BwFCW9j0.js"),__vite__mapDeps([91,2,1,3,10,11,13,32,6,7,8,9,4,5,12,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,92,93,94,80,81,82,83,84,85,86,87]),import.meta.url);ne(e);const{view:i,options:o}=this,{spatialReference:a}=i;return{type:"feature",engine:new t({view:i,options:o,spatialReference:a})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return si(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const o=this._currentMainCandidate;if(o==null)return t;const a=this._selectUpdateInput(e);if(a==null)return t;const{spatialReference:r}=i,p=ye(a,r);if(p==null)return t;const{view:s}=this,{elevationInfo:l,visualizer:n}=i,d=[],g=B(p,s,l),m=o.constraint.closestTo(g);if(!this._arePointsWithinScreenThreshold(g,m,i)||!de(o,i.drawConstraints))return this._resetSnappingState(),t;o.targetPoint=le(m),d.push(...o.hints);for(const y of this._currentOtherActiveCandidates)de(y,i.drawConstraints)&&(y.targetPoint=le(m),d.push(...y.hints));return n!=null&&this.addHandles(n.draw(d,{spatialReference:r,elevationInfo:ni(i),view:s,selfSnappingZ:i.selfSnappingZ}),ce),Me(m,s,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case D.MAIN:return e;case D.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=D.MAIN}_removeVisualization(){this.removeHandles(ce)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:o}=this,{elevationInfo:a}=t,r=B(e,o,a),p=await this._fetchCandidates(r,C.ALL,t,i);return this._createSnapResult(r,D.MAIN,p,o,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:o}){const{view:a}=this,{coordinateHelper:r,elevationInfo:p,spatialReference:s}=i;await mt(t.spatialReference,s);const l=ye(t,s),n=B(l,a,p),d=await this._fetchCandidates(n,C.FEATURE,i,o);if(d.length>0){const y=await this._fetchCandidates(n,C.SELF,i,o);return this._createSnapResult(n,D.SCENE,[...d,...y],a,l,i,o)}const g=B(e,a,p),m=await this._fetchCandidates(g,C.SELF,i,o);return this._createSnapResult(g,D.MAIN,m,a,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},i,o)}async _fetchCandidates(e,t,i,o){return(await Promise.all(this._engines.map(a=>a.fetchCandidates(e,t,i,o)))).flat()}_createSnapResult(e,t,i,o,a,r,p){return{get valid(){return!Je(p)},apply:()=>{const{spatialReference:s}=r,{snappedPoint:l,hints:n}=this._processCandidates(e,t,i,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(n,{spatialReference:s,elevationInfo:ge,view:o,selfSnappingZ:r.selfSnappingZ}),ce),Me(l,o,a,r)}}}_processCandidates(e,t,i,o){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Ct(e,i);const a=this._currentMainCandidate;if(a!=null){const r=ri(a,i);if(r>=0){if(!(i[r]instanceof ee))return this._intersectWithOtherCandidates(r,i,e,t,o);if(this._arePointsWithinScreenThreshold(e,a.targetPoint,o))return this._updateSnappingCandidate(a,t,i,o)}}return this._intersectWithOtherCandidates(0,i,e,t,o)}_intersectWithOtherCandidates(e,t,i,o,a){const{coordinateHelper:r}=a,p=t[e],s=[];for(let l=0;l<t.length;++l){if(l===e)continue;const n=t[l],d=p.constraint.intersect(n.constraint);if(d)for(const g of d.closestPoints(p.targetPoint))s.push([new ee(le(g),p,n,n.isDraped),this._squaredScreenDistance(i,g,r)])}return s.length>0&&(s.sort((l,n)=>l[1]-n[1]),s[0][1]<this._squaredPointProximityThreshold(a.pointer))?this._updateSnappingCandidate(s[0][0],o,t,a):de(p,a.drawConstraints)?this._updateSnappingCandidate(p,o,t,a):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,o){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const a=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const p of i){if(e instanceof ee){if(p.constraint.equals(e.first.constraint)||p.constraint.equals(e.second.constraint))continue}else if(p.constraint.equals(e.constraint))continue;const s=p.constraint.closestTo(a);this._squaredScreenDistance(s,a,o.coordinateHelper)<ai()&&(p.targetPoint=a,this._currentOtherActiveCandidates.push(p),r.push(...p.hints))}return{snappedPoint:a,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return At(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return oi(e,t.spatialReference,ge,this.view)}get test(){}};var D;h([c({constructOnly:!0})],P.prototype,"view",void 0),h([c()],P.prototype,"options",void 0),h([c({readOnly:!0})],P.prototype,"updating",null),h([c()],P.prototype,"_loadTask",void 0),h([c()],P.prototype,"_engines",void 0),h([c()],P.prototype,"_squaredMouseProximityThreshold",null),h([c()],P.prototype,"_squaredTouchProximityThreshold",null),P=h([V("esri.views.interactive.snapping.SnappingManager")],P),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(D||(D={}));const ce="visualization-handle";function ai(){return ie.satisfiesConstraintScreenThreshold*ie.satisfiesConstraintScreenThreshold}function de(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Wt||e instanceof zt||e instanceof Xt||e instanceof Qt||e instanceof ei)&&(!(e instanceof Jt)||t.direction==null&&e.selfSnappingType===ae.LastVertex)}function ri(e,t){return e instanceof ee?ue(t,e.first)>=0&&ue(t,e.second)>=0?0:-1:ue(t,e)}function ue(e,t){let i=-1;for(let o=0;o<e.length;++o)if(t.constraint.equals(e[o].constraint)){i=o;break}return i}function si(e){return e.scenePoint!=null}function ni({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?ge:t}let T=class extends ve.EventedAccessor{constructor(t){super(t),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:et(this.activeComponent)}return null}addToHistory(t){this.history.redo=[],this.history.undo.push(t)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const t=this.activeComponent;t&&(t.type!=="box"&&t.type!=="reshape"&&t.type!=="graphic-mover"||t.refresh())}set undo(t){this._set("undo",()=>{this.canUndo()&&t()})}set redo(t){this._set("redo",()=>{this.canRedo()&&t()})}};h([c()],T.prototype,"activeComponent",void 0),h([c()],T.prototype,"cancelled",void 0),h([c()],T.prototype,"history",void 0),h([c()],T.prototype,"tool",null),h([c()],T.prototype,"type",void 0),h([c()],T.prototype,"canUndo",null),h([c()],T.prototype,"canRedo",null),h([c()],T.prototype,"onEnd",void 0),h([c()],T.prototype,"undo",null),h([c()],T.prototype,"redo",null),h([c()],T.prototype,"toggleTool",void 0),h([c()],T.prototype,"addToSelection",void 0),h([c()],T.prototype,"removeFromSelection",void 0),T=h([V("esri.widgets.Sketch.support.OperationHandle")],T);let te=class extends T{};h([c()],te.prototype,"activeComponent",void 0),te=h([V("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],te);let I=class extends T{};h([c()],I.prototype,"activeComponent",void 0),I=h([V("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],I);function pi(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function li(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var ke;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(ke||(ke={}));const De={defaultZ:0},q={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let v=class extends ve.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new xe,this._internalGraphicsLayer=new Ue({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new fe({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new tt({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new it({color:[130,130,130,1],width:2}),this.meshSymbol=new ot({symbolLayers:new $([new at])}),this.updateGraphics=new $,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new fe({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new je,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=De,this.defaultUpdateOptions=q,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new me}initialize(){this.addHandles([be(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),be(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),U(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},J),U(()=>this.view,e=>{this._defaultSnappingManager=N(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new P({view:e,options:this.snappingOptions})),e.type==="2d"?G(()=>import("./editingTools-CO3LJ-R9.js"),__vite__mapDeps([95,1,2,3,96,10,11,12,97,9,4,5,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,6,7,8,98,99,100,101,102,103,104,105,106,107,108,109,75,76,77,78,79,110,111,112,113,80,81,82,83,84,85,114,115,116,117,118,119,120,121,122,123]),import.meta.url):e.type==="3d"&&(G(()=>import("./ImageMaterial.glsl-CW6AKEog.js").then(t=>t.e),__vite__mapDeps([124,1,2,3,122,68,11,69,13,6,7,8,27,100,5,101,40,72,102,71,73,103,104,105,9,4,10,12,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29,30,31,32,33,34,35,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,70,74,106,107,108,109,75,76,77,78,79,125,126,127,128,112,129,130,131,132,133,134,135,136,137,138,117,139,140,141,111,142,143,116,144,145,146,147,148,110,149,150,151,152,153,154,155,98,99,113,80,81,82,83,84,85,114,115,97,156,157,158,159,118,119,160,161,162,163,164,165,166,120,121]),import.meta.url),G(()=>import("./LineCallout.glsl-Bcjxh1wy.js").then(t=>t.G),__vite__mapDeps([167,1,2,3,23,4,24,25,26,27,17,15,28,29,30,31,32,33,34,35,36,37,38,39,40,11,41,42,19,43,44,45,46,20,21,22,47,48,10,12,49,50,51,52,53,54,55,56,57,58,13,59,60,61,62,63,64,65,66,67,16,14,6,7,8,129,69,130,71,72,102,73,68,109,131,70,132,133,134,135,136,137,138,117,74,112,139,140,126,127,128,141,111,142,143,104,105,116,144,125,145,146,115,97,168,161,169,152,170,171,172,173,174,175,176,156,177,178,179,180,181,182,183,184,185,186,94,187,188,189,190,84]),import.meta.url)))},J),U(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),kt(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=N(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...De,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...q,...e,reshapeOptions:{...q.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...q.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=N(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new P({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:o,map:a}=t;o&&(t.cursor=null),a?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles(rt(()=>e.ready,o=>{this.removeHandles(this._viewHandlesKey),o&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},J),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=pe(this._moduleLoaderAbortController),this._viewReadyAbortController=pe(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:i,layer:o}=this,a=t.toArray();o.removeMany(a),this.cancel(),this._emitDeleteEvent({graphics:a,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:o}=this;if(!i||this.state==="disabled")throw o||this._logMissingLayer(),Ee();if(i.activeTool!=null&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Re(i,this._internalGraphicsLayer);const a=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(a==null||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);const r=()=>{if(a===this._operationHandle){const p=this.createGraphic,s=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),a.cancelled||p==null||o.add(p),this._sketchContinuationFlag=!1,this.emit("create",{graphic:p,state:s?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),s||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(Te(this.create(e,t)))}else l==="update"&&p&&this._updatingHandles.addPromise(Te(this.update([p])))}};a.on("complete",r),this._operationHandle=a,i.ready&&i.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:o,state:a}=this;if(!o||a==="disabled")throw i||this._logMissingLayer(),Ee();o.activeTool!=null&&(o.activeTool=null);const r=Array.isArray(e)?e:[e];if(e==null||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(s=>s.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):s.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const p=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||p==null||E(p)||(Re(o,this._internalGraphicsLayer),this._setUpdateOperationHandle(p,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:p.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const i of e)i.geometry==null||i.geometry.type==="mesh"||st(i.geometry.spatialReference,t.spatialReference)||(_t(i.geometry.spatialReference,t.spatialReference)||ft()||await bt(),i.geometry=ye(i.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const a=[];t.map.allLayers.forEach(p=>{p.type!=="vector-tile"&&p.type!=="imagery"||a.push(p)});const r=await t.hitTest(e,{exclude:a});return Dt(r.results)}const i=[t.map.ground];t.map.allLayers.forEach(a=>{nt(a.type)&&i.push(a)});const o=await t.hitTest(e,{exclude:i});if(o.results.length>0){const a=o.results[0];if(a!=null&&a.type==="graphic"&&a.graphic&&(!o.ground.mapPoint||t.map.ground.opacity<1||o.ground.distance-(a.distance??0)>-Math.min(3*o.ground.distance,t.viewingMode==="global"?pt(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return a}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},w.WIDGET)]}async _handleImmediateClick(e){const t=await e.async(()=>this._getFirstHit(Oe(e)));let i=null;if(t!=null){const o=t.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(e.stopPropagation(),i=o):this.view?.type!=="2d"||this._isComponentGraphic(o)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const o={hasZ:i.type==="3d",...this.defaultCreateOptions,...t},a=await this._setupDrawGraphicTool(e,i,o);return a==null?null:(i.tools.add(a),i.activeTool=a,this._setupCreateOperationHandle(a))}async _setupDrawGraphicTool(e,t,i){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:o,defaultZ:a,hasZ:r,geometryToPlace:p,graphicProperties:s,mode:l,preserveAspectRatio:n}=i,d=pi(l,e),g=li(e),m=i?.optionsPerTool?.has(e)?i.optionsPerTool.get(e):{},y=m?.preserveAspectRatio??n??e!=="rectangle",u={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:o,defaultZ:a,forceUniformSize:y,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:p,geometryType:g,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t,...m};return t.type==="2d"?this._makeDrawGraphicTool2D(u):this._makeDrawGraphicTool3D(u)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(G(()=>import("./editingTools-CO3LJ-R9.js"),__vite__mapDeps([95,1,2,3,96,10,11,12,97,9,4,5,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,6,7,8,98,99,100,101,102,103,104,105,106,107,108,109,75,76,77,78,79,110,111,112,113,80,81,82,83,84,85,114,115,116,117,118,119,120,121,122,123]),import.meta.url));return E(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:ci(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(G(()=>import("./ImageMaterial.glsl-CW6AKEog.js").then(o=>o.e),__vite__mapDeps([124,1,2,3,122,68,11,69,13,6,7,8,27,100,5,101,40,72,102,71,73,103,104,105,9,4,10,12,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29,30,31,32,33,34,35,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,70,74,106,107,108,109,75,76,77,78,79,125,126,127,128,112,129,130,131,132,133,134,135,136,137,138,117,139,140,141,111,142,143,116,144,145,146,147,148,110,149,150,151,152,153,154,155,98,99,113,80,81,82,83,84,85,114,115,97,156,157,158,159,118,119,160,161,162,163,164,165,166,120,121]),import.meta.url));if(E(t)||this.destroyed)return null;const{elevationInfo:i}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:i,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const o=e.forceUniformSize,a=e.centered,r=[t.on("key-down",s=>{if(s.key===b.pan)s.stopPropagation(),s.repeat||(e.enabled=!1);else if(s.key===b.complete)s.stopPropagation(),e.completeCreateOperation();else if(s.key!==b.vertexAdd||s.repeat)s.key===b.undo?(s.stopPropagation(),p.undo()):s.key===b.redo?(s.stopPropagation(),p.redo()):s.key!==b.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||s.repeat?s.key===b.center&&(s.repeat||(e.centered=!a,s.stopPropagation())):(e.forceUniformSize=!o,s.stopPropagation());else{const l=e.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(s.stopPropagation(),e.drawOperation.commitStagedVertex())}},w.WIDGET),t.on("key-up",s=>{s.key===b.pan?e.enabled=!0:s.key!==b.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?s.key===b.center&&(e.centered=a,s.stopPropagation()):(e.forceUniformSize=o,s.stopPropagation())},w.WIDGET),e.on("vertex-add",s=>{switch(i=i==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",s=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",s=>{switch(s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",s=>{this._set("createGraphic",s.graphic),i="complete",s.aborted?p&&p.cancel():p&&p.complete()}),U(()=>this._getGraphicSymbolFromTool(e.geometryType),s=>{e.graphicSymbol=s})],p=new te({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{R(r),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:i,view:o}=this;if(!o)return this._logMissingView(),null;const a={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let r=a.tool??q.tool;for(const p of e)i.remove(p),i.add(p);if(o.type==="3d"){if(e.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(e,a,o,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],a,o);case"transform":return this._setupGraphicTransform3DOperation(e,a,o)}}switch(r){case"move":return this._setupMove2DOperation(e,a,o);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,r,a,o);case"transform":if(e.length===1){const p=e[0].geometry?.type;p!=="point"&&p!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,a,o)}}async _setupMove3DOperation(e,t,i,o,a=!1){const r=await this._requireModule(G(()=>import("./ImageMaterial.glsl-CW6AKEog.js").then(y=>y.e),__vite__mapDeps([124,1,2,3,122,68,11,69,13,6,7,8,27,100,5,101,40,72,102,71,73,103,104,105,9,4,10,12,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29,30,31,32,33,34,35,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,70,74,106,107,108,109,75,76,77,78,79,125,126,127,128,112,129,130,131,132,133,134,135,136,137,138,117,139,140,141,111,142,143,116,144,145,146,147,148,110,149,150,151,152,153,154,155,98,99,113,80,81,82,83,84,85,114,115,97,156,157,158,159,118,119,160,161,162,163,164,165,166,120,121]),import.meta.url));if(E(r))return r;const{ManipulatedObject3DGraphic:p,MoveTool3D:s}=r.module,l=new Map,n=()=>{l.forEach(y=>y.destroy()),l.clear()};for(const y of e){const u=new p({view:i,graphic:y}),O=jt(u);if(O!==_.SUPPORTED)return n(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Pe(O)}).`),null;l.set(y,u)}const d=new s({view:i,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(d),d.objects.addMany(Array.from(l.values())),a||this.updateGraphics.addMany(e);const g=[],m=new I({activeComponent:d,tool:o,type:"update",onEnd:()=>{R(g),X(i,d),n()},undo:()=>{He(this.view,d),W(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{z(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:y=>{this.updateGraphics.push(y);const u=new p({view:i,graphic:y});l.set(y,u),d.objects.push(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{const u=this.updateGraphics.indexOf(y);if(m.history.undo.forEach(M=>M.updates.splice(u,1)),m.history.redo.forEach(M=>M.updates.splice(u,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void m.complete();const O=l.get(y);O&&(d.objects.remove(O),O.destroy(),l.delete(y))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||o!=="transform")return;const y=this.updateGraphics.at(0),u=await this._setupReshape3DOperation(y,t,i,!0);u&&!E(u)&&(m.onEnd(),m.destroy(),this._setUpdateOperationHandle(u,t))}});return g.push(...this._getHandlesForComponent(m,t),i.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(m,y,t),w.WIDGET),i.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(m,y)},w.WIDGET)),m}_setupGraphicTransform3DOperation(e,t,i,o=!1){if(e.length===1&&Bt(e[0])===_.SUPPORTED){const a=e[0],r=a.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(a,t,i);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(a,t,i,o)}return this._setupMove3DOperation(e,t,i,"transform",o)}async _setupPointTransform3DOperation(e,t,i){const o="transform",{enableRotation:a,enableScaling:r,enableZ:p}=t,s=await this._requireModule(G(()=>import("./ImageMaterial.glsl-CW6AKEog.js").then(u=>u.e),__vite__mapDeps([124,1,2,3,122,68,11,69,13,6,7,8,27,100,5,101,40,72,102,71,73,103,104,105,9,4,10,12,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29,30,31,32,33,34,35,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,70,74,106,107,108,109,75,76,77,78,79,125,126,127,128,112,129,130,131,132,133,134,135,136,137,138,117,139,140,141,111,142,143,116,144,145,146,147,148,110,149,150,151,152,153,154,155,98,99,113,80,81,82,83,84,85,114,115,97,156,157,158,159,118,119,160,161,162,163,164,165,166,120,121]),import.meta.url));if(E(s))return s;const{TransformTool3D:l,ManipulatedObject3DGraphic:n}=s.module,d=new n({graphic:e,view:i}),g=new l({object:d,view:i,enableRotation:a,enableScaling:r,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(g),this.updateGraphics.add(e);const m=[],y=new I({activeComponent:g,tool:o,type:"update",onEnd:()=>{R(m),X(i,g),d.destroy()},undo:()=>{He(this.view,g),W(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{z(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:async u=>{this.updateGraphics.add(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);E(O)||this._setUpdateOperationHandle(O,t)},removeFromSelection:u=>{this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(y,u,t),w.WIDGET),i.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(y,u)},w.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,i,o=!1){const a="transform",{enableRotation:r,enableScaling:p,enableZ:s,preserveAspectRatio:l}=t,n=await this._requireModule(G(()=>import("./ImageMaterial.glsl-CW6AKEog.js").then(f=>f.e),__vite__mapDeps([124,1,2,3,122,68,11,69,13,6,7,8,27,100,5,101,40,72,102,71,73,103,104,105,9,4,10,12,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29,30,31,32,33,34,35,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,70,74,106,107,108,109,75,76,77,78,79,125,126,127,128,112,129,130,131,132,133,134,135,136,137,138,117,139,140,141,111,142,143,116,144,145,146,147,148,110,149,150,151,152,153,154,155,98,99,113,80,81,82,83,84,85,114,115,97,156,157,158,159,118,119,160,161,162,163,164,165,166,120,121]),import.meta.url));if(E(n))return n;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:g}=n.module,m=this.view?.inputManager?.isModifierKeyDown(b.constraint),y=new d({view:i,graphic:e}),u=new g({object:y,view:i,enableRotation:r,enableScaling:p,enableZ:s,preserveAspectRatio:!!l!=!!m,sketchOptions:this.sketchOptions});i.tools.add(u),o||this.updateGraphics.add(e);const O=[],M=new I({activeComponent:u,tool:a,type:"update",onEnd:()=>{R(O),X(i,u),y.destroy()},canUndo:()=>!u.destroyed&&u.canUndo,undo:()=>{u.destroyed||(u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},canRedo:()=>!u.destroyed&&u.canRedo,redo:()=>{u.destroyed||(u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},addToSelection:async f=>{this.updateGraphics.add(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[f],removed:[],type:"selection-change"},type:"update"}),M.onEnd(),M.destroy();const _e=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);E(_e)||this._setUpdateOperationHandle(_e,t)},removeFromSelection:f=>{this.updateGraphics.remove(f),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[f],type:"selection-change"},type:"update"}),M.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const f=await this._setupReshape3DOperation(e,t,i,!0);f&&!E(f)&&(M.onEnd(),M.destroy(),this._setUpdateOperationHandle(f,t))}});return O.push(...this._getHandlesForComponent(M,t),i.on("immediate-click",f=>this._getCommonUpdateOperationClickHandlers(M,f,t),w.WIDGET),i.on("key-down",f=>this._getCommonUpdateOperationKeyDownHandlers(M,f),w.WIDGET),i.on("key-down",f=>{f.key!==b.constraint||f.repeat||(u.preserveAspectRatio=!u.preserveAspectRatio,f.stopPropagation())},w.WIDGET),i.on("key-up",f=>{f.key===b.constraint&&(u.preserveAspectRatio=!u.preserveAspectRatio,f.stopPropagation())},w.WIDGET)),M}async _setupMove2DOperation(e,t,i){const o="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a=await this._getGraphicMover(e,t,i);if(E(a))return a;const r=new I({activeComponent:a,tool:o,type:"update",onEnd:()=>{this._displayDefaultCursor(),R(l),R(s),a.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const n=this.updateGraphics.toArray();W(r,n),r.refreshComponent(),this._emitUndoEvent({graphics:n,tool:o})},redo:()=>{const n=this.updateGraphics.toArray();z(r,n),r.refreshComponent(),this._emitRedoEvent({graphics:n,tool:o})},addToSelection:async n=>{await this._updatingHandles.addPromise(this._updateSpatialReference(n)),this.updateGraphics.push(n),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[n],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:n=>{const d=this.updateGraphics.indexOf(n);r.history.undo.forEach(m=>m.updates.splice(d,1)),r.history.redo.forEach(m=>m.updates.splice(d,1)),this.updateGraphics.remove(n);const g=this.updateGraphics.toArray();this.emit("update",{graphics:g,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[n],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?a.graphics=g:r.complete()}});let p=!1;const s=[i.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(r,n,t),w.WIDGET),i.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(r,n),n.key!==b.constraint||n.repeat||(p=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},w.WIDGET),i.on("key-up",n=>{n.key===b.constraint&&p&&(p=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},w.WIDGET)],l=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,i,o=!1){const a="reshape",r=await this._requireModule(G(()=>import("./ImageMaterial.glsl-CW6AKEog.js").then(u=>u.e),__vite__mapDeps([124,1,2,3,122,68,11,69,13,6,7,8,27,100,5,101,40,72,102,71,73,103,104,105,9,4,10,12,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29,30,31,32,33,34,35,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,70,74,106,107,108,109,75,76,77,78,79,125,126,127,128,112,129,130,131,132,133,134,135,136,137,138,117,139,140,141,111,142,143,116,144,145,146,147,148,110,149,150,151,152,153,154,155,98,99,113,80,81,82,83,84,85,114,115,97,156,157,158,159,118,119,160,161,162,163,164,165,166,120,121]),import.meta.url));if(E(r))return r;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:s}=r.module,l=new p({view:i,graphic:e}),n=Yt(l);if(n!==_.SUPPORTED)return l.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Pe(n)}).`),null;const d=t.reshapeOptions,g=new s({view:i,object:l,enableZVertex:t.enableZ&&d?.vertexOperation==="move",enableZShape:t.enableZ&&d?.shapeOperation==="move",enableMoveObject:d?.shapeOperation==="move"||d?.shapeOperation==="move-xy",enableMidpoints:d?.edgeOperation==="split",enableEdgeOffset:d?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(g),o||this.updateGraphics.add(l.graphic);const m=[],y=new I({activeComponent:g,tool:a,type:"update",onEnd:()=>{R(m),X(i,g),l.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},addToSelection:async u=>{this.updateGraphics.add(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);E(O)||this._setUpdateOperationHandle(O,t)},removeFromSelection:u=>{this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();const u=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);E(u)||this._setUpdateOperationHandle(u,t)}});return m.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(y,u,t),w.WIDGET),i.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(y,u)},w.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,i,o){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a=t==="transform"?await this._getBox(e,i,o):await this._getReshape(e,i,o);if(E(a))return a;const r=new I({activeComponent:a,type:"update",onEnd:()=>{R(s),R(p),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{W(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{z(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async l=>{let n=r.activeComponent;if(n?.type==="reshape"){const d=[...this.updateGraphics,l];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const g=await this._setupTransformOrReshape2DOperation(d,"transform",i,o);if(E(g))return;this._setUpdateOperationHandle(g,i)}else this.updateGraphics.add(l),n.graphics=this.updateGraphics.toArray(),n.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const n=this.updateGraphics.indexOf(l);r.history.undo.forEach(g=>g.updates.splice(n,1)),r.history.redo.forEach(g=>g.updates.splice(n,1)),this.updateGraphics.remove(l);const d=this.updateGraphics.toArray();if(d.length===0)r.complete();else{const g=d[0].geometry;d.length!==1||g==null||g.type!=="point"&&g.type!=="multipoint"?r.activeComponent.graphics=d:r.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),n=l.geometry;if(n!=null&&(r.tool==="reshape"&&(n.type==="point"||n.type==="multipoint")||r.tool==="transform"&&n.type==="extent"))return;let d=null;r.tool==="transform"?d=await this._getReshape([l],i,o):r.tool==="reshape"&&(d=await this._getBox([l],i,o)),E(d)||(r.activeComponent?.destroy(),r.activeComponent=d,r.activeComponent&&(R(s),s=this._getHandlesForComponent(r,i)))}}),p=[o.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(r,l,i),w.WIDGET),o.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,l),l.key===b.constraint&&!l.repeat&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET),o.on("key-up",l=>{if(l.key===b.constraint&&r){const n=r.activeComponent;n&&n.type==="box"&&(n.preserveAspectRatio=!n.preserveAspectRatio)}},w.WIDGET)];let s=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:o,highlightOptions:a}=t,r=await this._requireModule(G(()=>import("./GraphicMover-BdmA0XuA.js").then(p=>p.G),__vite__mapDeps([191,1,2,3,80,43,42,19,81,82,83,84,39,40,11,85,7,8,123,47,94,192,27,193,45,23,4,24,25,26,17,15,28,29,30,31,32,33,34,35,36,37,38,41,44,46,20,21,22,48,10,12,49,50,51,52,53,54,55,56,57,58,13,59,60,61,62,63,64,65,66,67,120,16,6,121]),import.meta.url));return E(r)?r:new r.module.default({enableMoveAllGraphics:o,highlightsEnabled:!!a?.enabled,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:({dx:p,dy:s,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:s,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:p,dy:s,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:s,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:p,dy:s,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:p,dy:s,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:o,enableScaling:a,highlightOptions:r,preserveAspectRatio:p}=t,s=await this._requireModule(G(()=>import("./Box-BQ6ZO7Zv.js"),__vite__mapDeps([194,1,2,3,5,123,191,80,43,42,19,81,82,83,84,39,40,11,85,7,8,47,94,192,27,193,45,23,4,24,25,26,17,15,28,29,30,31,32,33,34,35,36,37,38,41,44,46,20,21,22,48,10,12,49,50,51,52,53,54,55,56,57,58,13,59,60,61,62,63,64,65,66,67,120,16,6,121,195,9,14,18,68,69,70,71,72,73,74,100,101,102,103,104,105,106,107,108,109,75,76,77,78,79,166,158,86,87]),import.meta.url));if(E(s))return s;const l=this.view?.inputManager?.isModifierKeyDown(b.constraint);return new s.module.default({graphics:e,enableRotation:o,enableScaling:a,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!p!=!!l,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onMove:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onMoveStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onScaleStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onScale:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onScaleStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onRotateStart:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onRotate:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"}),onRotateStop:n=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n},type:"update"})}})}async _getReshape(e,t,i){const o=t.reshapeOptions?.edgeOperation==="split",a=t.reshapeOptions?.shapeOperation==="move",r=!!t.highlightOptions?.enabled,p=await this._requireModule(G(()=>import("./Reshape-qYp-jaGh.js"),__vite__mapDeps([196,1,2,3,80,43,42,19,81,82,83,84,39,40,11,85,7,8,48,96,10,12,97,9,4,5,13,14,15,16,17,18,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,41,44,45,46,47,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,6,98,99,100,101,102,103,104,105,106,107,108,109,75,76,77,78,79,110,111,112,123,191,94,192,193,120,121,157,158,195,86,87]),import.meta.url));return E(p)?p:new p.module.default({enableMidpoints:o,enableMovement:a,graphic:e[0],highlightsEnabled:r,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:i,callbacks:{onReshapeStart:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s},type:"update"}),onReshape:s=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...s},type:"update"}),onReshapeStop:({mover:s,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:s,type:l},type:"update"}),onMoveStart:({dx:s,dy:l,mover:n,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:l,mover:n,type:d},type:"update"}),onMove:({dx:s,dy:l,mover:n,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:l,mover:n,type:d},type:"update"}),onMoveStop:({dx:s,dy:l,mover:n,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:s,dy:l,mover:n,type:d},type:"update"}),onVertexAdd:({added:s,type:l,vertices:n})=>{const d=s.map(g=>we(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:d,vertices:n,type:l},type:"update"})},onVertexRemove:({removed:s,type:l,vertices:n})=>{const d=s.map(g=>we(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:d,vertices:n,type:l},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:o,viewEvent:a})=>{a.native?.shiftKey&&(a.stopPropagation(),e.removeFromSelection(o))}),i.on("graphic-move-start",o=>e.addToHistory(H(o.allGraphics)))];case"box":return[i.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),i.on("move-start",o=>e.addToHistory(H(o.graphics))),i.on("rotate-start",o=>e.addToHistory(H(o.graphics))),i.on("scale-start",o=>e.addToHistory(H(o.graphics)))];case"reshape":return[i.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),i.on("move-start",o=>e.addToHistory(H([o.mover]))),i.on("reshape-start",o=>e.addToHistory(H([o.graphic]))),i.on("vertex-add",o=>e.addToHistory(H([o.oldGraphic]))),i.on("vertex-remove",o=>e.addToHistory(H([o.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:o})=>{e.addToHistory({updates:o})}),i.events.on("move-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:o.objects.length>0?o.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:o.dx,dy:o.dy,mover:o.objects.length>0?o.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:o.objects.length>0?o.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:o})=>{e.addToHistory({updates:o})}),i.events.on("translate-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,angle:o.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,angle:o.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,dx:o.dxScreen,dy:o.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,angle:o.angle,type:"rotate"},type:"update"})}),i.events.on("scale",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:o.object.graphic,xScale:o.xScale,yScale:o.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...o,mover:o.object.graphic},type:"update"})}),i.events.on("move",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...o,mover:o.object.graphic},type:"update"})}),i.events.on("vertex-add",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),i.events.on("vertex-remove",o=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:o,type:"update"})}),i.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:o,viewEvent:a}=i;return a.native?.shiftKey&&o.layer===this.layer?(a.stopPropagation(),e.removeFromSelection(o)):t.toggleToolOnClick?(a.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view?.map;this._disablePopup(t);const o=()=>{if(e===this._operationHandle){const a=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:a,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",o)}async _getCommonUpdateOperationClickHandlers(e,t,i){const o=Oe(t),a=await t.async(()=>this._getFirstHit(o));if(a==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([a.graphic],e,i))return void t.stopPropagation();this.updateGraphics.includes(a.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const o=!!i.multipleSelectionEnabled;return e.some(a=>a!=null&&!(!o||a.layer!==this.layer)&&(this.updateGraphics.includes(a)?t.removeFromSelection(a):t.addToSelection(a),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===b.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===b.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===b.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&b.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,i=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=N(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,i){Le.getLogger(this).error(new lt(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return Se(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(pe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await ht(Se(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Ie("view"))}_logMissingLayer(){this._logError(hi,Ie("layer"))}};h([c()],v.prototype,"_defaultSnappingManager",void 0),h([c()],v.prototype,"updating",null),h([c({readOnly:!0})],v.prototype,"_updatingHandles",void 0),h([c()],v.prototype,"_operationHandle",void 0),h([c({readOnly:!0})],v.prototype,"activeTool",null),h([c({readOnly:!0})],v.prototype,"activeCreateToolDrawMode",null),h([c()],v.prototype,"activeTooltip",null),h([c({types:Y})],v.prototype,"activeFillSymbol",void 0),h([c()],v.prototype,"activeLineSymbol",void 0),h([c()],v.prototype,"activeVertexSymbol",void 0),h([c()],v.prototype,"allowDeleteKey",void 0),h([c({readOnly:!0})],v.prototype,"createGraphic",null),h([c()],v.prototype,"defaultCreateOptions",null),h([c()],v.prototype,"defaultUpdateOptions",null),h([c({type:It,nonNullable:!0})],v.prototype,"labelOptions",null),h([c()],v.prototype,"layer",void 0),h([c({types:Y})],v.prototype,"pointSymbol",void 0),h([c({types:Y})],v.prototype,"polygonSymbol",void 0),h([c({types:Y})],v.prototype,"polylineSymbol",void 0),h([c()],v.prototype,"meshSymbol",void 0),h([c({type:me,nonNullable:!0})],v.prototype,"snappingOptions",null),h([c()],v.prototype,"snappingManager",null),h([c({readOnly:!0})],v.prototype,"state",null),h([c({type:Ht,nonNullable:!0})],v.prototype,"tooltipOptions",null),h([c({readOnly:!0})],v.prototype,"updateGraphics",void 0),h([c()],v.prototype,"updateOnGraphicClick",void 0),h([c()],v.prototype,"creationMode",void 0),h([c({type:Lt,nonNullable:!0})],v.prototype,"valueOptions",null),h([c({types:Y})],v.prototype,"vertexSymbol",void 0),h([c({value:null})],v.prototype,"view",null),h([c({constructOnly:!0,type:je})],v.prototype,"sketchOptions",void 0),v=h([V("esri.widgets.Sketch.SketchViewModel")],v);const hi="sketch:missing-property",Ie=e=>`Property '${e}' is missing on SketchViewModel.`;function ci(e){return e==="polygon"||e==="rectangle"||e==="circle"}function W(e,t){Be("undo",e.history.undo,e.history.redo,t)}function z(e,t){Be("redo",e.history.redo,e.history.undo,t)}function Be(e,t,i,o){const a=t.pop();if(!a)return;const r=a.updates,p=[];o.forEach((s,l)=>{const n=r[l];n!=null&&("geometry"in n&&n.geometry!=null&&(p.push({geometry:s.geometry}),s.geometry=n.geometry),"symbol"in n&&n.symbol!=null&&(p.push({symbol:s.symbol}),s.symbol=n.symbol),"undo"in n&&(p.push(n),n[e](s)))}),i.push({updates:p})}function He(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function H(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function X(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function E(e){return"requireError"in e&&e.requireError==="aborted"}const di=v;function Q(e,t){e.networkFeature=t}function ui(e){const t=F(e.graphic);return{...e,networkFeature:t}}function yi(e){const t=e.graphics.map(i=>F(i));return{...e,networkFeatures:t}}function F(e){return e.networkFeature}function gi(e){return e?.type==="point"||e?.type==="polyline"||e?.type==="polygon"}let x=class extends re{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new Ue({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new xe,this.enabled=!0,this._handleSketchViewModelEvents=async t=>{switch(t.type){case"update":switch(t.state){case"active":case"complete":for(const i of t.graphics)F(i).geometry=gi(i.geometry)?i.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const i of t.graphics){const o=F(i);this._removeNetworkFeature(o)}break;case"create":if(t.graphic&&t.state==="complete"&&this._createMode){const i=t.graphic.geometry?.clone(),o=t.graphic.symbol?.clone();if(!i)break;switch(this._createMode){case"stop":{if(i.type!=="point")break;const{stops:a}=this.layer;if(a.length>0&&a.every(({geometry:p})=>!p)){a.at(0).geometry=i;break}if(a.length>1&&a.filter((p,s)=>s!==0).every(({geometry:p})=>!p)){a.at(1).geometry=i;break}const r=new vt({geometry:i});a.add(r),Q(t.graphic,r);break}case"point-barrier":{if(i.type!=="point")break;const a=new gt({geometry:i,symbol:o});this.layer.pointBarriers.add(a),Q(t.graphic,a);break}case"polyline-barrier":{if(i.type!=="polyline")break;const a=new yt({geometry:i,symbol:o});this.layer.polylineBarriers.add(a),Q(t.graphic,a);break}case"polygon-barrier":{if(i.type!=="polygon")break;const a=new ut({geometry:i,symbol:o});this.layer.polygonBarriers.add(a),Q(t.graphic,a);break}}}}(await this.view.whenLayerView(this.layer)).emit(t.type,t.type==="create"?ui(t):yi(t))}}initialize(){this._sketchViewModel=new di({layer:this._graphicsLayer,view:this.view}),this.addHandles([U(()=>this.enabled,e=>{e?this._activate():this._deactivate()},ct),U(()=>{const{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:o}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:i,polygonBarriers:o}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),dt(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=N(this._graphicsLayer),this._sketchViewModel=N(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>F(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find(i=>F(i)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(t=>t.toArray().map(i=>{const o=i.toGraphic();return o.networkFeature=i,o}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};h([c()],x.prototype,"enabled",void 0),h([c({constructOnly:!0})],x.prototype,"layer",void 0),h([c({readOnly:!0})],x.prototype,"selectedNetworkFeatures",null),h([c()],x.prototype,"updating",null),h([c({constructOnly:!0})],x.prototype,"view",void 0),x=h([V("esri.views.2d.layers.support.RouteLayerInteraction")],x);const Vi=Object.freeze(Object.defineProperty({__proto__:null,get RouteLayerInteraction(){return x}},Symbol.toStringTag,{value:"Module"}));export{_ as P,Vi as R,ee as a,Wt as b,zt as c,Jt as d,Re as e,Pi as f,Qt as g,ei as h,ti as i,jt as j,qe as n,oe as o,ae as p,Xt as r,oi as s};
