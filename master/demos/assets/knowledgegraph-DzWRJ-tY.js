const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-BL8Uqg6E.js","./main-asQ7SttR.js","./preload-helper-ExcqyqRp.js","./main-DmIi68wH.css","./normalizeUtils-CQip1v0x.js","./normalizeUtilsCommon-B9hLdSv-.js","./utils-CO4HUuqg.js","./utils-CLKe2jGG.js","./Field-BLAoQZ_0.js","./fieldType-DNTeE9NS.js","./networkEnums-BhJmnK1i.js","./FeatureSet-BbkVLp0y.js","./GPMessage-BaYdJ0o_.js","./Relationship-CKTuQU_6.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./preload-helper-ExcqyqRp.js";import{C as x,c_ as w,c$ as v,$ as E,O as I,cO as K,d0 as P,a8 as F,d2 as O,d3 as V}from"./main-asQ7SttR.js";import{o as T,V as j,j as b,X as J,J as N,c as W,K as U,Z as k,a0 as M,a1 as Q,a2 as L,U as q}from"./arcade-DMdCNKon.js";import{a as c,r as u}from"./unitConversion-Ck-EQaC0.js";import{l as B}from"./portalUtils-2nkgAAhU.js";import{k as X,K as Z,O as z}from"./projection-G6EI4E6A.js";import H from"./PortalItem-Nq3zGykG.js";import{m as Y,n as $}from"./project-C9nI3Yai.js";import{p as tt,c as nt,t as rt,a as et,b as at}from"./Relationship-CKTuQU_6.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-CtViELyY.js";import"./TimeOnly-BOSrAlqL.js";import"./Field-BLAoQZ_0.js";import"./fieldType-DNTeE9NS.js";import"./number-owTymi_G.js";import"./featureConversionUtils-pNtCHoNi.js";import"./OptimizedFeature-CYyXKDHx.js";import"./memoryEstimations-COo-dz1M.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DW-5YYve.js";import"./timeZoneUtils-CfTu0PZq.js";import"./WhereClause-Bsz5dHey.js";import"./uuid-Cl5lrJ4c.js";import"./projectBuffer-Cx7kBt8y.js";import"./utils-CO4HUuqg.js";import"./utils-CLKe2jGG.js";let l=null;async function it(t){const n=E.geometryServiceUrl??"";if(!n){X()||await Z();for(const r of t)r.container[r.indexer]=z(r.container[r.indexer],I.WGS84);return}const e=t.map(r=>r.container[r.indexer]),i=new Y({geometries:e,outSpatialReference:I.WGS84}),s=await $(n,i);for(let r=0;r<s.length;r++){const a=t[r];a.container[a.indexer]=s[r]}}async function D(t,n){const e=new H({portal:t,id:n});return await e.load(),l===null&&(l=await G(()=>import("./knowledgeGraphService-BL8Uqg6E.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url)),await l.fetchKnowledgeGraph(e.url)}function R(t,n,e,i,s){if(t===null)return null;if(w(t)||K(t))return t;if(k(t)||k(t))return t.toJSDate();if(M(t))return t.toStorageFormat();if(Q(t))return t.toStorageString();if(L(t)){const r={};for(const a of t.keys())r[a]=R(t.field(a),n,e,i,s),r[a]instanceof P&&s.push({container:r,indexer:a});return r}if(v(t)){const r=t.map(a=>R(a,n,e,i,s));for(let a=0;a<r.length;a++)r[a]instanceof P&&s.push({container:r,indexer:a});return r}return q(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&n?F(t):t:void 0}function ot(t,n){if(!t)return t;if(t.spatialReference.isWGS84&&n.spatialReference.isWebMercator)return V(t);if(t.spatialReference.equals(n.spatialReference))return t;throw new c(n,u.WrongSpatialReference,null)}function S(t,n){if(!t)return null;const e={};for(const i in t)e[i]=m(t[i],n);return e}function m(t,n){return t===null?null:v(t)?t.map(e=>m(e,n)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:S(t.properties,n)}:t instanceof rt?{graphType:"object",properties:S(t.properties,n)}:t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:S(t.properties,n)}:t instanceof at?{graphType:"path",path:t.path?t.path.map(e=>m(e,n)):null}:q(t)?ot(t,n):w(t)||K(t)||O(t)?t:null}function qt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(n,e){return t.standardFunctionAsync(n,e,(i,s,r)=>{if(T(r,2,2,n,e),r[0]===null)throw new c(n,u.PortalRequired,e);if(r[0]instanceof j){const d=b(r[1]);let f;return f=n.services?.portal?n.services.portal:x.getDefault(),D(B(r[0],f),d)}if(w(r[0])===!1)throw new c(n,u.InvalidParameter,e);const a=b(r[0]);return D(n.services?.portal??x.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(n,e){return t.standardFunctionAsync(n,e,async(i,s,r)=>{T(r,2,4,n,e);const a=r[0];if(!J(a))throw new c(n,u.InvalidParameter,e);const d=r[1];if(!w(d))throw new c(n,u.InvalidParameter,e);l===null&&(l=await G(()=>import("./knowledgeGraphService-BL8Uqg6E.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url));let f=null;const h=N(r[2],null);if(!(h instanceof W||h===null))throw new c(n,u.InvalidParameter,e);if(h){let o=[];f=R(h,!0,!1,n,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await it(o)}const _=new tt({openCypherQuery:d,bindParameters:f});(a?.serviceDefinition?.currentVersion??11.3)>11.2&&(_.outputSpatialReference=n.spatialReference);const A=(await l.executeQueryStreaming(a,_)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:o,value:p}=await A.read();if(o)break;if(v(p))for(const g of p)y.push(m(g,n));else{const g=[];for(const C of p)g.push(m(p[C],n));y.push(g)}}}catch(o){throw o}return W.convertJsonToArcade(y,U(n),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{qt as registerFunctions};
